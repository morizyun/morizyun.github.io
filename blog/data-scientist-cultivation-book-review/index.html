
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>【書評: データサイエンティスト養成読本】で学ぶデータサイエンティストの生態系 - 酒と泪とRubyとRailsと</title>
  <meta name="author" content="morizyun">

  
  <meta name="description" content="統計解析の勉強をしていく中で、どうやったら実際の業務の中に活かしていけるかを模索していて、この本にいきあたりました。人々が生み出すデータがますます増加していく中で、そのデータをビジネスにどう活用していくかをエンジニアの視点で考えられる素晴らしい本だと思います。 &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://morizyun.github.io/blog/data-scientist-cultivation-book-review/">
  <link rel="shortcut icon" href="/favicon.ico">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/stylesheets/gh-buttons.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/stylesheets/table.css" rel="stylesheet" type="text/css" />
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="/javascripts/ender.js"></script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <link href="http://feeds.feedburner.com/rubyrails" rel="alternate" title="酒と泪とRubyとRailsと" type="application/atom+xml">
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-36299115-2']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


  <meta property="og:title" content="【書評: データサイエンティスト養成読本】で学ぶデータサイエンティストの生態系 - 酒と泪とRubyとRailsと" />
<meta property="og:description" content="統計解析の勉強をしていく中で、どうやったら実際の業務の中に活かしていけるかを模索していて、この本にいきあたりました。人々が生み出すデータがますます増加していく中で、そのデータをビジネスにどう活用していくかをエンジニアの視点で考えられる素晴らしい本だと思います。 &hellip;" />
<meta property="og:url" content="http://morizyun.github.io/blog/data-scientist-cultivation-book-review/" />
<meta property="og:image" content="http://morizyun.github.io/images/default_ogp_image.png" />
<meta property="og:author" content="zyunnosuke" />
<meta property="og:site_name" content="酒と泪とRubyとRailsと" />
<meta property="og:locale" content="ja_JP" />
<meta property="og:type" content="article" />
<meta property="fb:app_id" content="183897648417956" />
</head>

<body   >
  <header role="banner"><hgroup>
  <h1>
    <a href="/">酒と泪とRubyとRailsと</a>
  </h1>
  
    <h2>Ruby on Rails と Objective-C は酒の肴です！</h2>
  
</hgroup>
<script language="JavaScript">
  $(document).ready( function () {
     $("a[href^='http']:not([href*='" + location.hostname + "'])").attr('target', '_blank');
     })
</script>
</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="http://feeds.feedburner.com/rubyrails" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:morizyun.github.io" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Home</a></li>
  <li><a href="/blog/ruby-design-pattern-matome-mokuzi/">Rubyデザインパターン</a></li>
  <li><a href="/blog/centos63-sakura-vps-rails-setup-guide/">Railsサーバ構築手順</a></li>
  <li><a href="https://coderwall.com/p/u/morizyun" target="_blank">English</a></li>
</ul>
</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">【書評: データサイエンティスト養成読本】で学ぶデータサイエンティストの生態系</h1>
    
    
    
      <p class="meta" style="top: -25px;">
    
        








  



        <time datetime="2014-03-31T09:40:00+09:00" pubdate data-updated="true">Mar 31<span>st</span>, 2014</time>
<span class="sharing social_box" style="margin: 10px 0 0 10px; display: inline-table;">
  <ul class="social" style="margin-left: 0;margin-top: 10px;">
    <li class="hatena">
      <a href="http://b.hatena.ne.jp/entry/http://morizyun.github.io/blog/data-scientist-cultivation-book-review/" class="hatena-bookmark-button" data-hatena-bookmark-layout="standard" title="このエントリーをはてなブックマークに追加"><img src="http://b.st-hatena.com/images/entry-button/button-only.gif" alt="このエントリーをはてなブックマークに追加" width="20" height="20" style="border: none;" /></a><script type="text/javascript" src="http://b.st-hatena.com/js/bookmark_button.js" charset="utf-8" async="async"></script>
    </li>
    <li class="twitter">
      
      <a href="http://twitter.com/share" class="twitter-share-button" data-url="http://morizyun.github.io/blog/data-scientist-cultivation-book-review/" data-via="zyunnosuke" data-counturl="http://morizyun.github.io/blog/data-scientist-cultivation-book-review/" >Tweet</a>
      
    </li>
    <li class="facebook">
      <div class="fb-like" data-send="false" data-layout="button_count" data-show-faces="false" data-font="verdana" data-href="http://morizyun.github.io/blog/data-scientist-cultivation-book-review/"></div>
    </li>
  </ul>
</span>

        
      </p>
    
  </header>


<div class="entry-content"><p><a href="http://www.amazon.co.jp/gp/product/4774158968/ref=as_li_qf_sp_asin_il?ie=UTF8&camp=247&creative=1211&creativeASIN=4774158968&linkCode=as2&tag=morizyun00-22"><img border="0" src="http://ws.assoc-amazon.jp/widgets/q?_encoding=UTF8&ASIN=4774158968&Format=_SL160_&ID=AsinImage&MarketPlace=JP&ServiceVersion=20070822&WS=1&tag=morizyun00-22" width="150" style="float: left; margin: 0 20px 20px 0;" ></a><img src="http://www.assoc-amazon.jp/e/ir?t=morizyun00-22&l=as2&o=9&a=4774158968" width="1" height="1" border="0" alt="" style="border:none !important; margin:0px !important;" />統計解析の勉強をしていく中で、どうやったら実際の業務の中に活かしていけるかを模索していて、この本にいきあたりました。人々が生み出すデータがますます増加していく中で、そのデータをビジネスにどう活用していくかをエンジニアの視点で考えられる素晴らしい本だと思います。</p>

<p>今回はこの本の中で特に参考になった点を中心にピックアップしていきます。</p>

<!-- more -->


<br style="clear:both;"/>


<div>
  <script type="text/javascript"><!--
  google_ad_client = "ca-pub-4186413323075068";
  /* middle_yoko_naga2 */
  google_ad_slot = "4362325392";
  google_ad_width = 728;
  google_ad_height = 90;
  //-->
  </script>
  <script type="text/javascript"
          src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
  </script>
</div>


<h2>本書のサンプルデータ</h2>

<p><strong><a href="http://gihyo.jp/book/2013/978-4-7741-5896-9/support">サポートページ：データサイエンティスト養成読本 ［ビッグデータ時代のビジネスを支えるデータ分析力が身につく！］</a></strong><br/>
インターネットの力、マジですごい！サンプルデータはほんとうに有難い！</p>

<h2>データサイエンティストの仕事術</h2>

<h3>Cross Industry Standard Process for Data Mining(CRISP-DM)</h3>

<p>データマイニングプロジェクトにおける標準的な6つの手順。</p>

<pre>
1) Business Understanging
ビジネスの全体像の理解(ヒアリング)と課題設定

2) Data Understanding
データ収集と理解に努めて、仮説構築の下地を作る

3) Data Preparation
数理モデルの作成のために、データマート(データウェアハウス)を構築。
欠損値や外れ値を除去していく。

4) Modeling
仮説にもどついて、数理モデルを構築する

5) Evaluation
数理モデルの評価。ビジネスリスクの評価

6) Deployment
数理モデルに基づく、ビジネス施策の実施
</pre>


<h3>必要なスキルセット</h3>

<pre>
# ハードスキル
1) Data Understanding 〜 Data Preparation
RDBMS(SQL)、Hadoop(HDFS)、MapReduce、Hiveなど

2) Modeling 〜 Devaluation
統計解析、機械学習の知識、R, Pythonなど

# ソフトスキル
1) Business Understanding 〜 Data Understanding
ビジネスにおける業界、業務の知識。質問力、理解力が必要

2) Deployment
分析結果の伝達力、説得力、プロジェクトの推進力が必要
</pre>


<p>根本としては好奇心。「<strong>問題を核心まで掘り下げて、そこで見つけた疑問を明確で検証可能な一連の仮説に落としこみたいという欲求</strong>」が必要。</p>

<h3>データサイエンスよりも大切なこと</h3>

<pre>
1) 統計的な正しさよりもビジネスの成功
2) 組織の構造や実務の改善効果を重視する
3) 意味のある分析のためには泥臭いクリーニングが必須
4) データは適切な保持が大切
</pre>


<h3>パラメトリックとノンパラメトリック</h3>

<p><strong><a href="https://twitter.com/TJO_datasci">@TJO_datasci</a></strong>さんからご指摘頂きました。パラメトリックとノンパラメトリックの違いの端的なまとめは次の通りです。</p>

<blockquote>
* パラメトリック検定：正規分布に限らず厳密な分布の形の仮定を必要とする<br/>
* ノンパラメトリック検定：分布の形の仮定が不要である
</blockquote>


<p>引用元: <a href="http://tjo.hatenablog.com/entry/2013/11/19/093218">「パラメトリック検定」と「ノンパラメトリック検定」の違いについて出典を明示して書いておく</a></p>

<p>僕自身幾つか文献を見ましたが、まだまだ理解できていません。引き続き勉強して理解できたら、また自分の言葉で書き直したいと思います！</p>

<h2>データ分析実践入門</h2>

<h3>事前準備: RStudio</h3>

<p>この章では主にRを使います。RStudioについては次の章で説明します。</p>

<h3>ロジスティック回帰</h3>

<p>Rにデフォルトで入っている、タイタニック号の乗客の生存情報(Titanic)にロジスティック回帰モデルを使う。乗客の各属性から、生存の要因を探す。</p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="c">## データ整形</span>
</span><span class='line'>z &lt;- data.frame<span class="o">(</span>Titanic<span class="o">)</span>
</span><span class='line'>titanic.data &lt;- data.frame<span class="o">(</span>
</span><span class='line'>    <span class="nv">Class</span><span class="o">=</span>rep<span class="o">(</span>z<span class="nv">$Class</span>, z<span class="nv">$Freq</span><span class="o">)</span>,
</span><span class='line'>    <span class="nv">Sex</span><span class="o">=</span>rep<span class="o">(</span>z<span class="nv">$Sex</span>, z<span class="nv">$Freq</span><span class="o">)</span>,
</span><span class='line'>    <span class="nv">Age</span><span class="o">=</span>rep<span class="o">(</span>z<span class="nv">$Age</span>, z<span class="nv">$Freq</span><span class="o">)</span>,
</span><span class='line'>    <span class="nv">Survived</span><span class="o">=</span>rep<span class="o">(</span>z<span class="nv">$Survived</span>, z<span class="nv">$Freq</span><span class="o">)</span>
</span><span class='line'>  <span class="o">)</span>
</span><span class='line'>head<span class="o">(</span>titanic.data<span class="o">)</span>
</span><span class='line'><span class="c"># Class  Sex   Age Survived</span>
</span><span class='line'><span class="c"># 1   3rd Male Child       No</span>
</span><span class='line'><span class="c"># 2   3rd Male Child       No</span>
</span><span class='line'><span class="c"># 3   3rd Male Child       No</span>
</span><span class='line'><span class="c"># 4   3rd Male Child       No</span>
</span><span class='line'><span class="c"># 5   3rd Male Child       No</span>
</span><span class='line'><span class="c"># 6   3rd Male Child       No</span>
</span><span class='line'>
</span><span class='line'><span class="c">## モデル構築</span>
</span><span class='line'>titanic.logit &lt;- glm<span class="o">(</span>Survived~., <span class="nv">data</span><span class="o">=</span>titanic.data, <span class="nv">family</span><span class="o">=</span>binomial<span class="o">)</span>
</span><span class='line'>summary<span class="o">(</span>titanic.logit<span class="o">)</span>
</span><span class='line'><span class="c"># Call:</span>
</span><span class='line'><span class="c">#   glm(formula = Survived ~ ., family = binomial, data = titanic.data)</span>
</span><span class='line'><span class="c"># </span>
</span><span class='line'><span class="c"># Deviance Residuals: </span>
</span><span class='line'><span class="c">#   Min       1Q   Median       3Q      Max  </span>
</span><span class='line'><span class="c"># -2.0812  -0.7149  -0.6656   0.6858   2.1278  </span>
</span><span class='line'><span class="c"># </span>
</span><span class='line'><span class="c"># Coefficients:</span>
</span><span class='line'><span class="c">#   Estimate Std. Error z value Pr(&gt;|z|)    </span>
</span><span class='line'><span class="c"># (Intercept)   0.6853     0.2730   2.510   0.0121 *  </span>
</span><span class='line'><span class="c">#   Class2nd     -1.0181     0.1960  -5.194 2.05e-07 ***</span>
</span><span class='line'><span class="c">#   Class3rd     -1.7778     0.1716 -10.362  &lt; 2e-16 ***</span>
</span><span class='line'><span class="c">#   ClassCrew    -0.8577     0.1573  -5.451 5.00e-08 ***</span>
</span><span class='line'><span class="c">#   SexFemale     2.4201     0.1404  17.236  &lt; 2e-16 ***</span>
</span><span class='line'><span class="c">#   AgeAdult     -1.0615     0.2440  -4.350 1.36e-05 ***</span>
</span><span class='line'><span class="c">#   ---</span>
</span><span class='line'><span class="c">#   Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1</span>
</span><span class='line'><span class="c"># </span>
</span><span class='line'><span class="c"># (Dispersion parameter for binomial family taken to be 1)</span>
</span><span class='line'><span class="c"># </span>
</span><span class='line'><span class="c"># Null deviance: 2769.5  on 2200  degrees of freedom</span>
</span><span class='line'><span class="c"># Residual deviance: 2210.1  on 2195  degrees of freedom</span>
</span><span class='line'><span class="c"># AIC: 2222.1</span>
</span><span class='line'><span class="c"># </span>
</span><span class='line'><span class="c"># Number of Fisher Scoring iterations: 4</span>
</span></code></pre></td></tr></table></div></figure>




<div>
  <script type="text/javascript"><!--
  google_ad_client = "ca-pub-4186413323075068";
  /* middle_yoko_naga2 */
  google_ad_slot = "4362325392";
  google_ad_width = 728;
  google_ad_height = 90;
  //-->
  </script>
  <script type="text/javascript"
          src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
  </script>
</div>


<h3>オッズ比の計算</h3>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>install.packages<span class="o">(</span><span class="s1">&#39;epicalc&#39;</span><span class="o">)</span>
</span><span class='line'>library<span class="o">(</span><span class="s1">&#39;epicalc&#39;</span><span class="o">)</span>
</span><span class='line'>logistic.display<span class="o">(</span>titanic.logit, <span class="nv">simplified</span><span class="o">=</span>T<span class="o">)</span>
</span><span class='line'><span class="c"># OR lower95ci  upper95ci     Pr(&gt;|Z|)</span>
</span><span class='line'><span class="c"># Class2nd   0.3612825 0.2460447  0.5304933 2.053331e-07</span>
</span><span class='line'><span class="c"># Class3rd   0.1690159 0.1207510  0.2365727 3.691891e-25</span>
</span><span class='line'><span class="c"># ClassCrew  0.4241466 0.3115940  0.5773549 5.004592e-08</span>
</span><span class='line'><span class="c"># SexFemale 11.2465380 8.5408719 14.8093331 1.431830e-66</span>
</span><span class='line'><span class="c"># AgeAdult   0.3459219 0.2144193  0.5580746 1.360490e-05</span>
</span><span class='line'><span class="c">#=&gt; 例えば、女性のほうが11.2465380倍生存確率が高いということがわかる</span>
</span></code></pre></td></tr></table></div></figure>


<h3>決定木モデル</h3>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>library<span class="o">(</span>rpart<span class="o">)</span>
</span><span class='line'>install.packages<span class="o">(</span><span class="s1">&#39;partykit&#39;</span><span class="o">)</span>
</span><span class='line'>library<span class="o">(</span>partykit<span class="o">)</span>
</span><span class='line'>
</span><span class='line'>titanic.rp &lt;- rpart<span class="o">(</span>Survived~., <span class="nv">data</span><span class="o">=</span>titanic.data<span class="o">)</span>
</span><span class='line'>plot<span class="o">(</span>as.party<span class="o">(</span>titanic.rp<span class="o">)</span>, <span class="nv">tp_args</span><span class="o">=</span>T<span class="o">)</span>
</span></code></pre></td></tr></table></div></figure>


<p><img src="http://farm4.staticflickr.com/3720/13404231644_57b602b50a.jpg" width="480" height="500" alt="スクリーンショット 2014-03-25 22.45.03"></p>

<h3>主成分分析</h3>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>state.pca &lt;- prcomp<span class="o">(</span>state.x77<span class="o">[</span>,1:6<span class="o">]</span>, <span class="nv">scale</span><span class="o">=</span>T<span class="o">)</span>
</span><span class='line'>biplot<span class="o">(</span>state.pca<span class="o">)</span>
</span></code></pre></td></tr></table></div></figure>


<p><img src="http://farm8.staticflickr.com/7456/13404045033_bd64bcfd5f.jpg" width="487" height="500" alt="スクリーンショット 2014-03-25 22.48.23"></p>

<h3>非階層クラスタリング: k-means</h3>

<p>k-meansの手順。</p>

<pre>
1) k個のクラスタの中心の初期値を決める
2) 各データをk個クラスタ中心との距離を求め、最も近いクラスタに分類
3) 形成されたクラスタの中心を求める
4) クラスタの中心が変化しない時点まで(2), (3)を繰り返す
</pre>


<p>サンプルソースはこちら。</p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="c"># k-meansの実行(クラスタ数を3つに設定)</span>
</span><span class='line'>state.km &lt;- kmeans<span class="o">(</span>scale<span class="o">(</span>state.x77<span class="o">[</span>,1:6<span class="o">])</span>,3<span class="o">)</span>
</span><span class='line'>
</span><span class='line'><span class="c"># 主成分分析の結果にクラスタ情報を付与</span>
</span><span class='line'>state.pca.df &lt;- data.frame<span class="o">(</span>state.pca<span class="nv">$x</span><span class="o">)</span>
</span><span class='line'>state.pca.df<span class="nv">$name</span> &lt;- rownames<span class="o">(</span>state.pca.df<span class="o">)</span>
</span><span class='line'>state.pca.df<span class="nv">$cluster</span> &lt;- as.factor<span class="o">(</span>state.km<span class="nv">$cluster</span><span class="o">)</span>
</span><span class='line'>
</span><span class='line'><span class="c"># 描画</span>
</span><span class='line'>ggplot<span class="o">(</span>state.pca.df, aes<span class="o">(</span><span class="nv">x</span><span class="o">=</span>PC1, <span class="nv">y</span><span class="o">=</span>PC2, <span class="nv">label</span><span class="o">=</span>name, <span class="nv">col</span><span class="o">=</span>cluster<span class="o">))</span> + geom_text<span class="o">()</span> + theme_bw<span class="o">(</span>16<span class="o">)</span>
</span></code></pre></td></tr></table></div></figure>


<p><img src="https://farm8.staticflickr.com/7455/13404137535_783058ded9.jpg" width="456" height="500" alt="スクリーンショット 2014-03-25 23.01.10"></p>

<h3>レーダーチャート</h3>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>install.packages<span class="o">(</span><span class="s1">&#39;fmsb&#39;</span><span class="o">)</span>
</span><span class='line'>library<span class="o">(</span><span class="s1">&#39;fmsb&#39;</span><span class="o">)</span>
</span><span class='line'>df &lt;- as.data.frame<span class="o">(</span>scale<span class="o">(</span>state.km<span class="nv">$centers</span><span class="o">))</span>
</span><span class='line'>dfmax &lt;- apply<span class="o">(</span>df, 2, max<span class="o">)</span> + 1
</span><span class='line'>dfmin &lt;- apply<span class="o">(</span>df, 2, min<span class="o">)</span> - 1
</span><span class='line'>df &lt;- rbind<span class="o">(</span>dfmax, dfmin, df<span class="o">)</span>
</span><span class='line'>
</span><span class='line'><span class="c"># 描画</span>
</span><span class='line'>radarchart<span class="o">(</span>df, <span class="nv">seg</span><span class="o">=</span>5, <span class="nv">plty</span><span class="o">=</span>1, <span class="nv">pcol</span><span class="o">=</span>rainbow<span class="o">(</span>3<span class="o">))</span>
</span><span class='line'>legend<span class="o">(</span><span class="s2">&quot;topright&quot;</span>, <span class="nv">legend</span><span class="o">=</span>1:3, <span class="nv">col</span><span class="o">=</span>rainbow<span class="o">(</span>3<span class="o">)</span>, <span class="nv">lty</span><span class="o">=</span>1<span class="o">)</span>
</span><span class='line'><span class="c"># クラスタ1 =&gt; 平均寿命、高卒率、収入が多い</span>
</span><span class='line'><span class="c"># クラスタ2 =&gt; 殺人件数と非識字率が高い</span>
</span><span class='line'><span class="c"># クラスタ3 =&gt; 人口が多い</span>
</span></code></pre></td></tr></table></div></figure>


<p><img src="https://farm3.staticflickr.com/2859/13414033393_ec46db015e.jpg" width="500" height="475" alt="スクリーンショット 2014-03-26 7.44.11"></p>

<h2>RStudioのすすめ</h2>

<p>以下オススメリンク。</p>

<p><strong><a href="http://www.rstudio.com/ide/download/desktop">デスクトップアプリ R用のIDE: RStudio</a></strong><br/>
RのIDEツール。主な機能、使い方は次の通り。</p>

<pre>
1) RStudioのコード補完や、関数へのジャンプ、組み込み関数のソース閲覧機能
2) Apacheとの連携によるレポート表示、Emailでのレポート配信
3) Gitによるソースコード管理のサポート機能
</pre>


<p><strong><a href="http://yihui.name/knitr/">knitr</a></strong><br/>
RStudio上でReproducible Researchを実現するためのパッケージ。Markdown, Rファイル => HTMLへの変換を行う事ができる。また、後述のRPubsへのアップロード機能も備える。</p>

<p><strong><a href="https://rpubs.com/">RPubs</a></strong><br/>
RStudio.comが提供するサービス。再現可能な研究(Reproducible Research)を実現するために、Rの実行手順などをWebでシェアできるサービス。</p>

<p><strong><a href="http://www.rstudio.com/ide/download/server">RStudio Server</a></strong><br/>
RStudioのWebアプリケーション版。</p>

<h2>Pythonによる機械学習</h2>

<p>Pythonで使えるデータ分析に有効なライブラリ群についての紹介。</p>

<h3>データ分析と機械学習</h3>

<p>データ分析において、機械学習は単なる手段の一つ。</p>

<pre>
* ある説明変数に対して目的変数がどのくらい影響を与えているかを知ることができる
* 複数の変数から重要な変数を絞り込む事ができる
</pre>


<h3>Python環境の準備</h3>

<p>もしMachのPython環境を作る場合は、拙著<strong>[Python開発環境構築 徹底解説<a href="python-pyenv-rehash-mac-development">pyenv, mac</a></strong>がオススメです。</p>

<h3>Python のライブラリ</h3>

<p>利用するライブラリのインストール。</p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="c"># 効率的な数値計算のためのライブラリ</span>
</span><span class='line'>pip install numpy
</span><span class='line'>
</span><span class='line'><span class="c"># 最適化、補間、積分、統計、画像処理、クラスタリング解析、信号処理、空間的解析などができる</span>
</span><span class='line'>pip install scipy
</span><span class='line'>
</span><span class='line'><span class="c"># matplotlibのインストール用の設定</span>
</span><span class='line'>ln -s /usr/local/opt/freetype/include/freetype2 /usr/local/include/freetype
</span><span class='line'>
</span><span class='line'><span class="c"># グラフ描画ライブラリ</span>
</span><span class='line'>pip install matplotlib
</span><span class='line'>
</span><span class='line'><span class="c"># ファイルを作成してパラメータを記述</span>
</span><span class='line'>vim ~/.matplotlib/matplotlibrc
</span><span class='line'><span class="c"># ↓ 以下を追加</span>
</span><span class='line'>backend : TkAgg
</span><span class='line'>
</span><span class='line'><span class="c"># 機械学習ライブラリ: 単回帰分析〜SVMなどまで対応</span>
</span><span class='line'><span class="c"># 教師あり学習、教師なし学習、モデル選択のためのクロスバリデーション</span>
</span><span class='line'>pip install scikit-learn
</span><span class='line'>
</span><span class='line'><span class="c"># データ構造・データ解析のライブラリ：Rのdata.frameなどがある</span>
</span><span class='line'>pip install pandas
</span><span class='line'>
</span><span class='line'><span class="c"># PythonからR言語を呼び出すためのライブラリ</span>
</span><span class='line'>pip install rpy2
</span><span class='line'>
</span><span class='line'><span class="c"># pythonを対話的に実行するためのライブラリ</span>
</span><span class='line'>pip install ipython
</span></code></pre></td></tr></table></div></figure>


<h3>あやめのデータを知る</h3>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
<span class='line-number'>87</span>
<span class='line-number'>88</span>
<span class='line-number'>89</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>wget https://dataminingproject.googlecode.com/svn-history/r44/DataMiningApp/datasets/Iris/iris.csv
</span><span class='line'>
</span><span class='line'><span class="c"># IRIS.csvのあるフォルダでipythonを起動</span>
</span><span class='line'>ipython
</span><span class='line'>
</span><span class='line'><span class="c"># iris.csvを読み込み</span>
</span><span class='line'>import pandas as pd
</span><span class='line'><span class="nv">iris</span> <span class="o">=</span> pd.read_csv<span class="o">(</span><span class="s2">&quot;iris.csv&quot;</span><span class="o">)</span>
</span><span class='line'>iris.info<span class="o">()</span>
</span><span class='line'>
</span><span class='line'><span class="c"># データ加工</span>
</span><span class='line'><span class="nv">setosa</span> <span class="o">=</span> iris<span class="o">[</span>iris<span class="o">[</span><span class="s2">&quot;Species&quot;</span><span class="o">]</span> <span class="o">==</span> <span class="s2">&quot;setosa&quot;</span><span class="o">]</span>
</span><span class='line'><span class="nv">versicolor</span> <span class="o">=</span> iris<span class="o">[</span>iris<span class="o">[</span><span class="s2">&quot;Species&quot;</span><span class="o">]</span> <span class="o">==</span> <span class="s2">&quot;versicolor&quot;</span><span class="o">]</span>
</span><span class='line'><span class="nv">virginica</span> <span class="o">=</span> iris<span class="o">[</span>iris<span class="o">[</span><span class="s2">&quot;Species&quot;</span><span class="o">]</span> <span class="o">==</span> <span class="s2">&quot;virginica&quot;</span><span class="o">]</span>
</span><span class='line'>
</span><span class='line'><span class="c"># 基本的な統計量 ###########################</span>
</span><span class='line'><span class="c"># 合計</span>
</span><span class='line'>virginica.sum<span class="o">()</span>
</span><span class='line'><span class="c"># Sepal Length                                                329.4</span>
</span><span class='line'><span class="c"># Sepal Width                                                 148.7</span>
</span><span class='line'><span class="c"># Petal Length                                                277.6</span>
</span><span class='line'><span class="c"># Petal Width                                                 101.3</span>
</span><span class='line'>
</span><span class='line'><span class="c"># 平均</span>
</span><span class='line'>virginica.mean<span class="o">()</span>
</span><span class='line'><span class="c"># Sepal Length    6.588</span>
</span><span class='line'><span class="c"># Sepal Width     2.974</span>
</span><span class='line'><span class="c"># Petal Length    5.552</span>
</span><span class='line'><span class="c"># Petal Width     2.026</span>
</span><span class='line'>
</span><span class='line'><span class="c"># 中央値</span>
</span><span class='line'>virginica.median<span class="o">()</span>
</span><span class='line'><span class="c"># Sepal Length    6.50</span>
</span><span class='line'><span class="c"># Sepal Width     3.00</span>
</span><span class='line'><span class="c"># Petal Length    5.55</span>
</span><span class='line'><span class="c"># Petal Width     2.00</span>
</span><span class='line'>
</span><span class='line'><span class="c"># 最小値</span>
</span><span class='line'>verginica.min<span class="o">()</span>
</span><span class='line'><span class="c"># Sepal Length          4.9</span>
</span><span class='line'><span class="c"># Sepal Width           2.2</span>
</span><span class='line'><span class="c"># Petal Length          4.5</span>
</span><span class='line'><span class="c"># Petal Width           1.4</span>
</span><span class='line'>
</span><span class='line'><span class="c"># 最大値</span>
</span><span class='line'>virginica.max<span class="o">()</span>
</span><span class='line'><span class="c"># Sepal Length          7.9</span>
</span><span class='line'><span class="c"># Sepal Width           3.8</span>
</span><span class='line'><span class="c"># Petal Length          6.9</span>
</span><span class='line'><span class="c"># Petal Width           2.5</span>
</span><span class='line'>
</span><span class='line'><span class="c"># 相関係数</span>
</span><span class='line'>virginica.corr<span class="o">()</span>
</span><span class='line'><span class="c">#               Sepal Length  Sepal Width  Petal Length  Petal Width</span>
</span><span class='line'><span class="c"># Sepal Length      1.000000     0.457228      0.864225     0.281108</span>
</span><span class='line'><span class="c"># Sepal Width       0.457228     1.000000      0.401045     0.537728</span>
</span><span class='line'><span class="c"># Petal Length      0.864225     0.401045      1.000000     0.322108</span>
</span><span class='line'><span class="c"># Petal Width       0.281108     0.537728      0.322108     1.000000</span>
</span><span class='line'>
</span><span class='line'><span class="c"># 分散</span>
</span><span class='line'>virginica.var<span class="o">()</span>
</span><span class='line'><span class="c"># Sepal Length    0.404343</span>
</span><span class='line'><span class="c"># Sepal Width     0.104004</span>
</span><span class='line'><span class="c"># Petal Length    0.304588</span>
</span><span class='line'><span class="c"># Petal Width     0.075433</span>
</span><span class='line'>
</span><span class='line'><span class="c"># 標準偏差</span>
</span><span class='line'>virginica.std<span class="o">()</span>
</span><span class='line'><span class="c"># Sepal Length    0.635880</span>
</span><span class='line'><span class="c"># Sepal Width     0.322497</span>
</span><span class='line'><span class="c"># Petal Length    0.551895</span>
</span><span class='line'><span class="c"># Petal Width     0.274650</span>
</span><span class='line'>
</span><span class='line'><span class="c"># 共分散</span>
</span><span class='line'>virginica.cov<span class="o">()</span>
</span><span class='line'><span class="c">#               Sepal Length  Sepal Width  Petal Length  Petal Width</span>
</span><span class='line'><span class="c"># Sepal Length      0.404343     0.093763      0.303290     0.049094</span>
</span><span class='line'><span class="c"># Sepal Width       0.093763     0.104004      0.071380     0.047629</span>
</span><span class='line'><span class="c"># Petal Length      0.303290     0.071380      0.304588     0.048824</span>
</span><span class='line'><span class="c"># Petal Width       0.049094     0.047629      0.048824     0.075433</span>
</span><span class='line'>
</span><span class='line'><span class="c"># ピポッテーブルの作成</span>
</span><span class='line'>import numpy as np
</span><span class='line'>pd.pivot_table<span class="o">(</span>iris, <span class="nv">rows</span><span class="o">=[</span><span class="s2">&quot;Species&quot;</span><span class="o">]</span>, <span class="nv">aggfunc</span><span class="o">=</span>np.mean<span class="o">)</span>
</span><span class='line'><span class="c">#             Petal Length  Petal Width  Sepal Length  Sepal Width</span>
</span><span class='line'><span class="c"># Species</span>
</span><span class='line'><span class="c"># setosa             1.464        0.244         5.006        3.418</span>
</span><span class='line'><span class="c"># versicolor         4.260        1.326         5.936        2.770</span>
</span><span class='line'><span class="c"># virginica          5.552        2.026         6.588        2.974</span>
</span></code></pre></td></tr></table></div></figure>


<h3>irisでヒストグラムの実行</h3>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>import matplotlib.pyplot as plt
</span><span class='line'>plt.hist<span class="o">(</span>iris<span class="o">[</span><span class="s2">&quot;Sepal Length&quot;</span><span class="o">])</span>
</span><span class='line'>plt.xlabel<span class="o">(</span><span class="s2">&quot;Sepal Length&quot;</span><span class="o">)</span>
</span><span class='line'>plt.ylabl<span class="o">(</span><span class="s2">&quot;Freq&quot;</span><span class="o">)</span>
</span><span class='line'>plt.show<span class="o">()</span>
</span></code></pre></td></tr></table></div></figure>


<p><img src="https://farm8.staticflickr.com/7021/13477008725_d1cb5034c1.jpg" width="500" height="379" alt="スクリーンショット 2014-03-29 9.37.35"></p>

<h3>箱ひげ図</h3>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">data</span> <span class="o">=</span> <span class="o">[</span>setosa<span class="o">[</span><span class="s2">&quot;Petal Length&quot;</span><span class="o">]</span>, versiclor<span class="o">[</span><span class="s2">&quot;Petal Length&quot;</span><span class="o">]</span>, virginica<span class="o">[</span><span class="s2">&quot;Petal Length&quot;</span><span class="o">]]</span>
</span><span class='line'>plt.boxplot<span class="o">(</span>data<span class="o">)</span>
</span><span class='line'>plt.xlabel<span class="o">(</span><span class="s2">&quot;Species&quot;</span><span class="o">)</span>
</span><span class='line'>plt.ylabel<span class="o">(</span><span class="s2">&quot;Petal Length&quot;</span><span class="o">)</span>
</span><span class='line'><span class="nv">ax</span> <span class="o">=</span> plt.gca<span class="o">()</span>
</span><span class='line'>plt.setp<span class="o">(</span>ax, <span class="nv">xticklabels</span><span class="o">=[</span><span class="s2">&quot;setosa&quot;</span>, <span class="s2">&quot;versicolor&quot;</span>, <span class="s2">&quot;virginica&quot;</span><span class="o">])</span>
</span><span class='line'>plt.show<span class="o">()</span>
</span></code></pre></td></tr></table></div></figure>


<p><img src="https://farm8.staticflickr.com/7411/13477223695_baeac09a8f.jpg" width="500" height="391" alt="スクリーンショット 2014-03-29 9.55.08"></p>

<h3>散布図</h3>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>plt.scatter<span class="o">(</span>versicolor<span class="o">[</span><span class="s2">&quot;Sepal Width&quot;</span><span class="o">]</span>, versicolor<span class="o">[</span><span class="s2">&quot;Petal Width&quot;</span><span class="o">])</span>
</span><span class='line'>plt.xlabel<span class="o">(</span><span class="s2">&quot;Sepal Width&quot;</span><span class="o">)</span>
</span><span class='line'>plt.ylabel<span class="o">(</span><span class="s2">&quot;Petal Width&quot;</span><span class="o">)</span>
</span><span class='line'>plt.show<span class="o">()</span>
</span></code></pre></td></tr></table></div></figure>


<p><img src="https://farm8.staticflickr.com/7239/13477676814_035b5d164d.jpg" width="500" height="392" alt="スクリーンショット 2014-03-29 10.01.24"></p>

<h3>相関係数</h3>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="c"># versicolorのSepal WidthとPetal Widthの相関係数</span>
</span><span class='line'>import numpy as np
</span><span class='line'><span class="nv">corr</span> <span class="o">=</span> np.corrcoef<span class="o">(</span>versicolor<span class="o">[</span><span class="s2">&quot;Sepal Width&quot;</span><span class="o">]</span>, versicolor<span class="o">[</span><span class="s2">&quot;Petal Width&quot;</span><span class="o">])</span>
</span><span class='line'>print<span class="o">(</span>corr<span class="o">[</span>0,1<span class="o">])</span>
</span><span class='line'><span class="c">#=&gt; 0.663998720024</span>
</span></code></pre></td></tr></table></div></figure>


<h3>単回帰分析</h3>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>from sklearn import linear_model
</span><span class='line'><span class="nv">LinerRegr</span> <span class="o">=</span> linear_model.LinearRegression<span class="o">()</span>
</span><span class='line'><span class="nv">X</span> <span class="o">=</span> setosa<span class="o">[[</span><span class="s2">&quot;Sepal Length&quot;</span><span class="o">]]</span>
</span><span class='line'><span class="nv">Y</span> <span class="o">=</span> setosa<span class="o">[[</span><span class="s2">&quot;Sepal Width&quot;</span><span class="o">]]</span>
</span><span class='line'>LinerRegr.fit<span class="o">(</span>X, Y<span class="o">)</span>
</span><span class='line'>plt.scatter<span class="o">(</span>X, Y, <span class="nv">color</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="o">)</span>
</span><span class='line'><span class="nv">px</span> <span class="o">=</span> np.arange<span class="o">(</span>X.min<span class="o">()</span>, X.max<span class="o">()</span>, .01<span class="o">)[</span>:,np.newaxis<span class="o">]</span>
</span><span class='line'><span class="nv">py</span> <span class="o">=</span> LinerRegr.predict<span class="o">(</span>px<span class="o">)</span>
</span><span class='line'>plt.plot<span class="o">(</span>px, py, <span class="nv">color</span><span class="o">=</span><span class="s2">&quot;blue&quot;</span>, <span class="nv">linewidth</span><span class="o">=</span>3<span class="o">)</span>
</span><span class='line'>plt.xlabel<span class="o">(</span><span class="s2">&quot;Sepal Length&quot;</span><span class="o">)</span>
</span><span class='line'>plt.ylabel<span class="o">(</span><span class="s2">&quot;Sepal Width&quot;</span><span class="o">)</span>
</span><span class='line'>plt.show<span class="o">()</span>
</span></code></pre></td></tr></table></div></figure>


<p><img src="https://farm6.staticflickr.com/5281/13478622995_e46e9712f8.jpg" width="500" height="385" alt="スクリーンショット 2014-03-29 11.43.26"></p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="c"># 回帰変数</span>
</span><span class='line'>print<span class="o">(</span>LinerRegr.coef_<span class="o">)</span>
</span><span class='line'><span class="c">#=&gt; [[ 0.80723367]]</span>
</span><span class='line'>
</span><span class='line'><span class="c"># 切片</span>
</span><span class='line'>print<span class="o">(</span>LinerRegr.inercept_<span class="o">)</span>
</span><span class='line'><span class="c">#=&gt; [-0.62301173]</span>
</span></code></pre></td></tr></table></div></figure>


<h3>Rの機能を使って重回帰分析 => rpy2</h3>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>import rpy2.robjects as robjects
</span><span class='line'>robjects.globalenv<span class="o">[</span><span class="s2">&quot;SepalLength&quot;</span><span class="o">]</span> <span class="o">=</span> robjects.FloatVector<span class="o">(</span>setosa<span class="o">[</span><span class="s2">&quot;Sepal Length&quot;</span><span class="o">])</span>
</span><span class='line'>robjects.globalenv<span class="o">[</span><span class="s2">&quot;SepalWidth&quot;</span><span class="o">]</span> <span class="o">=</span> robjects.FloatVector<span class="o">(</span>setosa<span class="o">[</span><span class="s2">&quot;Sepal Width&quot;</span><span class="o">])</span>
</span><span class='line'>robjects.globalenv<span class="o">[</span><span class="s2">&quot;PetalLength&quot;</span><span class="o">]</span> <span class="o">=</span> robjects.FloatVector<span class="o">(</span>setosa<span class="o">[</span><span class="s2">&quot;Petal Length&quot;</span><span class="o">])</span>
</span><span class='line'>robjects.globalenv<span class="o">[</span><span class="s2">&quot;PetalWidth&quot;</span><span class="o">]</span> <span class="o">=</span> robjects.FloatVector<span class="o">(</span>setosa<span class="o">[</span><span class="s2">&quot;Petal Width&quot;</span><span class="o">])</span>
</span><span class='line'><span class="nv">r</span> <span class="o">=</span> robjects.r
</span><span class='line'>
</span><span class='line'><span class="c"># Rの重回帰分析</span>
</span><span class='line'><span class="nv">rlm</span> <span class="o">=</span> r.lm<span class="o">(</span><span class="s2">&quot;SepalWidth~SepalLength+PetalLength+PetalWidth&quot;</span><span class="o">)</span>
</span><span class='line'>print<span class="o">((</span>r.summary<span class="o">(</span>rlm<span class="o">)))</span>
</span><span class='line'><span class="c"># Residuals:</span>
</span><span class='line'><span class="c">#      Min       1Q   Median       3Q      Max</span>
</span><span class='line'><span class="c"># -0.75025 -0.17983 -0.00411  0.15933  0.57704</span>
</span><span class='line'><span class="c">#</span>
</span><span class='line'><span class="c"># Coefficients:</span>
</span><span class='line'><span class="c">#             Estimate Std. Error t value Pr(&gt;|t|)</span>
</span><span class='line'><span class="c"># (Intercept) -0.48721    0.56900  -0.856    0.396</span>
</span><span class='line'><span class="c"># SepalLength  0.79304    0.11162   7.105 6.35e-09 ***</span>
</span><span class='line'><span class="c"># PetalLength -0.09678    0.22875  -0.423    0.674</span>
</span><span class='line'><span class="c"># PetalWidth   0.31530    0.37186   0.848    0.401</span>
</span><span class='line'><span class="c"># ---</span>
</span><span class='line'><span class="c"># Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1</span>
</span><span class='line'><span class="c">#</span>
</span><span class='line'><span class="c"># Residual standard error: 0.2594 on 46 degrees of freedom</span>
</span><span class='line'><span class="c"># Multiple R-squared:  0.5649,  Adjusted R-squared:  0.5366</span>
</span><span class='line'><span class="c"># F-statistic: 19.91 on 3 and 46 DF,  p-value: 2.042e-08</span>
</span></code></pre></td></tr></table></div></figure>


<h3>ダミー変数の利用</h3>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="c"># 数値データ以外も分析に活用する</span>
</span><span class='line'><span class="c"># Spiciesをダミー変数(品種の0/1のカラム)に変換</span>
</span><span class='line'>import pandas as pd
</span><span class='line'><span class="nv">dummies</span> <span class="o">=</span> pd.get_dummies<span class="o">(</span>iris<span class="o">[</span><span class="s2">&quot;Species&quot;</span><span class="o">])</span>
</span><span class='line'><span class="nv">iris</span> <span class="o">=</span> pd.concat<span class="o">([</span>iris, dummies<span class="o">]</span>, <span class="nv">axis</span><span class="o">=</span>1<span class="o">)</span>
</span></code></pre></td></tr></table></div></figure>


<h3>回帰係数と切片を求める</h3>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">LinearRegr</span> <span class="o">=</span> linear_model.LinearRegression<span class="o">()</span>
</span><span class='line'><span class="nv">X</span> <span class="o">=</span> iris<span class="o">[[</span><span class="s2">&quot;setosa&quot;</span>, <span class="s2">&quot;versicolor&quot;</span><span class="o">]]</span>
</span><span class='line'><span class="nv">Y</span> <span class="o">=</span> iris<span class="o">[[</span><span class="s2">&quot;Sepal Length&quot;</span><span class="o">]]</span>
</span><span class='line'>LinearRegr.fit<span class="o">(</span>X, Y<span class="o">)</span>
</span><span class='line'>
</span><span class='line'><span class="c"># 回帰係数</span>
</span><span class='line'>print<span class="o">(</span>LinearRegr.coef_<span class="o">)</span> <span class="c">#=&gt; [[-1.582 -0.652]]</span>
</span><span class='line'>
</span><span class='line'><span class="c"># 切片</span>
</span><span class='line'>print<span class="o">(</span>LinearRegr.intercept_<span class="o">)</span> <span class="c">#=&gt; [ 6.588]</span>
</span></code></pre></td></tr></table></div></figure>


<h3>　データマイニングの流れ</h3>

<pre>
1) ゴールを決める
2) 変数の種類・表している事象を知る
3) 1変量の解析を行う。平均値を算出し、ヒストグラム・箱ひげ図を描写
4) 2変量の解析を行う。散布図などのグラフから理解を深める
5) 説明変数を減らして、解釈しやすいモデルに当てはめる
6) 推定された結果を(2)-(4)に振り返ってモデル検証を行う
</pre>


<h3>ロジスティック回帰モデル</h3>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>import sklearn
</span><span class='line'><span class="nv">use_data</span> <span class="o">=</span> np.logical_or<span class="o">(</span>iris<span class="o">[</span><span class="s2">&quot;Species&quot;</span><span class="o">]</span> <span class="o">==</span> <span class="s2">&quot;setosa&quot;</span>, iris<span class="o">[</span><span class="s2">&quot;Species&quot;</span><span class="o">]</span> <span class="o">==</span> <span class="s2">&quot;virginica&quot;</span><span class="o">)</span>
</span><span class='line'><span class="nv">setosa_virginica</span> <span class="o">=</span> iris<span class="o">[</span>use_data<span class="o">]</span>
</span><span class='line'><span class="nv">X</span> <span class="o">=</span> setosa_virginica<span class="o">[[</span><span class="s2">&quot;Sepal Length&quot;</span>, <span class="s2">&quot;Sepal Width&quot;</span><span class="o">]]</span>
</span><span class='line'><span class="nv">Y</span> <span class="o">=</span> setosa_virginica<span class="o">[[</span><span class="s2">&quot;setosa&quot;</span><span class="o">]]</span>
</span><span class='line'><span class="nv">LogRegr</span> <span class="o">=</span> sklearn.linear_model.LogisticRegression<span class="o">(</span><span class="nv">C</span><span class="o">=</span>1.0<span class="o">)</span>
</span><span class='line'>LogRegr.fit<span class="o">(</span>X,Y<span class="o">)</span>
</span><span class='line'>
</span><span class='line'><span class="c"># 偏回帰係数</span>
</span><span class='line'>print<span class="o">(</span>LogRegr.coef_<span class="o">)</span>
</span><span class='line'><span class="c">#=&gt; [[-2.15056433  3.53948104]]</span>
</span><span class='line'>
</span><span class='line'><span class="c"># 切片</span>
</span><span class='line'>print<span class="o">(</span>LogRegr.intercept_<span class="o">)</span>
</span><span class='line'><span class="c">#=&gt; [ 0.94024115]</span>
</span></code></pre></td></tr></table></div></figure>


<p>なんか間違っている気がするので、後で直す予定です。まずはちょっと触れるところから。</p>

<h3>モデル結果をグラフにして確認</h3>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">xMin</span> <span class="o">=</span> X<span class="o">[</span><span class="s2">&quot;Sepal Length&quot;</span><span class="o">]</span>.min<span class="o">()</span>
</span><span class='line'><span class="nv">xMax</span> <span class="o">=</span> X<span class="o">[</span><span class="s2">&quot;Sepal Length&quot;</span><span class="o">]</span>.max<span class="o">()</span>
</span><span class='line'><span class="nv">yMin</span> <span class="o">=</span> X<span class="o">[</span><span class="s2">&quot;Sepal Width&quot;</span><span class="o">]</span>.min<span class="o">()</span>
</span><span class='line'><span class="nv">yMax</span> <span class="o">=</span> X<span class="o">[</span><span class="s2">&quot;Sepal Width&quot;</span><span class="o">]</span>.max<span class="o">()</span>
</span><span class='line'>xx,yy <span class="o">=</span> np.meshgrid<span class="o">(</span>np.arange<span class="o">(</span>xMin, xMax, 0.01<span class="o">)</span>, np.arange<span class="o">(</span>yMin, yMax, 0.01<span class="o">))</span>
</span><span class='line'><span class="nv">Z</span> <span class="o">=</span> LogRegr.predict<span class="o">(</span>np.c_<span class="o">[</span>xx.ravel<span class="o">()</span>, yy.ravel<span class="o">()])</span>
</span><span class='line'><span class="nv">Z</span> <span class="o">=</span> Z.reshape<span class="o">(</span>xx.shape<span class="o">)</span>
</span><span class='line'>plt.figure<span class="o">()</span>
</span><span class='line'>plt.xlim<span class="o">(</span>xx.min<span class="o">()</span>, xx.max<span class="o">())</span>
</span><span class='line'>plt.ylim<span class="o">(</span>yy.min<span class="o">()</span>, yy.max<span class="o">())</span>
</span><span class='line'>plt.xlabel<span class="o">(</span><span class="s2">&quot;Sepal Length&quot;</span><span class="o">)</span>
</span><span class='line'>plt.ylabel<span class="o">(</span><span class="s2">&quot;Sepal Width&quot;</span><span class="o">)</span>
</span><span class='line'>plt.pcolormesh<span class="o">(</span>xx, yy, Z, <span class="nv">cmap</span><span class="o">=</span>plt.cm.Paired<span class="o">)</span>
</span><span class='line'>plt.scatter<span class="o">(</span>X<span class="o">[</span><span class="s2">&quot;Sepal Length&quot;</span><span class="o">]</span>, X<span class="o">[</span><span class="s2">&quot;Sepal Width&quot;</span><span class="o">]</span>, <span class="nv">c</span><span class="o">=</span>np.array<span class="o">(</span>Y<span class="o">)</span>, <span class="nv">cmap</span><span class="o">=</span>plt.cm.Paired<span class="o">)</span>
</span><span class='line'>plt.show<span class="o">()</span>
</span></code></pre></td></tr></table></div></figure>


<p><img src="https://farm8.staticflickr.com/7097/13482940784_02c88ebeb3.jpg" width="500" height="389" alt="スクリーンショット 2014-03-29 17.36.16"></p>

<h2>決定木</h2>

<p>まずはhomebrewでGraphvizとpythonで使うためのライブラリpydotをインストール。</p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>brew update
</span><span class='line'>brew install gts
</span><span class='line'>brew install graphviz
</span><span class='line'>
</span><span class='line'>pip uninstall pyparsing
</span><span class='line'>pip install -Iv https://pypi.python.org/packages/source/p/pyparsing/pyparsing-1.5.7.tar.gz#md5<span class="o">=</span>9be0fcdcc595199c646ab317c1d9a709
</span><span class='line'>pip install pydot
</span></code></pre></td></tr></table></div></figure>


<p>続いてIPythonのコンソール。</p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>from sklearn import tree
</span><span class='line'><span class="nv">X</span> <span class="o">=</span> iris<span class="o">[[</span><span class="s2">&quot;Sepal Length&quot;</span>, <span class="s2">&quot;Sepal Width&quot;</span>, <span class="s2">&quot;Petal Length&quot;</span>, <span class="s2">&quot;Petal Width&quot;</span><span class="o">]]</span>
</span><span class='line'><span class="nv">Y</span> <span class="o">=</span> iris<span class="o">[[</span><span class="s2">&quot;Species&quot;</span><span class="o">]]</span>
</span><span class='line'><span class="nv">treeClf</span> <span class="o">=</span> tree.DecisionTreeClassifier<span class="o">(</span><span class="nv">max_depth</span><span class="o">=</span>2<span class="o">)</span>
</span><span class='line'>treeClf.fit<span class="o">(</span>X, Y<span class="o">)</span>
</span></code></pre></td></tr></table></div></figure>


<h3>決定木</h3>

<p>同じくグラフがなんか違うので、後で見直す予定。</p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="c">## 決定木の構築</span>
</span><span class='line'>from sklearn import tree
</span><span class='line'><span class="nv">X</span> <span class="o">=</span> iris<span class="o">[[</span><span class="s2">&quot;Sepal Length&quot;</span>, <span class="s2">&quot;Sepal Width&quot;</span>, <span class="s2">&quot;Petal Length&quot;</span>, <span class="s2">&quot;Petal Width&quot;</span><span class="o">]]</span>
</span><span class='line'><span class="nv">Y</span> <span class="o">=</span> iris<span class="o">[[</span><span class="s2">&quot;Species&quot;</span><span class="o">]]</span>
</span><span class='line'><span class="nv">treeClf</span> <span class="o">=</span> tree.DecisionTreeClassifier<span class="o">(</span><span class="nv">max_depth</span><span class="o">=</span>2<span class="o">)</span>
</span><span class='line'>treeClf.fit<span class="o">(</span>X, Y<span class="o">)</span>
</span><span class='line'>
</span><span class='line'><span class="c">## 決定木の可視化</span>
</span><span class='line'>import StringIO
</span><span class='line'>import pydot
</span><span class='line'><span class="nv">dot_data</span> <span class="o">=</span> StringIO.StringIO<span class="o">()</span>
</span><span class='line'>tree.export_graphviz<span class="o">(</span>treeClf, <span class="nv">out_file</span><span class="o">=</span>dot_data, <span class="nv">feature_names</span><span class="o">=[</span><span class="s2">&quot;Sepal Length&quot;</span>, <span class="s2">&quot;Sepal Width&quot;</span>, <span class="s2">&quot;Petal Length&quot;</span>, <span class="s2">&quot;Petal Width&quot;</span><span class="o">])</span>
</span><span class='line'><span class="nv">graph</span> <span class="o">=</span> pydot.graph_from_dot_data<span class="o">(</span>dot_data.getvalue<span class="o">())</span>
</span><span class='line'>graph.write_pdf<span class="o">(</span><span class="s2">&quot;iris_decision_tree.pdf&quot;</span><span class="o">)</span>
</span></code></pre></td></tr></table></div></figure>


<p><img src="https://farm8.staticflickr.com/7051/13483376885_725bd15d81.jpg" width="500" height="313" alt="スクリーンショット 2014-03-29 18.43.37"></p>

<h3>k-means法</h3>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="c"># k-meansの実行</span>
</span><span class='line'>from sklearn import cluster
</span><span class='line'><span class="nv">X</span> <span class="o">=</span> iris<span class="o">[[</span><span class="s2">&quot;Sepal Length&quot;</span>, <span class="s2">&quot;Sepal Width&quot;</span><span class="o">]]</span>
</span><span class='line'><span class="nv">kmeansCls</span> <span class="o">=</span> cluster.KMeans<span class="o">(</span><span class="nv">n_clusters</span><span class="o">=</span>3<span class="o">)</span>
</span><span class='line'>kmeansCls.fit<span class="o">(</span>X<span class="o">)</span>
</span><span class='line'>print<span class="o">(</span>kmeansCls.predict<span class="o">(</span>X<span class="o">))</span>
</span><span class='line'><span class="c"># [0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0</span>
</span><span class='line'><span class="c">#  0 0 0 0 0 0 0 0 0 0 0 0 0 1 1 2 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1</span>
</span><span class='line'><span class="c">#  1 1 1 2 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 2 1 2 2 2 2 1 2 2 2 2</span>
</span><span class='line'><span class="c">#  2 2 1 1 2 2 2 2 1 2 1 2 1 2 2 1 1 2 2 2 2 2 1 2 2 2 2 1 2 2 2 1 2 2 2 1 2</span>
</span><span class='line'><span class="c">#  2 1]</span>
</span><span class='line'>
</span><span class='line'><span class="c"># k-means法の可視化</span>
</span><span class='line'>import numpy as np
</span><span class='line'>import matplotlib.pyplot as plt
</span><span class='line'>def category2int<span class="o">(</span>x<span class="o">)</span>:
</span><span class='line'>    <span class="nv">category</span> <span class="o">=</span> <span class="o">{</span><span class="s2">&quot;setosa&quot;</span>: 0, <span class="s2">&quot;versicolor&quot;</span>: 1, <span class="s2">&quot;virginica&quot;</span>: 2<span class="o">}</span>
</span><span class='line'>    <span class="k">return </span>category<span class="o">[</span>x<span class="o">]</span>
</span><span class='line'>
</span><span class='line'><span class="nv">f</span> <span class="o">=</span> lambda x: category2int<span class="o">(</span>x<span class="o">)</span>
</span><span class='line'><span class="nv">Y</span> <span class="o">=</span> iris<span class="o">[</span><span class="s2">&quot;Species&quot;</span><span class="o">]</span>.map<span class="o">(</span>f<span class="o">)</span>
</span><span class='line'><span class="nv">xMin</span> <span class="o">=</span> X<span class="o">[</span><span class="s2">&quot;Sepal Length&quot;</span><span class="o">]</span>.min<span class="o">()</span>
</span><span class='line'><span class="nv">xMax</span> <span class="o">=</span> X<span class="o">[</span><span class="s2">&quot;Sepal Length&quot;</span><span class="o">]</span>.max<span class="o">()</span>
</span><span class='line'><span class="nv">yMin</span> <span class="o">=</span> X<span class="o">[</span><span class="s2">&quot;Sepal Width&quot;</span><span class="o">]</span>.min<span class="o">()</span>
</span><span class='line'><span class="nv">yMax</span> <span class="o">=</span> X<span class="o">[</span><span class="s2">&quot;Sepal Width&quot;</span><span class="o">]</span>.max<span class="o">()</span>
</span><span class='line'>xx,yy <span class="o">=</span> np.meshgrid<span class="o">(</span>np.arange<span class="o">(</span>xMin, xMax, 0.01<span class="o">)</span>, np.arange<span class="o">(</span>yMin, yMax, 0.01<span class="o">))</span>
</span><span class='line'><span class="nv">Z</span> <span class="o">=</span> kmeansCls.predict<span class="o">(</span>np.c_<span class="o">[</span>xx.ravel<span class="o">()</span>, yy.ravel<span class="o">()])</span>
</span><span class='line'><span class="nv">Z</span> <span class="o">=</span> Z.reshape<span class="o">(</span>xx.shape<span class="o">)</span>
</span><span class='line'>plt.figure<span class="o">()</span>
</span><span class='line'>plt.xlim<span class="o">(</span>xx.min<span class="o">()</span>, xx.max<span class="o">())</span>
</span><span class='line'>plt.ylim<span class="o">(</span>yy.min<span class="o">()</span>, yy.max<span class="o">())</span>
</span><span class='line'>plt.xlabel<span class="o">(</span><span class="s2">&quot;Sepal Length&quot;</span><span class="o">)</span>
</span><span class='line'>plt.ylabel<span class="o">(</span><span class="s2">&quot;Sepal Width&quot;</span><span class="o">)</span>
</span><span class='line'>plt.pcolormesh<span class="o">(</span>xx, yy, Z, <span class="nv">cmap</span><span class="o">=</span>plt.cm.Reds<span class="o">)</span>
</span><span class='line'>plt.scatter<span class="o">(</span>X<span class="o">[</span><span class="s2">&quot;Sepal Length&quot;</span><span class="o">]</span>, X<span class="o">[</span><span class="s2">&quot;Sepal Width&quot;</span><span class="o">]</span>, <span class="nv">c</span><span class="o">=</span>np.array<span class="o">(</span>Y<span class="o">)</span>, <span class="nv">cmap</span><span class="o">=</span>plt.cm.Blues<span class="o">)</span>
</span><span class='line'>plt.show<span class="o">()</span>
</span></code></pre></td></tr></table></div></figure>


<p><img src="https://farm8.staticflickr.com/7021/13483696374_cef951e923.jpg" width="500" height="384" alt="スクリーンショット 2014-03-29 18.40.37"></p>

<h2>データマイニング 10のアルゴリズム</h2>

<h3>C4.5</h3>

<pre>
* 決定木を構築する計算アルゴリズム
* 結果のイメージが直感的て理解しやすい
* 分類の精度は高くない
</pre>


<h3>k-meansアルゴリズム</h3>

<p>クラスタリングでは次のステップを反復して計算。</p>

<pre>
1) データにクラスタを割り振る(中心と一番近いクラスタを割り振る)
2) クラスタ事の平均値の計算
</pre>


<h3>サポートベクターマシン</h3>

<pre>
* 少なめのサンプルで説明変数が多い場合に適した手法
* SVMは特徴量が膨大でも高速に計算できる
* サンプル数が増えると計算時間が急に増加する
</pre>


<h3>アプリオリアルゴリズム</h3>

<pre>
* 大量のトランザクションの中から価値あるつながりを見つけるために使われる手法
* 強力な結果が得られる上、実装が比較的容易
</pre>


<h3>EMアルゴリズム</h3>

<p>Expectation-maximization algorithm(期待値最大化法)。数式展開では計算出来ないような複雑なモデルのパラメータ推定に用いる。以下はその手順。</p>

<pre>
1) パラメータの初期値を決める
2) Exceptationステップ: 未観測データの期待値を求める
3) Maximizationステップ: 未観測データの期待値を求める
</pre>


<h3>アダブースト</h3>

<pre>
* いくつかの学習木を組み合わせることで、強力な予測性能を得る
* 実装が容易で解釈がしやすい
* ディープラーニングが出るまでは最も有力な予測モデルと言われてきた
</pre>


<h3>ナイーブベイズ</h3>

<pre>
* クラスを予測するための手法で構築が容易
* テキスト分類やパターン認識で広く利用されている
</pre>




<div>
  <script type="text/javascript"><!--
  google_ad_client = "ca-pub-4186413323075068";
  /* middle_yoko_naga2 */
  google_ad_slot = "4362325392";
  google_ad_width = 728;
  google_ad_height = 90;
  //-->
  </script>
  <script type="text/javascript"
          src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
  </script>
</div>


<h2>Rによるマーケティング分析</h2>

<p><strong><a href="http://www.slideshare.net/yokkuns/r-22276096">R言語で学ぶマーケティング分析 競争ポジショニング戦略</a></strong><br/>
この記事の作者さんの発表。エッセンスがうまくまとまっています。</p>

<h4>主成分分析の実行</h4>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>setwd<span class="o">(</span><span class="s2">&quot;~/Dropbox/study-R/&quot;</span><span class="o">)</span>
</span><span class='line'><span class="c"># データの読み込み</span>
</span><span class='line'>sp.user.data &lt;- read.csv<span class="o">(</span><span class="s2">&quot;data/sp_user_research_data.csv&quot;</span><span class="o">)</span>
</span><span class='line'>
</span><span class='line'><span class="c"># 主成分分析 =&gt; ユーザー間の類似関係の把握</span>
</span><span class='line'>sp.user.pca &lt;- prcomp<span class="o">(</span>sp.user.data<span class="o">[</span>,-1<span class="o">]</span>, <span class="nv">scale</span> <span class="o">=</span>T<span class="o">)</span>
</span><span class='line'>
</span><span class='line'><span class="c"># バイプロットの表示</span>
</span><span class='line'>biplot<span class="o">(</span>sp.user.pca<span class="o">)</span>
</span></code></pre></td></tr></table></div></figure>


<p><img src="https://farm8.staticflickr.com/7385/13503111214_0e5f8a5458.jpg" width="500" height="461" alt="スクリーンショット 2014-03-30 13.33.16"></p>

<h3>k-meansによるクラスタリングの実行</h3>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>sp.user.km &lt;- kmeans<span class="o">(</span>sp.user.data<span class="o">[</span>,-1<span class="o">]</span>, 4<span class="o">)</span>
</span><span class='line'>
</span><span class='line'><span class="c"># 主成分分析の結果にクラスタ情報を付与</span>
</span><span class='line'>sp.user.pca.df &lt;- data.frame<span class="o">(</span>sp.user.pca<span class="nv">$x</span><span class="o">)</span>
</span><span class='line'>sp.user.pca.df<span class="nv">$id</span> &lt;- sp.user.data<span class="nv">$id</span>
</span><span class='line'>sp.user.pca.df<span class="nv">$cluster</span> &lt;- as.factor<span class="o">(</span>sp.user.km<span class="nv">$cluster</span><span class="o">)</span>
</span><span class='line'>
</span><span class='line'><span class="c"># 描画</span>
</span><span class='line'>install.packages<span class="o">(</span><span class="s2">&quot;ggplot2&quot;</span><span class="o">)</span>
</span><span class='line'>library<span class="o">(</span><span class="s2">&quot;ggplot2&quot;</span><span class="o">)</span>
</span><span class='line'>ggplot<span class="o">(</span>sp.user.pca.df, aes<span class="o">(</span><span class="nv">x</span> <span class="o">=</span> PC1, <span class="nv">y</span> <span class="o">=</span> PC2, <span class="nv">label</span> <span class="o">=</span> id, <span class="nv">col</span> <span class="o">=</span> cluster<span class="o">))</span> + geom_text<span class="o">()</span> + theme_bw<span class="o">(</span>16<span class="o">)</span>
</span></code></pre></td></tr></table></div></figure>


<p><img src="https://farm3.staticflickr.com/2894/13502876065_8f6ff5d2ca.jpg" width="500" height="361" alt="スクリーンショット 2014-03-30 13.40.50"></p>

<h3>レーダーチャートの作成</h3>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>install.packages<span class="o">(</span><span class="s2">&quot;fmsb&quot;</span><span class="o">)</span>
</span><span class='line'>library<span class="o">(</span><span class="s2">&quot;fmsb&quot;</span><span class="o">)</span>
</span><span class='line'>
</span><span class='line'><span class="c"># レーダーチャート用にデータを整形</span>
</span><span class='line'>df &lt;- data.frame<span class="o">(</span>scale<span class="o">(</span>sp.user.km<span class="nv">$centers</span><span class="o">))</span>
</span><span class='line'>dfmax &lt;- apply<span class="o">(</span>df, 2, max<span class="o">)</span> + 1
</span><span class='line'>dfmin &lt;- apply<span class="o">(</span>df, 2, min<span class="o">)</span> - 1
</span><span class='line'>df &lt;- rbind<span class="o">(</span>dfmax, dfmin, df<span class="o">)</span>
</span><span class='line'>
</span><span class='line'><span class="c"># レーダーチャートの描画</span>
</span><span class='line'>radarchart<span class="o">(</span>df, <span class="nv">seg</span> <span class="o">=</span> 5, <span class="nv">plty</span> <span class="o">=</span> 1, <span class="nv">pcol</span> <span class="o">=</span> rainbow<span class="o">(</span>4<span class="o">))</span>
</span><span class='line'>legend<span class="o">(</span><span class="s2">&quot;topright&quot;</span>, <span class="nv">legend</span> <span class="o">=</span> 1:4, <span class="nv">col</span> <span class="o">=</span> rainbow<span class="o">(</span>4<span class="o">)</span>, <span class="nv">lty</span> <span class="o">=</span> 1<span class="o">)</span>
</span></code></pre></td></tr></table></div></figure>


<p><img src="https://farm8.staticflickr.com/7019/13503401394_8b67f779c2.jpg" width="500" height="361" alt="スクリーンショット 2014-03-30 13.54.09"></p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="c">## MDS(Mult-dimentional scaling: 多次元尺度構成法) - 知覚マップ</span>
</span><span class='line'>install.packages<span class="o">(</span><span class="s2">&quot;MASS&quot;</span><span class="o">)</span>
</span><span class='line'>library<span class="o">(</span><span class="s2">&quot;MASS&quot;</span><span class="o">)</span>
</span><span class='line'>
</span><span class='line'><span class="c"># 先行データの読み込み</span>
</span><span class='line'>setwd<span class="o">(</span><span class="s2">&quot;~/Dropbox/study-R/data&quot;</span><span class="o">)</span>
</span><span class='line'>target.data &lt;- read.csv<span class="o">(</span><span class="s2">&quot;target_preference_data.csv&quot;</span>, <span class="nv">header</span> <span class="o">=</span> T<span class="o">)</span>
</span><span class='line'>
</span><span class='line'><span class="c"># 非計算MDSの実行</span>
</span><span class='line'>service.dist &lt;- dist<span class="o">(</span>t<span class="o">(</span>target.data<span class="o">[</span>, -1<span class="o">]))</span>
</span><span class='line'>service.map &lt;- isoMDS<span class="o">(</span>service.dist<span class="o">)</span>
</span><span class='line'>
</span><span class='line'><span class="c"># 描画用データの整形</span>
</span><span class='line'>service.map.df &lt;- data.frame<span class="o">(</span>scale<span class="o">(</span>service.map<span class="nv">$points</span><span class="o">))</span>
</span><span class='line'>service.map.df<span class="nv">$service_name</span> &lt;- names<span class="o">(</span>target.data<span class="o">[</span>, -1<span class="o">])</span>
</span><span class='line'>
</span><span class='line'><span class="c"># 描画</span>
</span><span class='line'>ggplot<span class="o">(</span>service.map.df, aes<span class="o">(</span><span class="nv">x</span> <span class="o">=</span> X1, <span class="nv">y</span> <span class="o">=</span> X2, <span class="nv">label</span> <span class="o">=</span> service_name<span class="o">))</span> + geom_text<span class="o">()</span> + theme_bw<span class="o">(</span>16<span class="o">)</span>
</span></code></pre></td></tr></table></div></figure>


<p><img src="https://farm4.staticflickr.com/3749/13503351383_77ffd5a8f6.jpg" width="500" height="309" alt="スクリーンショット 2014-03-30 14.07.50"></p>

<h3>選好ベクトルの推定</h3>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="c"># 選好ベクトルの推定</span>
</span><span class='line'>user.preference.data &lt;-
</span><span class='line'>  <span class="k">do</span>.call<span class="o">(</span>rbind,
</span><span class='line'>          lapply<span class="o">(</span>1:nrow<span class="o">(</span>target.data<span class="o">)</span>,
</span><span class='line'>                 <span class="k">function</span><span class="o">(</span>i<span class="o">){</span>
</span><span class='line'>                   preference.data &lt;- data.frame<span class="o">(</span>
</span><span class='line'>                     <span class="nv">p</span><span class="o">=</span>as.numeric<span class="o">(</span>target.data<span class="o">[</span>i, -1<span class="o">])</span>,
</span><span class='line'>                     <span class="nv">X1</span><span class="o">=</span>service.map.df<span class="nv">$X1</span>,
</span><span class='line'>                     <span class="nv">X2</span><span class="o">=</span>service.map.df<span class="nv">$X2</span><span class="o">)</span>
</span><span class='line'>                   fit &lt;- lm<span class="o">(</span>p~., <span class="nv">data</span><span class="o">=</span>preference.data<span class="o">)</span>
</span><span class='line'>                   b &lt;- 2/sqrt<span class="o">(</span>fit<span class="nv">$coef</span><span class="o">[</span><span class="s2">&quot;X1&quot;</span><span class="o">]</span>^2+fit<span class="nv">$coef</span><span class="o">[</span><span class="s2">&quot;X2&quot;</span><span class="o">]</span>^2<span class="o">)</span>
</span><span class='line'>                   data.frame<span class="o">(</span><span class="nv">X1</span><span class="o">=</span>b*fit<span class="nv">$coef</span><span class="o">[</span><span class="s2">&quot;X1&quot;</span><span class="o">]</span>,
</span><span class='line'>                              <span class="nv">X2</span><span class="o">=</span>b*fit<span class="nv">$coef</span><span class="o">[</span><span class="s2">&quot;X2&quot;</span><span class="o">]</span>,
</span><span class='line'>                              <span class="nv">service_name</span><span class="o">=</span>i<span class="o">)</span>
</span><span class='line'>                 <span class="o">}))</span>
</span><span class='line'>
</span><span class='line'><span class="c"># 選好ベクトルの描画</span>
</span><span class='line'>ggplot<span class="o">(</span>service.map.df, aes<span class="o">(</span><span class="nv">x</span><span class="o">=</span>X1, <span class="nv">y</span><span class="o">=</span>X2, <span class="nv">label</span><span class="o">=</span>service_name<span class="o">))</span> +
</span><span class='line'>  geom_text<span class="o">()</span> +
</span><span class='line'>  theme_bw<span class="o">(</span>16<span class="o">)</span> +
</span><span class='line'>  xlim<span class="o">(</span>-2,2<span class="o">)</span> +
</span><span class='line'>  ylim<span class="o">(</span>-2,2<span class="o">)</span> +
</span><span class='line'>  geom_point<span class="o">(</span><span class="nv">data</span><span class="o">=</span>user.preference.data, aes<span class="o">(</span><span class="nv">x</span><span class="o">=</span>X1, <span class="nv">y</span><span class="o">=</span>X2<span class="o">))</span>
</span></code></pre></td></tr></table></div></figure>


<p><img src="https://farm6.staticflickr.com/5111/13503847744_282c983ee8.jpg" width="500" height="309" alt="スクリーンショット 2014-03-30 14.27.52"></p>

<h3>仮想データの読み込みと散布図の描画</h3>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="c"># 利用する仮想データの読み込み</span>
</span><span class='line'>library<span class="o">(</span>ggplot2<span class="o">)</span>
</span><span class='line'>library<span class="o">(</span>scales<span class="o">)</span>
</span><span class='line'>
</span><span class='line'><span class="c"># GRPと売上データの読み込み</span>
</span><span class='line'>grp.data &lt;- read.csv<span class="o">(</span><span class="s2">&quot;http://image.gihyo.co.jp/assets/files/book/2013/978-4-7741-5896-9/download/grp.csv&quot;</span>, <span class="nv">header</span> <span class="o">=</span> T<span class="o">)</span>
</span><span class='line'>
</span><span class='line'><span class="c"># 散布図の描画</span>
</span><span class='line'>ggplot<span class="o">(</span>grp.data, aes<span class="o">(</span><span class="nv">x</span><span class="o">=</span>grp, <span class="nv">y</span><span class="o">=</span>amount<span class="o">))</span> +
</span><span class='line'>  geom_point<span class="o">()</span> +
</span><span class='line'>  scale_y_continuous<span class="o">(</span><span class="nv">label</span><span class="o">=</span>comma, <span class="nv">limits</span><span class="o">=</span>c<span class="o">(</span>0,360000<span class="o">))</span> +
</span><span class='line'>  ylab<span class="o">(</span><span class="s2">&quot;Sales&quot;</span><span class="o">)</span> +
</span><span class='line'>  xlab<span class="o">(</span><span class="s2">&quot;GRP&quot;</span><span class="o">)</span> +
</span><span class='line'>  theme_bw<span class="o">(</span>16<span class="o">)</span>
</span></code></pre></td></tr></table></div></figure>


<p><img src="https://farm4.staticflickr.com/3707/13508727343_d9de5250f9.jpg" width="500" height="312" alt="スクリーンショット 2014-03-30 20.50.20"></p>

<h3>線形型モデルの構築</h3>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="c"># 可視化はgeom_smooth関数ですぐにできる</span>
</span><span class='line'>ggplot<span class="o">(</span>grp.data, aes<span class="o">(</span><span class="nv">x</span><span class="o">=</span>grp, <span class="nv">y</span><span class="o">=</span>amount<span class="o">))</span> +
</span><span class='line'>  geom_point<span class="o">()</span> +
</span><span class='line'>  scale_y_continuous<span class="o">(</span><span class="nv">label</span><span class="o">=</span>comma, <span class="nv">limits</span><span class="o">=</span>c<span class="o">(</span>0, 360000<span class="o">))</span> +
</span><span class='line'>  ylab<span class="o">(</span><span class="s2">&quot;Sales&quot;</span><span class="o">)</span> +
</span><span class='line'>  xlab<span class="o">(</span><span class="s2">&quot;GRP&quot;</span><span class="o">)</span> +
</span><span class='line'>  geom_smooth<span class="o">(</span><span class="nv">method</span> <span class="o">=</span> <span class="s2">&quot;lm&quot;</span><span class="o">)</span> +
</span><span class='line'>  theme_bw<span class="o">(</span>16<span class="o">)</span>
</span><span class='line'>
</span><span class='line'><span class="c"># モデル構築</span>
</span><span class='line'>fit &lt;- lm<span class="o">(</span>amount~grp, <span class="nv">data</span><span class="o">=</span>grp.data<span class="o">)</span>
</span><span class='line'>
</span><span class='line'><span class="c"># モデル概要の表示</span>
</span><span class='line'>summary<span class="o">(</span>fit<span class="o">)</span>
</span><span class='line'><span class="c"># Call:</span>
</span><span class='line'><span class="c">#   lm(formula = amount ~ grp, data = grp.data)</span>
</span><span class='line'><span class="c"># </span>
</span><span class='line'><span class="c"># Residuals:</span>
</span><span class='line'><span class="c">#   Min     1Q Median     3Q    Max </span>
</span><span class='line'><span class="c"># -31521  -8275    321   8701  36962 </span>
</span><span class='line'><span class="c"># </span>
</span><span class='line'><span class="c"># Coefficients:</span>
</span><span class='line'><span class="c">#   Estimate Std. Error t value Pr(&gt;|t|)    </span>
</span><span class='line'><span class="c"># (Intercept) 229812.53    2561.73   89.71   &lt;2e-16 ***</span>
</span><span class='line'><span class="c">#   grp            455.54      15.93   28.60   &lt;2e-16 ***</span>
</span><span class='line'><span class="c">#   ---</span>
</span><span class='line'><span class="c">#   Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1</span>
</span><span class='line'><span class="c"># </span>
</span><span class='line'><span class="c"># Residual standard error: 13070 on 198 degrees of freedom</span>
</span><span class='line'><span class="c"># Multiple R-squared:  0.8051,  Adjusted R-squared:  0.8042 </span>
</span><span class='line'><span class="c"># F-statistic: 818.1 on 1 and 198 DF,  p-value: &lt; 2.2e-16</span>
</span></code></pre></td></tr></table></div></figure>


<p><img src="https://farm4.staticflickr.com/3762/13508864803_8876878af0.jpg" width="500" height="292" alt="スクリーンショット 2014-03-30 20.58.40"></p>

<h3>xx減型モデルの構築</h3>

<p>読めなかった。日本語苦手っすw</p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>fit &lt;- lm<span class="o">(</span>log<span class="o">(</span>amount<span class="o">)</span>~log<span class="o">(</span>grp<span class="o">)</span>, <span class="nv">data</span><span class="o">=</span>grp.data<span class="o">)</span>
</span><span class='line'>
</span><span class='line'><span class="c"># モデル概要</span>
</span><span class='line'>summary<span class="o">(</span>fit<span class="o">)</span>
</span><span class='line'><span class="c"># Call:</span>
</span><span class='line'><span class="c">#   lm(formula = log(amount) ~ log(grp), data = grp.data)</span>
</span><span class='line'><span class="c"># </span>
</span><span class='line'><span class="c"># Residuals:</span>
</span><span class='line'><span class="c">#   Min        1Q    Median        3Q       Max </span>
</span><span class='line'><span class="c"># -0.121782 -0.023589 -0.003298  0.025672  0.116504 </span>
</span><span class='line'><span class="c"># </span>
</span><span class='line'><span class="c"># Coefficients:</span>
</span><span class='line'><span class="c">#   Estimate Std. Error t value Pr(&gt;|t|)    </span>
</span><span class='line'><span class="c"># (Intercept) 11.546963   0.032379  356.62   &lt;2e-16 ***</span>
</span><span class='line'><span class="c">#   log(grp)     0.213933   0.006551   32.66   &lt;2e-16 ***</span>
</span><span class='line'><span class="c">#   ---</span>
</span><span class='line'><span class="c">#   Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1</span>
</span><span class='line'><span class="c"># </span>
</span><span class='line'><span class="c"># Residual standard error: 0.04064 on 198 degrees of freedom</span>
</span><span class='line'><span class="c"># Multiple R-squared:  0.8434,  Adjusted R-squared:  0.8426 </span>
</span><span class='line'><span class="c"># F-statistic:  1067 on 1 and 198 DF,  p-value: &lt; 2.2e-16</span>
</span><span class='line'>
</span><span class='line'><span class="c"># 予測結果を描画</span>
</span><span class='line'>fit.data &lt;- data.frame<span class="o">(</span><span class="nv">grp</span><span class="o">=</span>grp.data<span class="nv">$grp</span>, <span class="nv">amount</span><span class="o">=</span>exp<span class="o">(</span>fit<span class="nv">$fitted</span>.values<span class="o">))</span>
</span><span class='line'>ggplot<span class="o">(</span>grp.data, aes<span class="o">(</span><span class="nv">x</span><span class="o">=</span>grp, <span class="nv">y</span><span class="o">=</span>amount<span class="o">))</span> +
</span><span class='line'>  geom_point<span class="o">()</span> +
</span><span class='line'>  geom_line<span class="o">(</span><span class="nv">data</span><span class="o">=</span>fit.data, aes<span class="o">(</span><span class="nv">x</span><span class="o">=</span>grp, <span class="nv">y</span><span class="o">=</span>amount<span class="o">))</span> +
</span><span class='line'>  scale_y_continuous<span class="o">(</span><span class="nv">label</span><span class="o">=</span>comma, <span class="nv">limits</span><span class="o">=</span>c<span class="o">(</span>0,360000<span class="o">))</span> +
</span><span class='line'>  ylab<span class="o">(</span><span class="s2">&quot;Sales&quot;</span><span class="o">)</span> +
</span><span class='line'>  xlab<span class="o">(</span><span class="s2">&quot;GRP&quot;</span><span class="o">)</span> +
</span><span class='line'>  theme_bw<span class="o">(</span>16<span class="o">)</span>
</span></code></pre></td></tr></table></div></figure>


<p><img src="https://farm4.staticflickr.com/3766/13509463494_e26fa8a9e8.jpg" width="500" height="356" alt="スクリーンショット 2014-03-30 21.19.14"></p>

<h3>AとBが同じ場合のA/Bテストのシミュレーション</h3>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>library<span class="o">(</span><span class="s2">&quot;plyr&quot;</span><span class="o">)</span>
</span><span class='line'>
</span><span class='line'><span class="c"># A/Bの心のコンバージョン率を設定</span>
</span><span class='line'>A1.CVR &lt;- 0.09
</span><span class='line'>B1.CVR &lt;- 0.09
</span><span class='line'>
</span><span class='line'><span class="c"># サンプル数</span>
</span><span class='line'>n &lt;- 10000
</span><span class='line'>set.seed<span class="o">(</span>2<span class="o">)</span>
</span><span class='line'>
</span><span class='line'><span class="c"># シミュレーション</span>
</span><span class='line'>AB1 &lt;- data.frame<span class="o">(</span><span class="nv">Pattern</span><span class="o">=</span>c<span class="o">(</span>rep<span class="o">(</span><span class="s2">&quot;A&quot;</span>, n<span class="o">)</span>, rep<span class="o">(</span><span class="s2">&quot;B&quot;</span>, n<span class="o">))</span>, <span class="nv">CV</span><span class="o">=</span>c<span class="o">(</span>rbinom<span class="o">(</span>n, 1, A1.CVR<span class="o">)</span>, rbinom<span class="o">(</span>n, 1, B1.CVR<span class="o">)))</span>
</span><span class='line'>
</span><span class='line'><span class="c"># コンバージョン率の算出</span>
</span><span class='line'>ddply<span class="o">(</span>AB1, .<span class="o">(</span>Pattern<span class="o">)</span>, summarize, <span class="nv">CVR</span><span class="o">=</span>mean<span class="o">(</span>CV<span class="o">))</span>
</span><span class='line'><span class="c"># Pattern    CVR</span>
</span><span class='line'><span class="c"># 1       A 0.0942</span>
</span><span class='line'><span class="c"># 2       B 0.0912</span>
</span><span class='line'>
</span><span class='line'><span class="c"># カイ二乗検定</span>
</span><span class='line'>chisq.test<span class="o">(</span>table<span class="o">(</span>AB1<span class="o">))</span>
</span><span class='line'><span class="c"># Pearson&#39;s Chi-squared test with Yates&#39; continuity correction</span>
</span><span class='line'><span class="c"># </span>
</span><span class='line'><span class="c"># data:  table(AB1)</span>
</span><span class='line'><span class="c"># X-squared = 0.5, df = 1, p-value = 0.4795</span>
</span></code></pre></td></tr></table></div></figure>


<h3>Bのほうが高い場合のA/Bテストのシミュレーション</h3>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>A2.CVR &lt;- 0.095
</span><span class='line'>B2.CVR &lt;- 0.097
</span><span class='line'>n &lt;- 10000
</span><span class='line'>set.seed<span class="o">(</span>2<span class="o">)</span>
</span><span class='line'>
</span><span class='line'><span class="c"># シミュレーション</span>
</span><span class='line'>AB2 &lt;- data.frame<span class="o">(</span><span class="nv">Pattern</span><span class="o">=</span>c<span class="o">(</span>rep<span class="o">(</span><span class="s2">&quot;A&quot;</span>, n<span class="o">)</span>, rep<span class="o">(</span><span class="s2">&quot;B&quot;</span>, n<span class="o">))</span>, <span class="nv">CV</span><span class="o">=</span>c<span class="o">(</span>rbinom<span class="o">(</span>n, 1, A2.CVR<span class="o">)</span>, rbinom<span class="o">(</span>n, 1, B2.CVR<span class="o">)))</span>
</span><span class='line'>
</span><span class='line'><span class="c"># コンバージョン率の算出</span>
</span><span class='line'>ddply<span class="o">(</span>AB2, .<span class="o">(</span>Pattern<span class="o">)</span>, summarize, <span class="nv">CVR</span> <span class="o">=</span> mean<span class="o">(</span>CV<span class="o">))</span>
</span><span class='line'><span class="c"># Pattern   CVR</span>
</span><span class='line'><span class="c"># 1       A 0.100</span>
</span><span class='line'><span class="c"># 2       B 0.097</span>
</span><span class='line'>
</span><span class='line'><span class="c"># カイ二乗検定</span>
</span><span class='line'>chisq.test<span class="o">(</span>table<span class="o">(</span>AB2<span class="o">))</span>
</span><span class='line'><span class="c"># Pearson&#39;s Chi-squared test with Yates&#39; continuity correction</span>
</span><span class='line'><span class="c"># </span>
</span><span class='line'><span class="c"># data:  table(AB2)</span>
</span><span class='line'><span class="c"># X-squared = 0.4735, df = 1, p-value = 0.4914</span>
</span></code></pre></td></tr></table></div></figure>


<h3>50万件でのシミュレーション</h3>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>A3.CVR &lt;- 0.095
</span><span class='line'>B3.CVR &lt;- 0.097
</span><span class='line'>n &lt;- 500000
</span><span class='line'>set.seed<span class="o">(</span>2<span class="o">)</span>
</span><span class='line'>
</span><span class='line'><span class="c"># シミュレーション</span>
</span><span class='line'>AB3 &lt;- data.frame<span class="o">(</span><span class="nv">Pattern</span><span class="o">=</span>c<span class="o">(</span>rep<span class="o">(</span><span class="s2">&quot;A&quot;</span>, n<span class="o">)</span>, rep<span class="o">(</span><span class="s2">&quot;B&quot;</span>, n<span class="o">))</span>,
</span><span class='line'>                  <span class="nv">CV</span><span class="o">=</span>c<span class="o">(</span>rbinom<span class="o">(</span>n, 1, A3.CVR<span class="o">)</span>, rbinom<span class="o">(</span>n, 1, B3.CVR<span class="o">)))</span>
</span><span class='line'>
</span><span class='line'><span class="c"># コンバージョン率の算出</span>
</span><span class='line'>ddply<span class="o">(</span>AB3, .<span class="o">(</span>Pattern<span class="o">)</span>, summarize, <span class="nv">CVR</span><span class="o">=</span>mean<span class="o">(</span>CV<span class="o">))</span>
</span><span class='line'><span class="c"># Pattern      CVR</span>
</span><span class='line'><span class="c"># 1       A 0.095192</span>
</span><span class='line'><span class="c"># 2       B 0.097040</span>
</span><span class='line'>
</span><span class='line'><span class="c"># カイ二乗検定の実行</span>
</span><span class='line'>chisq.test<span class="o">(</span>table<span class="o">(</span>AB3<span class="o">))</span>
</span><span class='line'><span class="c"># Pearson&#39;s Chi-squared test with Yates&#39; continuity correction</span>
</span><span class='line'><span class="c"># </span>
</span><span class='line'><span class="c"># data:  table(AB3)</span>
</span><span class='line'><span class="c"># X-squared = 9.8061, df = 1, p-value = 0.001739</span>
</span></code></pre></td></tr></table></div></figure>


<h3>直交表の作成</h3>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>install.packages<span class="o">(</span><span class="s2">&quot;conjoint&quot;</span><span class="o">)</span>
</span><span class='line'>library<span class="o">(</span>conjoint<span class="o">)</span>
</span><span class='line'>
</span><span class='line'><span class="c"># 構成要素</span>
</span><span class='line'>experiment &lt;- expand.grid<span class="o">(</span>
</span><span class='line'>  <span class="nv">imgA</span> <span class="o">=</span> c<span class="o">(</span><span class="s2">&quot;ImageA1&quot;</span>, <span class="s2">&quot;ImageA2&quot;</span><span class="o">)</span>,
</span><span class='line'>  <span class="nv">imgB</span> <span class="o">=</span> c<span class="o">(</span><span class="s2">&quot;ImageB1&quot;</span>, <span class="s2">&quot;ImageB2&quot;</span><span class="o">)</span>,
</span><span class='line'>  <span class="nv">txtA</span> <span class="o">=</span> c<span class="o">(</span><span class="s2">&quot;TextA1&quot;</span>, <span class="s2">&quot;TextA2&quot;</span><span class="o">)</span>,
</span><span class='line'>  <span class="nv">txtB</span> <span class="o">=</span> c<span class="o">(</span><span class="s2">&quot;TextB1&quot;</span>, <span class="s2">&quot;TextB2&quot;</span><span class="o">))</span>
</span><span class='line'>
</span><span class='line'><span class="c"># 交流表の作成</span>
</span><span class='line'>design.ort &lt;- caFactorialDesign<span class="o">(</span><span class="nv">data</span><span class="o">=</span> experiment, <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;orthogonal&quot;</span><span class="o">)</span>
</span><span class='line'>design.ort
</span><span class='line'><span class="c"># imgA    imgB   txtA   txtB</span>
</span><span class='line'><span class="c"># 2  ImageA2 ImageB1 TextA1 TextB1</span>
</span><span class='line'><span class="c"># 3  ImageA1 ImageB2 TextA1 TextB1</span>
</span><span class='line'><span class="c"># 5  ImageA1 ImageB1 TextA2 TextB1</span>
</span><span class='line'><span class="c"># 8  ImageA2 ImageB2 TextA2 TextB1</span>
</span><span class='line'><span class="c"># 9  ImageA1 ImageB1 TextA1 TextB2</span>
</span><span class='line'><span class="c"># 12 ImageA2 ImageB2 TextA1 TextB2</span>
</span><span class='line'><span class="c"># 14 ImageA2 ImageB1 TextA2 TextB2</span>
</span><span class='line'><span class="c"># 15 ImageA1 ImageB2 TextA2 TextB2</span>
</span></code></pre></td></tr></table></div></figure>


<h3>ロジスティック回帰モデルの構築</h3>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="c"># 仮想のテスト結果データの読み込み(csがないので以下実行していません)</span>
</span><span class='line'>web.test.data &lt;- read.csv<span class="o">(</span><span class="s2">&quot;web_test_sample.csv&quot;</span><span class="o">)</span>
</span><span class='line'>
</span><span class='line'><span class="c"># 上位6件だけ表示</span>
</span><span class='line'>head<span class="o">(</span>web.test.data<span class="o">)</span>
</span><span class='line'>
</span><span class='line'><span class="c"># ロジスティック回帰モデルの構築</span>
</span><span class='line'>fit &lt;- step<span class="o">(</span>glm<span class="o">(</span>cv~., <span class="nv">data</span> <span class="o">=</span> web.test.data<span class="o">[</span>,-1<span class="o">]</span>, <span class="nv">family</span><span class="o">=</span>binomial<span class="o">))</span>
</span><span class='line'>
</span><span class='line'><span class="c"># モデル概要</span>
</span><span class='line'>summary<span class="o">(</span>fit<span class="o">)</span>
</span></code></pre></td></tr></table></div></figure>


<h2>Fluentd 入門</h2>

<p>ログ回収をストリーミングで行ってくれるツール。ツールについての詳しい説明は、創業者の古橋さんのインタビュー記事『<strong><a href="http://www.atmarkit.co.jp/ait/articles/1310/07/news010.html">グリー技術者が聞いた、fluentdの新機能とTreasure Data古橋氏の野心</a></strong>』がわかりやすくてオススメです。</p>

<h3>ログ解析の従来の課題</h3>

<pre>
1) ログデータの転送に長い時間が必要、帯域の局所的な消費
2) データが解析可能になるまでのタイムラグ
3) ネットワーク障害などによる不安定さ
</pre>


<h3>Fluentdの利点</h3>

<pre>
1) JSON形式で構造化されている
2) 豊富なプラグイン(プラガブル)
3) 導入が容易
4) 耐障害性、バッファ、レジューム機能、可用性
</pre>


<h3>アーキテクチャ</h3>

<pre>
1) input: さまざまなソースからデータを読み取りFluentd用の形式に変換
2) Engine: 入ってきたデータをどのBuffe/Outpuプラグインに渡すかをルーティング
3) Bufferプラグイン: Outputプラグインの前にデータを一時保持する仕組み
4) Outputプラグイン: Bufferプラグインから渡されたデータを書き出す
</pre>


<h3>ログ構造</h3>

<pre>
tag: ログの種類。ルーティングで利用
time: ログが記録されたUNIX時刻
record: JSON形式のログ内容
</pre>


<h3>活用方法</h3>

<pre>
1) ログ収集: ログを集めてS3やHadoopに渡す
2) 統計 + 可視性: ログの統計情報を取得し、グラフ表示系のツールと連携する
3) 検知/通知: しきい値ベースや、データマイニングの異常値検出の通知など
</pre>


<h3>システム構成</h3>

<pre>
forwarder: ログ発生場所に立ち上げてログ回収 => aggregatorに送信
aggregator: 複数workerのためのロードバランシング、複数台構成による冗長化
worker: ログのパースや書き換えなど負荷の高い処理を行う
serializer: workerの処理結果のログを集約して別システムに書き出す
watcher: ログからメトリックスを収集、検知や通知を行う
</pre>


<h3>事例紹介</h3>

<pre>
1) ログの回収: DSPの広告効果のレポーティングのための収集の仕組み
2) nginx ログの可視化: Real Time Bidding(RTB)のツール
</pre>


<h2>あとがき</h2>

<p>中身濃すぎる！超面白かったです＾＾</p>

<div>
  <script type="text/javascript"><!--
  google_ad_client = "ca-pub-4186413323075068";
  /* middle_yoko_naga2 */
  google_ad_slot = "4362325392";
  google_ad_width = 728;
  google_ad_height = 90;
  //-->
  </script>
  <script type="text/javascript"
          src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
  </script>
</div>


<h2>Speical Thanks</h2>

<p><strong><a href="http://stackoverflow.com/questions/20572366/sudo-pip-install-matplotlib-fails-to-find-freetype-headers-os-x-mavericks">python - <code>Sudo pip install matplotlib</code> fails to find freetype headers. [OS X Mavericks / 10.9] - Stack Overflow</a></strong></p>

<p><strong><a href="http://stackoverflow.com/questions/15951748/pydot-and-graphviz-error-couldnt-import-dot-parser-loading-of-dot-files-will">python - pydot and graphviz error: Couldn&#8217;t import dot_parser, loading of dot files will not be possible - Stack Overflow</a></strong></p>
</div>

  <div>
    <h2>押さえておきたい書籍</h2>
    <a href="http://www.amazon.co.jp/gp/product/B00YJGMAMC/ref=as_li_qf_sp_asin_il?ie=UTF8&camp=247&creative=1211&creativeASIN=B00YJGMAMC&linkCode=as2&tag=morizyun00-22"><img border="0" src="http://ws.assoc-amazon.jp/widgets/q?_encoding=UTF8&ASIN=B00YJGMAMC&Format=_SL160_&ID=AsinImage&MarketPlace=JP&ServiceVersion=20070822&WS=1&tag=morizyun00-22" ></a><img src="http://www.assoc-amazon.jp/e/ir?t=morizyun00-22&l=as2&o=9&a=B00YJGMAMC" width="1" height="1" border="0" alt="" style="border:none !important; margin:0px !important;" />
    <a href="http://www.amazon.co.jp/gp/product/4274217620/ref=as_li_qf_sp_asin_il?ie=UTF8&camp=247&creative=1211&creativeASIN=4274217620&linkCode=as2&tag=morizyun00-22"><img border="0" src="http://ws.assoc-amazon.jp/widgets/q?_encoding=UTF8&ASIN=4274217620&Format=_SL160_&ID=AsinImage&MarketPlace=JP&ServiceVersion=20070822&WS=1&tag=morizyun00-22" ></a><img src="http://www.assoc-amazon.jp/e/ir?t=morizyun00-22&l=as2&o=9&a=4274217620" width="1" height="1" border="0" alt="" style="border:none !important; margin:0px !important;" />
    <a href="http://www.amazon.co.jp/gp/product/4797347783/ref=as_li_qf_sp_asin_il?ie=UTF8&camp=247&creative=1211&creativeASIN=4797347783&linkCode=as2&tag=morizyun00-22"><img border="0" src="http://ws.assoc-amazon.jp/widgets/q?_encoding=UTF8&ASIN=4797347783&Format=_SL160_&ID=AsinImage&MarketPlace=JP&ServiceVersion=20070822&WS=1&tag=morizyun00-22" ></a><img src="http://www.assoc-amazon.jp/e/ir?t=morizyun00-22&l=as2&o=9&a=4797347783" width="1" height="1" border="0" alt="" style="border:none !important; margin:0px !important;" />
    <a href="http://www.amazon.co.jp/gp/product/4798138088/ref=as_li_qf_sp_asin_il?ie=UTF8&camp=247&creative=1211&creativeASIN=4798138088&linkCode=as2&tag=morizyun00-22"><img border="0" src="http://ws.assoc-amazon.jp/widgets/q?_encoding=UTF8&ASIN=4798138088&Format=_SL160_&ID=AsinImage&MarketPlace=JP&ServiceVersion=20070822&WS=1&tag=morizyun00-22" ></a><img src="http://www.assoc-amazon.jp/e/ir?t=morizyun00-22&l=as2&o=9&a=4798138088" width="1" height="1" border="0" alt="" style="border:none !important; margin:0px !important;" />
    <a href="http://www.amazon.co.jp/gp/product/4873117283/ref=as_li_qf_sp_asin_il?ie=UTF8&camp=247&creative=1211&creativeASIN=4873117283&linkCode=as2&tag=morizyun00-22"><img border="0" src="http://ws.assoc-amazon.jp/widgets/q?_encoding=UTF8&ASIN=4873117283&Format=_SL160_&ID=AsinImage&MarketPlace=JP&ServiceVersion=20070822&WS=1&tag=morizyun00-22" ></a><img src="http://www.assoc-amazon.jp/e/ir?t=morizyun00-22&l=as2&o=9&a=4873117283" width="1" height="1" border="0" alt="" style="border:none !important; margin:0px !important;" />
    <a href="http://www.amazon.co.jp/gp/product/4797382228/ref=as_li_qf_sp_asin_il?ie=UTF8&camp=247&creative=1211&creativeASIN=4797382228&linkCode=as2&tag=morizyun00-22"><img border="0" src="http://ws.assoc-amazon.jp/widgets/q?_encoding=UTF8&ASIN=4797382228&Format=_SL160_&ID=AsinImage&MarketPlace=JP&ServiceVersion=20070822&WS=1&tag=morizyun00-22" ></a><img src="http://www.assoc-amazon.jp/e/ir?t=morizyun00-22&l=as2&o=9&a=4797382228" width="1" height="1" border="0" alt="" style="border:none !important; margin:0px !important;" />
    <a href="http://www.amazon.co.jp/gp/product/B010N105SC/ref=as_li_qf_sp_asin_il?ie=UTF8&camp=247&creative=1211&creativeASIN=B010N105SC&linkCode=as2&tag=morizyun00-22"><img border="0" src="http://ws.assoc-amazon.jp/widgets/q?_encoding=UTF8&ASIN=B010N105SC&Format=_SL160_&ID=AsinImage&MarketPlace=JP&ServiceVersion=20070822&WS=1&tag=morizyun00-22" ></a><img src="http://www.assoc-amazon.jp/e/ir?t=morizyun00-22&l=as2&o=9&a=B010N105SC" width="1" height="1" border="0" alt="" style="border:none !important; margin:0px !important;" />
    <a href="http://www.amazon.co.jp/gp/product/B010CQD4Y0/ref=as_li_qf_sp_asin_il?ie=UTF8&camp=247&creative=1211&creativeASIN=B010CQD4Y0&linkCode=as2&tag=morizyun00-22"><img border="0" src="http://ws.assoc-amazon.jp/widgets/q?_encoding=UTF8&ASIN=B010CQD4Y0&Format=_SL160_&ID=AsinImage&MarketPlace=JP&ServiceVersion=20070822&WS=1&tag=morizyun00-22" ></a><img src="http://www.assoc-amazon.jp/e/ir?t=morizyun00-22&l=as2&o=9&a=B010CQD4Y0" width="1" height="1" border="0" alt="" style="border:none !important; margin:0px !important;" />
    <a href="http://www.amazon.co.jp/gp/product/4794968868/ref=as_li_qf_sp_asin_il?ie=UTF8&camp=247&creative=1211&creativeASIN=4794968868&linkCode=as2&tag=morizyun00-22"><img border="0" src="http://ws.assoc-amazon.jp/widgets/q?_encoding=UTF8&ASIN=4794968868&Format=_SL160_&ID=AsinImage&MarketPlace=JP&ServiceVersion=20070822&WS=1&tag=morizyun00-22" ></a><img src="http://www.assoc-amazon.jp/e/ir?t=morizyun00-22&l=as2&o=9&a=4794968868" width="1" height="1" border="0" alt="" style="border:none !important; margin:0px !important;" />
    <a href="http://www.amazon.co.jp/gp/product/4862462650/ref=as_li_qf_sp_asin_il?ie=UTF8&camp=247&creative=1211&creativeASIN=4862462650&linkCode=as2&tag=morizyun00-22"><img border="0" src="http://ws.assoc-amazon.jp/widgets/q?_encoding=UTF8&ASIN=4862462650&Format=_SL160_&ID=AsinImage&MarketPlace=JP&ServiceVersion=20070822&WS=1&tag=morizyun00-22" ></a><img src="http://www.assoc-amazon.jp/e/ir?t=morizyun00-22&l=as2&o=9&a=4862462650" width="1" height="1" border="0" alt="" style="border:none !important; margin:0px !important;" />
</div>
  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">morizyun</span></span>

      








  


<time datetime="2014-03-31T09:40:00+09:00" pubdate data-updated="true">Mar 31<span>st</span>, 2014</time>
      

<span class="categories">
  
    <a class='category' href='/blog/categories/r/'>R</a>, <a class='category' href='/blog/categories/python/'>python</a>, <a class='category' href='/blog/categories/statistics/'>statistics</a>
  
</span>


    </p>
    
      <div class="sharing social_box">
    <ul class="social" style="margin-left: 0;">
        <li class="hatena">
            
            <a href="http://b.hatena.ne.jp/entry/http://morizyun.github.io/blog/data-scientist-cultivation-book-review/" class="hatena-bookmark-button" data-hatena-bookmark-layout="standard" title="このエントリーをはてなブックマークに追加"><img src="http://b.st-hatena.com/images/entry-button/button-only.gif" alt="このエントリーをはてなブックマークに追加" width="20" height="20" style="border: none;" /></a><script type="text/javascript" src="http://b.st-hatena.com/js/bookmark_button.js" charset="utf-8" async="async"></script>
            
        </li>
        <li class="twitter">
            
                
                <a href="http://twitter.com/share" class="twitter-share-button" data-url="http://morizyun.github.io/blog/data-scientist-cultivation-book-review/" data-via="zyunnosuke" data-counturl="http://morizyun.github.io/blog/data-scientist-cultivation-book-review/" >Tweet</a>
                
            
        </li>
        <li class="facebook">
            
            <div class="fb-like" data-send="false" data-layout="button_count" data-show-faces="false" data-font="verdana" data-href="http://morizyun.github.io/blog/data-scientist-cultivation-book-review/"></div>
            
        </li>
    </ul>
</div>
    
    <p class="meta">
      
        <a class="basic-alignment left" href="/blog/vagrant-centos-php53-cakephp/" title="Previous Post: VagrantでCentOS/Chef/MySQL/phpMyAdmin/PHP 5.3/CakePHP2.4.5 開発環境を整備">&laquo; VagrantでCentOS/Chef/MySQL/phpMyAdmin/PHP 5.3/CakePHP2.4.5 開発環境を整備</a>
      
      
        <a class="basic-alignment right" href="/blog/nyumon-toukeigaku-kurihara-shinichi-book-review/" title="Next Post: 【書評: 入門統計学 検定から多量変数解析・実験計画法まで】基礎固めに最適！">【書評: 入門統計学 検定から多量変数解析・実験計画法まで】基礎固めに最適！ &raquo;</a>
      
    </p>
  </footer>
</article>

  <section>
    <h5>
      いかがだったでしょうか？<br/>
      もし説明がわかりにくかったり、間違っている場所があればぜひ一言！
    </h5>
    <h1>Comments</h1>
    <div id="disqus_thread" aria-live="polite"><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
  </section>

</div>

<aside class="sidebar">
  
    <section style="margin: 20px 0 0 0;">
    <h1 style="margin: 0 0 10px 0;">勉強会を見つけやすく！</h1>
    <a href='http://meeting.blue' target='blank'><img src="https://farm4.staticflickr.com/3942/15511213577_e5c7a57333_n.jpg" width="256"></a>
</section>
<section style="margin: 20px 0 0 0;">
  <h1 style="margin: 0 0 10px 0;">RSSもあるよ</h1>
  <a href='http://cloud.feedly.com/#subscription%2Ffeed%2Fhttp%3A%2F%2Ffeeds.feedburner.com%2Frubyrails'  target='blank'><img id='feedlyFollow' src='http://s3.feedly.com/img/follows/feedly-follow-rectangle-volume-big_2x.png' alt='follow us in feedly' width='256' height='112'></a>
</section>
<section style="margin: 20px 0 0 0;">
    <h1 style="margin: 0 0 10px 0;">Rubyニュース</h1>
    <a href="http://www.facebook.com/pages/RailsRuby%E3%81%A7%E8%A9%B1%E9%A1%8C%E3%81%AB%E3%81%AA%E3%81%A3%E3%81%A6%E3%81%84%E3%82%8B%E8%A8%98%E4%BA%8B%E3%82%92%E3%81%BE%E3%81%A8%E3%82%81%E3%81%A6%E3%81%BE%E3%81%99-%E9%85%92%E3%81%A8%E6%B3%AA%E3%81%A8Ruby%E3%81%A8Rails%E3%81%A8/307988722650180?ref=hl"><img src="/images/ruby_news_banner.png" width="264" height="90" alt="facebook_page_banner"></a>
</section>
<section>
  <h1 style="margin-bottom: 10px;">Ruby on Rails人気記事</h1>
  <script language="javascript" type="text/javascript" src="http://b.hatena.ne.jp/js/widget.js" charset="utf-8"></script>
  <script language="javascript" type="text/javascript">
    Hatena.BookmarkWidget.url   = "http://morizyun.github.io/";
    Hatena.BookmarkWidget.title = "酒と泪とRubyとRailsと";
    Hatena.BookmarkWidget.sort  = "count";
    Hatena.BookmarkWidget.width = 0;
    Hatena.BookmarkWidget.num   = 10;
    Hatena.BookmarkWidget.theme = "notheme";
    Hatena.BookmarkWidget.load();
  </script>
</section>
<section style="margin: 20px 0 0 0;">
    <a class="twitter-timeline" href="https://twitter.com/zyunnosuke" data-widget-id="369007573455736833">@zyunnosuke からのツイート</a>
    <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+"://platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script>
</section>
<section>
  <h1>About Me</h1>
  <div id="twitter-profile" style="margin-top:0.5em;">
    <p>
      <strong>morizyun</strong> 
      (<a href="http://twitter.com/zyunnosuke">@zyunnosuke</a>)
    </p>
    <p>Ruby on RailsはWebサービスのプロトタイプをスピーディに開発できることが特徴です。このRailをさらに有効活用するためのGemや、デザイン・パターン、アルゴリズムなどを積極的に発信していきます！</p>
  </div>
  <script type="text/javascript">
    $.domReady(function(){
        var container = $('#twitter-profile'),
            user = "zyunnosuke";
        
        function parseTwLinks(s) {
          var twUrl = "http://www.twitter.com/"
          s = s.replace(/ (@([\w]+))/g, function(match, p1, p2) {
              return " <a href='"+twUrl+p2+"'>"+p1+"</a>"
          }).replace(/ (#([\w]+))/g, function(match, p1, p2) {
              return " <a href='"+twUrl+"#!/search?q=%23"+p2+"'>"+p1+"</a>"
          })
          return s
        }

        $.ajax({
            url: "http://api.twitter.com/1/users/show.json?include_entities=false&screen_name="+user+"&callback=?"
          , type: 'jsonp'
          , error: function (err) { $('#twitter-profile').addClass('error');  }
          , success: function(data) {
              container.html('<img class="left" src="http://api.twitter.com/1/users/profile_image/'+user+'.json?size=bigger" alt="@'+user+'"><p><strong>'+data.name+'</strong> (<a href="http://twitter.com/'+user+'">@'+user+'</a>)<br/>'+data.location+'</p><p>'+parseTwLinks(data.description)+'</p>');
            }
        })
      });
  </script>
</section>


  
</aside>

<!-- Qualaroo for github.com -->
<!-- Paste this code right after the <body> tag on every page of your site. -->
<script type="text/javascript">var _kiq = _kiq || [];</script>
<script type="text/javascript" src="//s3.amazonaws.com/ki.js/46012/96Y.js" async="true"></script>
    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2015 - morizyun -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'morizyun';
      
        
        // var disqus_developer = 1;
        var disqus_identifier = 'http://morizyun.github.io/blog/data-scientist-cultivation-book-review/';
        var disqus_url = 'http://morizyun.github.io/blog/data-scientist-cultivation-book-review/';
        var disqus_script = 'embed.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>



<div id="fb-root"></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) {return;}
  js = d.createElement(s); js.id = id;
  js.src = "//connect.facebook.net/ja_JP/all.js#appId=183897648417956&xfbml=1";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>





  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
