<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[酒と泪とRubyとRailsと]]></title>
  <link href="http://morizyun.github.io/atom.xml" rel="self"/>
  <link href="http://morizyun.github.io/"/>
  <updated>2016-01-11T21:36:22+09:00</updated>
  <id>http://morizyun.github.io/</id>
  <author>
    <name><![CDATA[morizyun]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[ActiveModelを使って、Classにバリデーションなどの便利機能を追加 [Rails4.2]]]></title>
    <link href="http://morizyun.github.io/blog/activemodel-rails-basic-usage/"/>
    <updated>2016-01-11T21:10:00+09:00</updated>
    <id>http://morizyun.github.io/blog/activemodel-rails-basic-usage</id>
    <content type="html"><![CDATA[<p><a href="http://www.amazon.co.jp/gp/product/B00NM7VROQ/ref=as_li_qf_sp_asin_il?ie=UTF8&camp=247&creative=1211&creativeASIN=B00NM7VROQ&linkCode=as2&tag=morizyun00-22"><img border="0" src="http://ws.assoc-amazon.jp/widgets/q?_encoding=UTF8&ASIN=B00NM7VROQ&Format=_SL160_&ID=AsinImage&MarketPlace=JP&ServiceVersion=20070822&WS=1&tag=morizyun00-22" width="150" style="float: left; margin: 0 20px 20px 0;" ></a><img src="http://www.assoc-amazon.jp/e/ir?t=morizyun00-22&l=as2&o=9&a=B00NM7VROQ" width="1" height="1" border="0" alt="" style="border:none !important; margin:0px !important;" />
RailsのModelで便利に使っているバリデーションなどの機能をオブジェクトに追加する際には、<code>include ActiveModel::Model</code> がお手軽で便利ですよというお話です。
ちょっとボケて失念してしまっていたので、念のためメモです。</p>

<!-- more -->


<br style="clear:both;"/>


<script async src="http://morizyun.github.io//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>


<!-- square -->


<p><ins class="adsbygoogle" style="display:inline-block;width:336px;height:280px" data-ad-client="ca-pub-4186413323075068" data-ad-slot="5059873392"></ins></p>

<script>
    (adsbygoogle = window.adsbygoogle || []).push({});
</script>


<h2>できること</h2>

<p>この <code>include ActiveModel::Model</code> でできることはこちら。</p>

<ul>
<li><code>Hoge.new({fuga: pugi})</code> みたいなイニシャライズができる</li>
<li>attributeのバリデーションを作れる</li>
<li><code>form_for</code> などで使える</li>
</ul>


<h2>実装例</h2>

<p>オブジェクトの実装はこちら。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="c1"># app/forms/non_model.rb</span>
</span><span class='line'><span class="k">class</span> <span class="nc">Form</span><span class="o">::</span><span class="no">NonModel</span>
</span><span class='line'>  <span class="c1"># ------------------------------------------------------------------</span>
</span><span class='line'>  <span class="c1"># Modules</span>
</span><span class='line'>  <span class="c1"># ------------------------------------------------------------------</span>
</span><span class='line'>  <span class="kp">include</span> <span class="no">ActiveModel</span><span class="o">::</span><span class="no">Model</span> <span class="c1"># Modelの便利機能とか</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1"># ------------------------------------------------------------------</span>
</span><span class='line'>  <span class="c1"># Attributes</span>
</span><span class='line'>  <span class="c1"># ------------------------------------------------------------------</span>
</span><span class='line'>  <span class="kp">attr_accessor</span> <span class="ss">:foo</span><span class="p">,</span> <span class="ss">:bar</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1"># ------------------------------------------------------------------</span>
</span><span class='line'>  <span class="c1"># Validations</span>
</span><span class='line'>  <span class="c1"># ------------------------------------------------------------------</span>
</span><span class='line'>  <span class="n">validates</span> <span class="ss">:foo</span><span class="p">,</span> <span class="n">presence</span><span class="p">:</span> <span class="kp">true</span>
</span><span class='line'>  <span class="n">validates</span> <span class="ss">:bar</span><span class="p">,</span> <span class="n">presence</span><span class="p">:</span> <span class="kp">true</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>オブジェクトを使う際はこちら。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="c1"># バリデーションOKのオブジェクト</span>
</span><span class='line'><span class="n">vaiid_form</span> <span class="o">=</span> <span class="no">Form</span><span class="o">::</span><span class="no">NonModel</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">foo</span><span class="p">:</span> <span class="s1">&#39;foooo&#39;</span><span class="p">,</span> <span class="n">bar</span><span class="p">:</span> <span class="s1">&#39;baaaan!&#39;</span><span class="p">)</span>
</span><span class='line'><span class="n">vaiid_form</span><span class="o">.</span><span class="n">valid?</span> <span class="c1">#=&gt; true</span>
</span><span class='line'>
</span><span class='line'><span class="c1"># バリデーションNGのオブジェクト</span>
</span><span class='line'><span class="n">invalid_form</span> <span class="o">=</span> <span class="no">Form</span><span class="o">::</span><span class="no">NonModel</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">foo</span><span class="p">:</span> <span class="s1">&#39;foooo&#39;</span><span class="p">)</span>
</span><span class='line'><span class="n">invalid_form</span><span class="o">.</span><span class="n">valid?</span> <span class="c1">#=&gt; false</span>
</span><span class='line'><span class="n">invalid_form</span><span class="o">.</span><span class="n">errors</span> <span class="c1">#=&gt; #&lt;ActiveModel::Errors:0x007fe6bb19df58 @base=#&lt;Form::NonModel:0x007fe6beec6038 @errors=#&lt;ActiveModel::Errors:0x007fe6bb19df58 ...&gt;, @foo=&quot;foooo&quot;, @validation_context=nil&gt;, @messages={:bar=&gt;[&quot;を入力してください。&quot;]}&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>地味だけど、便利です。Fat Modelを避けるために、責務に応じたオブジェクトを作る際に適用範囲は広いです。</p>

<script async src="http://morizyun.github.io//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>


<!-- square -->


<p><ins class="adsbygoogle" style="display:inline-block;width:336px;height:280px" data-ad-client="ca-pub-4186413323075068" data-ad-slot="5059873392"></ins></p>

<script>
    (adsbygoogle = window.adsbygoogle || []).push({});
</script>


<h2>あどがき</h2>

<p>「<strong><a href="http://qiita.com/kbaba1001/items/e265ad1e40f238931468">Ruby - Rails のアーキテクチャ設計を考える - Qiita</a></strong>」も勉強になる。
チームへの導入コスト等も考えつつ、検討していきたい！</p>

<h2>Special Thanks</h2>

<ul>
<li><a href="http://tanihiro.hatenablog.com/entry/2014/01/09/193720">【ruby】ActiveModelを使ってDBと関係ないFormを作成する【Rails】 - tanihiro.log</a></li>
</ul>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Rails 4.2 + Bootstrap の Application template 1コマンドで！[Ruby 2.3]]]></title>
    <link href="http://morizyun.github.io/blog/rails4-application-templates-heroku/"/>
    <updated>2016-01-11T09:20:00+09:00</updated>
    <id>http://morizyun.github.io/blog/rails4-application-templates-heroku</id>
    <content type="html"><![CDATA[<p><a href="http://www.amazon.co.jp/gp/product/4839953554/ref=as_li_qf_sp_asin_il?ie=UTF8&camp=247&creative=1211&creativeASIN=4839953554&linkCode=as2&tag=morizyun00-22"><img border="0" src="http://ws.assoc-amazon.jp/widgets/q?_encoding=UTF8&ASIN=4839953554&Format=_SL160_&ID=AsinImage&MarketPlace=JP&ServiceVersion=20070822&WS=1&tag=morizyun00-22" width="150" style="float: left; margin: 0 20px 20px 0;" ></a><img src="http://www.assoc-amazon.jp/e/ir?t=morizyun00-22&l=as2&o=9&a=4839953554" width="1" height="1" border="0" alt="" style="border:none !important; margin:0px !important;" />
Application templateとは、Railsプロジェクトの時に必要になる定形の作業をスクリプトっぽく記述することが出来る仕組みです。
週末に簡単なアプリ作ったり、ハッカソンとか出場して1秒でも節約がしたい人におすすめの仕組みです。</p>

<p>今回いつも使っている<code>rails_template</code>をアップデートしてみました！</p>

<p><strong><a href="https://github.com/morizyun/rails4_template">morizyun/rails4_template</a></strong></p>

<p>もしよければこちらをForkして頂いて、自分好みにカスタマイズしてみてください＾＾</p>

<p><strong>(2016/01/11 9:20) Rails 4.2 x Ruby 2.3の動作確認。記事をリファクタリング。slim => faml/haml-railsに変更</strong></p>

<!-- more -->


<br style="clear:both;"/>


<script async src="http://morizyun.github.io//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>


<!-- square -->


<p><ins class="adsbygoogle" style="display:inline-block;width:336px;height:280px" data-ad-client="ca-pub-4186413323075068" data-ad-slot="5059873392"></ins></p>

<script>
    (adsbygoogle = window.adsbygoogle || []).push({});
</script>


<h2>事前準備</h2>

<p>まずは、手元のRubyとRailsを最新にしてください。</p>

<p>homebrew経由のrbenvのアップデート手順は、『<strong><a href="http://morizyun.github.io/blog/rbenv-update-brew-new-ruby-version/">rbenv を update して最新のRuby バージョンをインストール</a></strong>』をご参照ください。</p>

<p>次に<code>rails</code>もアップデートします。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="c"># railsのインストール</span>
</span><span class='line'><span class="nv">$ </span>gem install rails
</span><span class='line'>
</span><span class='line'><span class="c"># インストール済ならアップデート</span>
</span><span class='line'><span class="nv">$ </span>gem update rails
</span></code></pre></td></tr></table></div></figure>


<p>あと、gitignoreの生成ツール『<strong><a href="https://github.com/simonwhitaker/gibo">simonwhitaker/gibo</a></strong>』を使って<code>.gitignore</code>を生成していますので良ければぜひ！</p>

<p>Macな人は以下のコマンドを実行するだけでインストールできるので、めっちゃお勧めです。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>brew install gibo
</span></code></pre></td></tr></table></div></figure>


<h2>Application Templateの使い方</h2>

<p>使い方は以下のコマンドを実行するだけ。<br/>
(アプリ名の<code>test_app</code>はハイフンNGっす[修正トライ中&#8230;])</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="c"># PostgreSQL</span>
</span><span class='line'><span class="nv">$ </span>rails new test_app --database<span class="o">=</span>postgresql --skip-test-unit --skip-bundle -m https://raw.github.com/morizyun/rails4_template/master/app_template.rb
</span><span class='line'>
</span><span class='line'><span class="c"># MySQL</span>
</span><span class='line'><span class="nv">$ </span>rails new test_app --database<span class="o">=</span>mysql --skip-test-unit --skip-bundle -m https://raw.github.com/morizyun/rails4_template/master/app_template.rb
</span></code></pre></td></tr></table></div></figure>


<p>とするとモダンなRailsをtemplateの手順に従って構築していきます！</p>

<p>ちなみに使っているGemや実際にやっているコマンドなどは以下のリンクを参照してください。</p>

<p><strong><a href="https://github.com/morizyun/rails4_template/blob/master/app_template.rb">rails4_template/app_template.rb - morizyun/rails4_template</a></strong></p>

<script async src="http://morizyun.github.io//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>


<!-- square -->


<p><ins class="adsbygoogle" style="display:inline-block;width:336px;height:280px" data-ad-client="ca-pub-4186413323075068" data-ad-slot="5059873392"></ins></p>

<script>
    (adsbygoogle = window.adsbygoogle || []).push({});
</script>


<h2>Application Templateをカスタマイズする</h2>

<p>ここからは、Application Templateを変更する際に参考になりそうなサイトさんの一覧です。</p>

<p>まずは、Ruby on Rails Guidの説明。</p>

<p><a href="http://guides.rubyonrails.org/rails_application_templates.html"><img title="Now Capturing..." src="http://capture.heartrails.com/400x300/cool?http://guides.rubyonrails.org/rails_application_templates.html" alt="http://guides.rubyonrails.org/rails_application_templates.html" width="400" height="300" /></a></p>

<p>あとは、GitHubのApplication Templateを物色するのもあり。</p>

<p><a href="https://github.com/search?q=rails%20template&source=c"><img title="Now Capturing..." src="http://capture.heartrails.com/400x300/cool?https://github.com/search?q=rails%20template&source=c" alt="https://github.com/search?q=rails%20template&source=c" width="400" height="300" /></a></p>

<p>日本語の説明的にはこちらのQiitaの記事を拝見してモチベーションが上がりました！</p>

<p><a href="http://qiita.com/tachiba/items/26b2e9dc271bd8e6907d"><img title="Now Capturing..." src="http://capture.heartrails.com/400x300/cool?http://qiita.com/tachiba/items/26b2e9dc271bd8e6907d" alt="http://qiita.com/tachiba/items/26b2e9dc271bd8e6907d" width="400" height="300" /></a></p>

<p>あとはこちらのスライドもApplication Templateの良さをわかり易く説明して頂いてます！かなり参考人させていただきました。</p>

<iframe src="http://www.slideshare.net/slideshow/embed_code/27829933" width="597" height="486" frameborder="0" marginwidth="0" marginheight="0" scrolling="no" style="border:1px solid #CCC;border-width:1px 1px 0;margin-bottom:5px" allowfullscreen> </iframe>


<h2>今回の公開物</h2>

<p>多分ただでさえ、僕個人の環境でしか動かない可能性が高いのに、さらに変更しまくっているので、動かない時も多いかと思います。
でも、公開してツッコミをもらって、templateをしっかり成長させれば、汎用的なRailsアプリ作成の省力化に貢献できると信じています。</p>

<p><strong><a href="https://github.com/morizyun/rails4_template">morizyun/rails4_template</a></strong></p>

<p><a href="https://github.com/morizyun/rails4_template"><img title="Now Capturing..." src="http://capture.heartrails.com/400x300/cool?https://github.com/morizyun/rails4_template" alt="https://github.com/morizyun/rails4_template" width="400" height="300" /></a></p>

<h2>変更来歴</h2>

<p>(2014-01/04 09:40) giboの説明を追加<br/>
(2014-01/04 11:35) Redisを超簡単セットアップを追加<br/>
(2015-01-03 10:40) haml => slimに変更とか<br/>
(2016-01-11 09:20) Rails 4.2 x Ruby 2.3の動作確認。記事をリファクタリング。slim => faml/haml-railsに変更<br/></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[kaminariをBootstrap3、Rails4.2環境で使う！[Ruby 2.3]]]></title>
    <link href="http://morizyun.github.io/blog/kaminari-gem-paginator-rails/"/>
    <updated>2016-01-11T09:10:00+09:00</updated>
    <id>http://morizyun.github.io/blog/kaminari-gem-paginator-rails</id>
    <content type="html"><![CDATA[<p><a href="http://www.amazon.co.jp/gp/product/4048916599/ref=as_li_qf_sp_asin_il?ie=UTF8&camp=247&creative=1211&creativeASIN=4048916599&linkCode=as2&tag=morizyun00-22"><img border="0" src="http://ws.assoc-amazon.jp/widgets/q?_encoding=UTF8&ASIN=4048916599&Format=_SL160_&ID=AsinImage&MarketPlace=JP&ServiceVersion=20070822&WS=1&tag=morizyun00-22" width="150" style="float: left; margin: 0 20px 20px 0;" ></a><img src="http://www.assoc-amazon.jp/e/ir?t=morizyun00-22&l=as2&o=9&a=4048916599" width="1" height="1" border="0" alt="" style="border:none !important; margin:0px !important;" />
Rails 4でも不動の人気を誇るページネーター「<strong><a href="https://github.com/amatsuda/kaminari#customizing-the-pagination-helper">amatsuda/kaminari</a></strong>」を
Bootstrap3、Rails4環境で使うための導入手順です。びっくりするくらい簡単に導入できちゃいますよ！</p>

<p><strong>(2016/01/11) Rails 4.2 x Ruby 2.3の動作確認。記事をリファクタリング</strong></p>

<!-- more -->


<br style="clear:both;"/>


<h2>まえおき</h2>

<p>この記事は、Bootstrap環境を構築済の前提で話を進めます。もし、Bootstrap環境の構築からスタートしたい場合は、
拙著『<strong><a href="http://morizyun.github.io/blog/rails4-application-templates-heroku/">Rails 4.2 + Bootstrap の Application template 1コマンドでモダンRailsが！</a></strong>』をご参照頂ければ幸甚です！</p>

<h2>Gemインストール</h2>

<p>Gemfileに以下を追加して、<code>bundle install</code>を実行。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="c1"># Gemfile</span>
</span><span class='line'><span class="c1"># Pagenation</span>
</span><span class='line'><span class="n">gem</span> <span class="s1">&#39;kaminari&#39;</span>
</span></code></pre></td></tr></table></div></figure>


<h2>kaminari configの設定</h2>

<p>kaminariのconfig(設定)ファイルを生成。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>rails g kaminari:config
</span></code></pre></td></tr></table></div></figure>


<p><code>config/initializers/kaminari_config.rb</code>を構築するサイトに合わせて各種パラメータを調整。
パラメータの詳細は『 <strong><a href="https://github.com/amatsuda/kaminari#general-configuration-options">amatsuda/kaminari | GitHub</a></strong>』を参照。</p>

<h2>Controller/Viewへの設置</h2>

<p>Controllerでページネーションをするための変数を追加。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="vi">@users</span> <span class="o">=</span> <span class="no">User</span><span class="o">.</span><span class="n">order</span><span class="p">(</span><span class="ss">:name</span><span class="p">)</span><span class="o">.</span><span class="n">page</span><span class="p">(</span><span class="n">params</span><span class="o">[</span><span class="ss">:page</span><span class="o">]</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>Viewでページネーションを表示したい場所に以下のコードを追加。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='haml'><span class='line'><span class="p">=</span> <span class="n">paginate</span> <span class="vi">@users</span>
</span></code></pre></td></tr></table></div></figure>


<h2>ベージネーションViewのテンプレート取得</h2>

<p>次のコマンドを実行すると <code>/app/view/kaminari/</code> フォルダにBootstrap用のViewを生成してくれます。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>rails g kaminari:views bootstrap3
</span></code></pre></td></tr></table></div></figure>


<h2>ページネーターの表示カスタマイズ</h2>

<p>ページネーションの文言(prevやnextなど)の変更程度であれば、i18nの日本語設定ファイルに以下の内容を追加するだけで解決します。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="c1"># conifg/locales/ja.yml</span>
</span><span class='line'><span class="n">ja</span><span class="p">:</span>
</span><span class='line'>  <span class="n">views</span><span class="p">:</span>
</span><span class='line'>    <span class="n">pagination</span><span class="p">:</span>
</span><span class='line'>      <span class="n">first</span><span class="p">:</span> <span class="s2">&quot;&amp;laquo;&quot;</span>
</span><span class='line'>      <span class="n">last</span><span class="p">:</span> <span class="s2">&quot;&amp;raquo;&quot;</span>
</span><span class='line'>      <span class="n">previous</span><span class="p">:</span> <span class="s2">&quot;&amp;lsaquo;&quot;</span>
</span><span class='line'>      <span class="k">next</span><span class="p">:</span> <span class="s2">&quot;&amp;rsaquo;&quot;</span>
</span><span class='line'>      <span class="n">truncate</span><span class="p">:</span> <span class="s2">&quot;...&quot;</span>
</span></code></pre></td></tr></table></div></figure>


<p>上は英語部分を外して、記号を残した場合の例です。これだけでもシンプルでわかりやすいですよ！</p>

<p><img src="http://farm9.staticflickr.com/8477/8250145044_9193f27280_n.jpg" width="320" height="42" alt="fpu_tmp_1354804296.8519_d61bda"></p>

<script async src="http://morizyun.github.io//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>


<!-- square -->


<p><ins class="adsbygoogle" style="display:inline-block;width:336px;height:280px" data-ad-client="ca-pub-4186413323075068" data-ad-slot="5059873392"></ins></p>

<script>
    (adsbygoogle = window.adsbygoogle || []).push({});
</script>


<h2>ルーティングの設定</h2>

<p>ルーティングを以下の様に変更します。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="c1"># config/routes.rb</span>
</span><span class='line'><span class="n">resources</span> <span class="ss">:users</span> <span class="k">do</span>
</span><span class='line'>  <span class="n">get</span> <span class="s1">&#39;page/:page&#39;</span><span class="p">,</span> <span class="ss">:action</span> <span class="o">=&gt;</span> <span class="ss">:index</span><span class="p">,</span> <span class="ss">:on</span> <span class="o">=&gt;</span> <span class="ss">:collection</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>このルーティングのメリットは次の通り。</p>

<pre>
* SEO的に良い、ユーザーフレンドリーである
* params pageがURLセグメントの一部 => RailsのPageキャシュが有効に
</pre>


<h2>表示確認</h2>

<p>ブラウザで表示を確認します。以下は今回作ったサンプルページネーションです。</p>

<p><img src="http://farm9.staticflickr.com/8340/8244955784_4b2ae33c4a_n.jpg" width="320" height="44" alt="fpu_tmp_1354636719.4462_910632"></p>

<h2>(補足) プレゼンターのGem Draperと共存させる場合</h2>

<p>kaminariとプレゼンターのDraperを使う場合は、Draperがうまくkaminariのメソッドを呼び出せない場合があります。<br/></p>

<p>その場合は、<code>config/initializers/draper.rb</code>を作成して以下を記入しておくとエラーを回避できます。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="no">Draper</span><span class="o">::</span><span class="no">CollectionDecorator</span><span class="o">.</span><span class="n">delegate</span> <span class="ss">:current_page</span><span class="p">,</span> <span class="ss">:total_pages</span><span class="p">,</span> <span class="ss">:limit_value</span><span class="p">,</span> <span class="ss">:total_count</span>
</span></code></pre></td></tr></table></div></figure>


<p><strong><a href="https://github.com/drapergem/draper/issues/401">Kaminari vs Draper · Issue #401 · drapergem/draper</a></strong></p>

<script async src="http://morizyun.github.io//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>


<!-- square -->


<p><ins class="adsbygoogle" style="display:inline-block;width:336px;height:280px" data-ad-client="ca-pub-4186413323075068" data-ad-slot="5059873392"></ins></p>

<script>
    (adsbygoogle = window.adsbygoogle || []).push({});
</script>


<h2>Special Thanks</h2>

<p><strong><a href="https://github.com/amatsuda/kaminari#customizing-the-pagination-helper">amatsuda/kaminari | GitHub</a></strong></p>

<p><strong><a href="https://github.com/amatsuda/kaminari/wiki/Kaminari-recipes">Kaminari recipes | amatsuda/kaminari | GitHub wiki</a></strong></p>

<p><strong><a href="http://d.hatena.ne.jp/CortYuming/20131027/p1">ささっと Rails4 + Bootstrap3 + kaminari でゲストブック作成してみるメモ - 牌語備忘録 - pygo</a></strong></p>

<h2>変更来歴</h2>

<p>(2013/04/18 23:35) 補足: プレゼンターDraperと共存させる場合を追加<br/>
(2013/12/23 20:15) Bootstrap3、Rails4に対応<br/>
(2015/12/20 18:30) コマンドを修正<br/>
(2016/01/11 09:10) Rails 4.2 x Ruby 2.3の動作確認。記事をリファクタリング<br/></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Wheneverは導入が超簡単なcrontab管理ライブラリGemです！[Rails4.2 x Ruby2.3]]]></title>
    <link href="http://morizyun.github.io/blog/whenever-gem-rails-ruby-capistrano/"/>
    <updated>2016-01-10T14:45:00+09:00</updated>
    <id>http://morizyun.github.io/blog/whenever-gem-rails-ruby-capistrano</id>
    <content type="html"><![CDATA[<p><a href="http://www.amazon.co.jp/gp/product/B016QEE30G/ref=as_li_qf_sp_asin_il?ie=UTF8&camp=247&creative=1211&creativeASIN=B016QEE30G&linkCode=as2&tag=morizyun00-22"><img border="0" src="http://ws.assoc-amazon.jp/widgets/q?_encoding=UTF8&ASIN=B016QEE30G&Format=_SL160_&ID=AsinImage&MarketPlace=JP&ServiceVersion=20070822&WS=1&tag=morizyun00-22" width="150" style="float: left; margin: 0 20px 20px 0;" ></a><img src="http://www.assoc-amazon.jp/e/ir?t=morizyun00-22&l=as2&o=9&a=B016QEE30G" width="1" height="1" border="0" alt="" style="border:none !important; margin:0px !important;" />wheneverはcrontab管理ライブラリです。導入はすごく簡単ですし、RailsやCapistranoとの連携もスムーズで楽ちんです！定期実行するような処理がある場合はぜひご検討ください！</p>

<p><a href="https://github.com/javan/whenever" title="javan/whenever · GitHub" class="button big primary">javan/whenever · GitHub</a></p>

<p><strong>(2016/01/10) Rails 4.2 x Ruby 2.3の動作確認。記事をリファクタリング</strong></p>

<!-- more -->


<br style="clear:both;"/>


<script async src="http://morizyun.github.io//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>


<!-- square -->


<p><ins class="adsbygoogle" style="display:inline-block;width:336px;height:280px" data-ad-client="ca-pub-4186413323075068" data-ad-slot="5059873392"></ins></p>

<script>
    (adsbygoogle = window.adsbygoogle || []).push({});
</script>


<h2>Gemのインストール</h2>

<p>いつもどおり<code>Gemfile</code>に以下を追加して、<code>bundle install</code>を実行してください。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="c1"># Gemfile</span>
</span><span class='line'><span class="c1"># crontab管理</span>
</span><span class='line'><span class="n">gem</span> <span class="s1">&#39;whenever&#39;</span><span class="p">,</span> <span class="nb">require</span><span class="p">:</span> <span class="kp">false</span>
</span></code></pre></td></tr></table></div></figure>


<h2>whenever設定ファイルschedule.rbを作成</h2>

<p>以下のコマンドを実行してconfig/schedule.rb</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>bundle <span class="nb">exec </span>wheneverize .
</span><span class='line'>&gt; <span class="o">[</span>add<span class="o">]</span> writing <span class="sb">`</span>./config/schedule.rb<span class="err">&#39;</span>
</span><span class='line'>&gt; <span class="o">[</span><span class="k">done</span><span class="o">]</span> wheneverized! <span class="c">#&lt;= 成功</span>
</span></code></pre></td></tr></table></div></figure>


<h2>wheneverのコマンドの解説</h2>

<p>wheneverでは以下の4つをスケジューリングできます。</p>

<pre>
command: bashコマンド実行
rake: rakeタスク実行
runner: Rails内のメソッド実行
script: scriptの実行
</pre>


<h2>設定の具体例</h2>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="c1"># config/schedule.rb</span>
</span><span class='line'>
</span><span class='line'><span class="c1"># 出力先のログファイルの指定</span>
</span><span class='line'><span class="n">set</span> <span class="ss">:output</span><span class="p">,</span> <span class="s1">&#39;log/crontab.log&#39;</span>
</span><span class='line'><span class="c1"># ジョブの実行環境の指定</span>
</span><span class='line'><span class="n">set</span> <span class="ss">:environment</span><span class="p">,</span> <span class="ss">:production</span>
</span><span class='line'>
</span><span class='line'><span class="c1"># 3時間毎に実行するスケジューリング</span>
</span><span class='line'><span class="n">every</span> <span class="mi">3</span><span class="o">.</span><span class="n">hours</span> <span class="k">do</span>
</span><span class='line'>  <span class="n">runner</span> <span class="s1">&#39;MyModel.some_process&#39;</span>
</span><span class='line'>  <span class="n">rake</span> <span class="s1">&#39;my:rake:task&#39;</span>
</span><span class='line'>  <span class="n">command</span> <span class="s1">&#39;/usr/bin/my_great_command&#39;</span>
</span><span class='line'><span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="c1"># 毎日 am4:30のスケジューリング</span>
</span><span class='line'><span class="n">every</span> <span class="mi">1</span><span class="o">.</span><span class="n">day</span><span class="p">,</span> <span class="n">at</span><span class="p">:</span> <span class="s1">&#39;4:30 am&#39;</span> <span class="k">do</span>
</span><span class='line'>  <span class="n">runner</span> <span class="s1">&#39;MyModel.task_to_run_at_four_thirty_in_the_morning&#39;</span>
</span><span class='line'><span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="c1"># 一時間毎のスケジューリング</span>
</span><span class='line'><span class="n">every</span> <span class="ss">:hour</span> <span class="k">do</span> <span class="c1"># Many shortcuts available: :hour, :day, :month, :year, :reboot</span>
</span><span class='line'>  <span class="n">runner</span> <span class="s1">&#39;SomeModel.ladeeda&#39;</span>
</span><span class='line'><span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="c1"># 日曜日のpm12時にスケジューリング</span>
</span><span class='line'><span class="n">every</span> <span class="ss">:sunday</span><span class="p">,</span> <span class="n">at</span><span class="p">:</span> <span class="s1">&#39;12pm&#39;</span> <span class="k">do</span> <span class="c1"># Use any day of the week or :weekend, :weekday</span>
</span><span class='line'>  <span class="n">runner</span> <span class="s1">&#39;Task.do_something_great&#39;</span>
</span><span class='line'><span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="c1"># crontab型の設定「分」「時」「日」「月」「曜日」</span>
</span><span class='line'><span class="c1"># 毎月27日〜31日まで0:00に実行</span>
</span><span class='line'><span class="n">every</span> <span class="s1">&#39;0 0 27-31 * * &#39;</span> <span class="k">do</span>
</span><span class='line'>  <span class="n">command</span> <span class="s1">&#39;echo &#39;</span><span class="n">you</span> <span class="n">can</span> <span class="n">use</span> <span class="n">raw</span> <span class="n">cron</span> <span class="n">syntax</span> <span class="n">too</span><span class="s1">&#39;&#39;</span>
</span><span class='line'><span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="c1"># 6-24時まで3時間おきに実行</span>
</span><span class='line'><span class="n">work_hour_per_two</span> <span class="o">=</span> <span class="p">(</span><span class="mi">6</span><span class="o">.</span><span class="n">.</span><span class="mi">24</span><span class="p">)</span><span class="o">.</span><span class="n">select</span><span class="p">{</span> <span class="o">|</span><span class="n">_</span><span class="o">|</span> <span class="n">_</span><span class="o">%</span><span class="mi">3</span> <span class="o">==</span> <span class="mi">0</span> <span class="p">}</span><span class="o">.</span><span class="n">map</span> <span class="p">{</span><span class="o">|</span><span class="n">_</span><span class="o">|</span> <span class="s2">&quot;</span><span class="si">#{</span><span class="n">_</span><span class="si">}</span><span class="s2">:00&quot;</span> <span class="p">}</span>
</span><span class='line'><span class="n">every</span> <span class="mi">1</span><span class="o">.</span><span class="n">day</span><span class="p">,</span> <span class="n">at</span><span class="p">:</span> <span class="n">work_hour_per_two</span> <span class="k">do</span>
</span><span class='line'>  <span class="n">rake</span> <span class="s1">&#39;my:rake:task&#39;</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>




<script async src="http://morizyun.github.io//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>


<!-- square -->


<p><ins class="adsbygoogle" style="display:inline-block;width:336px;height:280px" data-ad-client="ca-pub-4186413323075068" data-ad-slot="5059873392"></ins></p>

<script>
    (adsbygoogle = window.adsbygoogle || []).push({});
</script>


<h2>Corntabへの設定</h2>

<p>crontab に設定する際のコマンドは以下のとおり。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="c"># wheneverの設定更新</span>
</span><span class='line'><span class="nv">RAILS_ENV</span><span class="o">=</span>development bundle <span class="nb">exec </span>whenever --update-crontab
</span><span class='line'>
</span><span class='line'><span class="c"># crontabの設定削除</span>
</span><span class='line'><span class="nv">RAILS_ENV</span><span class="o">=</span>development bundle <span class="nb">exec </span>whenever --clear-crontab
</span></code></pre></td></tr></table></div></figure>


<p>詳しい設定方法はGitHubの公式ページへ。</p>

<p><a href="https://github.com/javan/whenever" title="javan/whenever · GitHub" class="button big primary">javan/whenever · GitHub</a></p>

<h2>Capistranoとの連携</h2>

<p>Capistranoについての詳しい記事は、『<strong><a href="http://morizyun.github.io/blog/capistrano3-rails-deploy-multi-rbenv/">Capistrano 3系でRails4.1のデプロイ</a></strong>』です。興味があれば是非ご一読下さい。</p>

<h3>capistrano/wheneverの基本的な連携</h3>

<p>wheneverの特徴の一つとして、Deployプロセスの自動化をしてくれるGem Capistranoと簡単に連携できる点があります。</p>

<p>設定方法は、まず以下を<code>Capfile</code>に追記。</p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>require <span class="s1">&#39;whenever/capistrano&#39;</span>
</span></code></pre></td></tr></table></div></figure>


<p>続いて、<code>config/deploy.rb</code>に以下を追記。</p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nb">set</span> :whenever_identifier, -&gt;<span class="o">{</span> <span class="s2">&quot;#{fetch(:application)}_#{fetch(:stage)}&quot;</span> <span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>あとは<code>cap deploy</code>のたびにcrontabをアプデートしてくれます。</p>

<h2>capistrano/wheneverで環境ごとに設定を変更したい場合</h2>

<p>以下の記事を見ながら設定すれば出来る気がします<sup>^</sup></p>

<ul>
<li><strong><a href="http://qiita.com/zaru/items/348c126a205a2e48b4d6">Rails - Wheneverで環境ごとにschedule内容を変更する</a></strong></li>
<li><strong><a href="https://github.com/javan/whenever/wiki/Setting-variables-on-the-fly">Setting variables on the fly · javan/whenever Wiki</a></strong></li>
</ul>


<h2>Special Thanks</h2>

<p><a href="http://higelog.brassworks.jp/?p=1554">CapistranoでWhenever | ひげろぐ</a></p>

<p><a href="http://www.logiclogic.jp/blog/tech/backend/124/">capistrano+wheneverで簡単cron管理-logiclogic&#8217;s blog | logiclogic&#8217;s blog</a></p>

<h2>変更来歴</h2>

<p>(12/12/24 xx:xx) 新規作成<br/>
(13/01/07 18:35) 「補足：別ファイルにローカルタスク用の設定を書く」を追加<br/>
(13/01/08 23:50) 「補足：複数環境でwheneverを使いたい場合&#8230;」を修正<br/>
(14/04/23 22:20) Rails4.1対応、全面書き直し！<br/>
(14/07/10 20:15) 環境ごとにcronの設定を切り替える方法を追記<br/>
(14/11/02 15:25) capistranoで環境ごとに処理を振り分ける方法がrvmのパスが変わってうまく動かなくなったので一度削除<br/>
(15/11/15 17:15) wheneverコマンドの記述を追加<br/>
(16/01/10 14:40) bundle exec を追加。Rails 4.2 x Ruby 2.3.0 動作確認<br/></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[ActionMailer Railsアプリからメールを送信[Rails4.2 x Ruby2.3]]]></title>
    <link href="http://morizyun.github.io/blog/action-mailer-rails-mail/"/>
    <updated>2016-01-10T14:15:00+09:00</updated>
    <id>http://morizyun.github.io/blog/action-mailer-rails-mail</id>
    <content type="html"><![CDATA[<p><a href="http://www.amazon.co.jp/gp/product/4873113946/ref=as_li_qf_sp_asin_il?ie=UTF8&camp=247&creative=1211&creativeASIN=4873113946&linkCode=as2&tag=morizyun00-22"><img border="0" src="http://ws.assoc-amazon.jp/widgets/q?_encoding=UTF8&ASIN=4873113946&Format=_SL160_&ID=AsinImage&MarketPlace=JP&ServiceVersion=20070822&WS=1&tag=morizyun00-22" width="150" style="float: left; margin: 0 20px 20px 0;" ></a><img src="http://www.assoc-amazon.jp/e/ir?t=morizyun00-22&l=as2&o=9&a=4873113946" width="1" height="1" border="0" alt="" style="border:none !important; margin:0px !important;" />Railsにはメールを送信してくれるActionMailerという機能が標準で組み込まれています。
この機能を使えば、メールを送信するタイプのWebアプリを簡単に構築出来ます。
今回はActionMailerの基本的な設定の使い方を説明します。</p>

<p><strong>(2016/01/10) Rails 4.2 x Ruby 2.3の動作確認。記事をリファクタリング</strong></p>

<!-- more -->


<br style="clear:both;"/>


<script async src="http://morizyun.github.io//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>


<!-- square -->


<p><ins class="adsbygoogle" style="display:inline-block;width:336px;height:280px" data-ad-client="ca-pub-4186413323075068" data-ad-slot="5059873392"></ins></p>

<script>
    (adsbygoogle = window.adsbygoogle || []).push({});
</script>


<h2>環境設定</h2>

<p>Development環境で、メール送信に関するエラーをログに出力するようにします。<br/></p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="c1"># config/environments/development.rb</span>
</span><span class='line'><span class="n">config</span><span class="o">.</span><span class="n">action_mailer</span><span class="o">.</span><span class="n">raise_delivery_errors</span> <span class="o">=</span> <span class="kp">true</span>
</span></code></pre></td></tr></table></div></figure>


<p><code>TestApp::Application.configure</code>内にメール送信用の設定をして下さい。今回はGmailを使う場合の設定を載せています。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="c1"># config/environments/development.rb</span>
</span><span class='line'><span class="c1"># ↓ 以下を追加</span>
</span><span class='line'><span class="n">config</span><span class="o">.</span><span class="n">action_mailer</span><span class="o">.</span><span class="n">default_url_options</span> <span class="o">=</span> <span class="p">{</span> <span class="ss">:host</span> <span class="o">=&gt;</span> <span class="s2">&quot;localhost&quot;</span><span class="p">,</span> <span class="ss">:port</span> <span class="o">=&gt;</span> <span class="mi">3000</span> <span class="p">}</span>
</span><span class='line'>  <span class="n">config</span><span class="o">.</span><span class="n">action_mailer</span><span class="o">.</span><span class="n">delivery_method</span> <span class="o">=</span> <span class="ss">:smtp</span>
</span><span class='line'>  <span class="n">config</span><span class="o">.</span><span class="n">action_mailer</span><span class="o">.</span><span class="n">smtp_settings</span> <span class="o">=</span> <span class="p">{</span>
</span><span class='line'>    <span class="ss">:address</span> <span class="o">=&gt;</span> <span class="s2">&quot;smtp.gmail.com&quot;</span><span class="p">,</span>
</span><span class='line'>    <span class="ss">:port</span> <span class="o">=&gt;</span> <span class="mi">587</span><span class="p">,</span>
</span><span class='line'>    <span class="ss">:domain</span> <span class="o">=&gt;</span> <span class="s1">&#39;example.com&#39;</span><span class="p">,</span>
</span><span class='line'>    <span class="ss">:user_name</span> <span class="o">=&gt;</span> <span class="s2">&quot;メールサーバ認証用ユーザー&quot;</span><span class="p">,</span>
</span><span class='line'>    <span class="ss">:password</span> <span class="o">=&gt;</span> <span class="s2">&quot;メールサーバ認証用パスワード&quot;</span><span class="p">,</span>
</span><span class='line'>    <span class="ss">:authentication</span> <span class="o">=&gt;</span> <span class="s1">&#39;plain&#39;</span><span class="p">,</span>
</span><span class='line'>    <span class="ss">:enable_starttls_auto</span> <span class="o">=&gt;</span> <span class="kp">true</span><span class="p">,</span>
</span><span class='line'>  <span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<h2>ActionMailerのクラスを生成</h2>

<p>以下のコマンドで、ActionMailerのクラスを生成できます。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>rails g mailer message hello
</span><span class='line'>      create  app/mailers/message.rb
</span><span class='line'>      create  app/mailers/application_mailer.rb
</span><span class='line'>      invoke  haml
</span><span class='line'>      create    app/views/message
</span><span class='line'>      create    app/views/message/hello.text.haml
</span><span class='line'>      invoke  rspec
</span><span class='line'>      create    spec/mailers/message_spec.rb
</span><span class='line'>      create    spec/fixtures/message/hello
</span><span class='line'>      create    spec/mailers/previews/message_preview.rb
</span></code></pre></td></tr></table></div></figure>




<script async src="http://morizyun.github.io//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>


<!-- square -->


<p><ins class="adsbygoogle" style="display:inline-block;width:336px;height:280px" data-ad-client="ca-pub-4186413323075068" data-ad-slot="5059873392"></ins></p>

<script>
    (adsbygoogle = window.adsbygoogle || []).push({});
</script>


<h2>ActionMailerのクラスの編集</h2>

<p>次にActionMailerでメールを送信してみます。</p>

<p>まずは、メインのメソッドを作成します。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="c1"># app/mailers/message.rb</span>
</span><span class='line'><span class="k">class</span> <span class="nc">Message</span> <span class="o">&lt;</span> <span class="no">ActionMailer</span><span class="o">::</span><span class="no">Base</span>
</span><span class='line'>  <span class="c1"># デフォルトでの送信元のアドレス</span>
</span><span class='line'>  <span class="n">default</span> <span class="n">from</span><span class="p">:</span> <span class="s2">&quot;from@example.com&quot;</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">hello</span><span class="p">(</span><span class="nb">name</span><span class="p">)</span>
</span><span class='line'>    <span class="vi">@name</span> <span class="o">=</span> <span class="nb">name</span>
</span><span class='line'>    <span class="n">mail</span><span class="p">(</span>
</span><span class='line'>      <span class="n">to</span><span class="p">:</span>      <span class="s1">&#39;to@example.net&#39;</span><span class="p">,</span>
</span><span class='line'>      <span class="n">subject</span><span class="p">:</span> <span class="s1">&#39;Mail from Message&#39;</span><span class="p">,</span>
</span><span class='line'>    <span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="nb">format</span><span class="o">|</span>
</span><span class='line'>      <span class="nb">format</span><span class="o">.</span><span class="n">html</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>メール用のViewを編集します。ファイル名を変えれば、html形式だけではなく、text形式でも利用可能です。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='haml'><span class='line'><span class="cp">-# app/views/message/hello.html.haml</span>
</span><span class='line'><span class="p">=</span> <span class="s2">&quot;There is </span><span class="si">#{</span><span class="vi">@name</span><span class="si">}</span><span class="s2">&#39;s body.&quot;</span>
</span></code></pre></td></tr></table></div></figure>


<p>コマンドラインからメールを送信してみます。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="c"># Rails console に入る</span>
</span><span class='line'><span class="nv">$ </span>rails c
</span><span class='line'>
</span><span class='line'><span class="c"># メール送信</span>
</span><span class='line'>Message.hello.deliver
</span></code></pre></td></tr></table></div></figure>


<p>これでメールが、Messageクラスの『to@example.org』に送信されていれば、メール送信成功です。</p>

<h2>補足：ActionMailerのView内でHelperメソッドを使う場合</h2>

<p>ActionMailerのView内でhelperメソッドを使いたい場合は、<code>add_template_helper(ApplicationHelper)</code>を追加すればつかえるようになるそうです。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="c1"># app/mailers/message.rb</span>
</span><span class='line'><span class="k">class</span> <span class="nc">Message</span> <span class="o">&lt;</span> <span class="no">ActionMailer</span><span class="o">::</span><span class="no">Base</span>
</span><span class='line'>  <span class="n">add_template_helper</span><span class="p">(</span><span class="no">ApplicationHelper</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<h2>Special Thanks</h2>

<ul>
<li><strong><a href="http://blog.scimpr.com/2012/09/15/rails%E3%81%A7%E3%83%A1%E3%83%BC%E3%83%AB%E9%80%81%E4%BF%A1%E3%82%92%E3%83%86%E3%82%B9%E3%83%88%EF%BD%9Eactionmailer/">Railsでメール送信をテスト～ActionMailer | Scimpr Blog</a></strong></li>
<li><strong><a href="http://qiita.com/items/688d383dc831c8b9a7f9">Rubyでメールを送る #Ruby #mail #ActionMailer - Qiita</a></strong></li>
<li><strong><a href="http://d.hatena.ne.jp/babie/20100807/1281141307">Rails 3.0 でメールの送信に Gmail を使う - LazyLoadLife</a></strong></li>
<li><strong><a href="http://stackoverflow.com/questions/1416978/how-to-use-my-view-helpers-in-my-actionmailer-views">ruby on rails - How to use my view helpers in my ActionMailer views? - Stack Overflow</a></strong></li>
</ul>


<h2>変更来歴</h2>

<ul>
<li>2013/02/13 20:55 新規作成<br/></li>
<li>2013/03/02 13:20 『補足：ActionMailerのView内でHelperメソッドを使う場合』を追記<br/></li>
<li>2016/01/10 14:15 最新の状況に合わせて内容をリファクタリング<br/></li>
</ul>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[figaro HerokuやDokkuの環境変数の管理に便利！]]></title>
    <link href="http://morizyun.github.io/blog/figaro-config-heroku-dokku-rails-ruby/"/>
    <updated>2016-01-09T23:55:00+09:00</updated>
    <id>http://morizyun.github.io/blog/figaro-config-heroku-dokku-rails-ruby</id>
    <content type="html"><![CDATA[<p><a href="http://www.amazon.co.jp/gp/product/B00NXMTLHK/ref=as_li_qf_sp_asin_il?ie=UTF8&camp=247&creative=1211&creativeASIN=B00NXMTLHK&linkCode=as2&tag=morizyun00-22"><img border="0" src="http://ws.assoc-amazon.jp/widgets/q?_encoding=UTF8&ASIN=B00NXMTLHK&Format=_SL160_&ID=AsinImage&MarketPlace=JP&ServiceVersion=20070822&WS=1&tag=morizyun00-22" width="150" style="float: left; margin: 0 20px 20px 0;" ></a><img src="http://www.assoc-amazon.jp/e/ir?t=morizyun00-22&l=as2&o=9&a=B00NXMTLHK" width="1" height="1" border="0" alt="" style="border:none !important; margin:0px !important;" />
HerokuやDokkuで使う環境変数を管理するGem「<strong><a href="https://github.com/laserlemon/figaro">laserlemon/figaro</a></strong>」の紹介です。
モダンなWebアプリケーションの設計の指針とも言える「<strong><a href="http://12factor.net/ja/">Twelve-Factor App</a></strong>」を実現するのを手助けしてくれる素晴らしいGemです。</p>

<!-- more -->


<br style="clear:both;"/>


<script async src="http://morizyun.github.io//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>


<!-- square -->


<p><ins class="adsbygoogle" style="display:inline-block;width:336px;height:280px" data-ad-client="ca-pub-4186413323075068" data-ad-slot="5059873392"></ins></p>

<script>
    (adsbygoogle = window.adsbygoogle || []).push({});
</script>


<h2>Twelve-Factor App</h2>

<p>「<strong><a href="http://12factor.net/ja/">Twelve-Factor App</a></strong>」にある通り、次の設計指針のことです。
今回のFigaroは(3)の設定を環境変数に格納するためのものです。</p>

<pre>
(1) コードベース : バージョン管理されている1つのコードベースがあり、それにより複数の環境にデプロイできる
(2) 依存関係 : 依存関係を明示的に宣言し分離する
(3) 設定 : 設定を環境変数に格納する
(4) バックエンドサービス : バックエンドのサービスをアタッチされたリソースとして扱う
(5) ビルド、リリース、実行 : ビルド、リリース、実行の3つのステージをちゃんと分離する
(6) プロセス : アプリケーションを1つもしくは複数のステートレスなプロセスとして実行する
(7) ポートバインディング : ポートバインディングを通してサービスを公開する
(8) 並行性 : プロセスモデルによってスケールアウトする
(9) 廃棄容易性 : 高速な起動とグレースフルシャットダウンで堅牢性を最大化する
(10) 開発/本番一致 : 開発、ステージング、本番環境をできるだけ一致させた状態を保つ
(11) ログ : ログをイベントストリームとして扱う
(12) 管理プロセス : 管理タスクを1回限りのプロセスとして実行する
</pre>


<h2>Gemのインストール</h2>

<p><code>Gemfile</code>に以下を追加して、<code>bundle install</code>を実行してください。
下記は用途に合わせてどちらかをお使いください。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="c1"># 公式のものを使う場合(Dokku非対応の公式のものを使う場合はこちら)</span>
</span><span class='line'><span class="n">gem</span> <span class="s1">&#39;figaro&#39;</span>
</span><span class='line'>
</span><span class='line'><span class="c1"># Dokku対応を行ったバージョンです(PR中なのでそのうち本体に取り込まれるかも)</span>
</span><span class='line'><span class="n">gem</span> <span class="s1">&#39;figaro&#39;</span><span class="p">,</span> <span class="n">github</span><span class="p">:</span> <span class="s1">&#39;morizyun/figaro&#39;</span>
</span></code></pre></td></tr></table></div></figure>


<h2>設定方法</h2>

<p>以下の様に設定してください。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="c1"># config/application.yml</span>
</span><span class='line'>
</span><span class='line'><span class="n">pusher_app_id</span><span class="p">:</span> <span class="s2">&quot;2954&quot;</span>
</span><span class='line'><span class="n">pusher_key</span><span class="p">:</span> <span class="s2">&quot;7381a978f7dd7f9a1117&quot;</span>
</span><span class='line'><span class="n">pusher_secret</span><span class="p">:</span> <span class="s2">&quot;abdc3b896a0ffb85d373&quot;</span>
</span><span class='line'>
</span><span class='line'><span class="nb">test</span><span class="p">:</span>
</span><span class='line'>  <span class="n">pusher_app_id</span><span class="p">:</span> <span class="s2">&quot;5112&quot;</span>
</span><span class='line'>  <span class="n">pusher_key</span><span class="p">:</span> <span class="s2">&quot;ad69caf9a44dcac1fb28&quot;</span>
</span><span class='line'>  <span class="n">pusher_secret</span><span class="p">:</span> <span class="s2">&quot;83ca7aa160fedaf3b350&quot;</span>
</span></code></pre></td></tr></table></div></figure>


<p>Railsアプリ側からは次のように扱います。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="c1"># config/initializers/pusher.rb</span>
</span><span class='line'>
</span><span class='line'><span class="c1"># 一般的には以下の様に使います</span>
</span><span class='line'><span class="no">Pusher</span><span class="o">.</span><span class="n">app_id</span> <span class="o">=</span> <span class="no">ENV</span><span class="o">[</span><span class="s2">&quot;pusher_app_id&quot;</span><span class="o">]</span>
</span><span class='line'><span class="no">Pusher</span><span class="o">.</span><span class="n">key</span>    <span class="o">=</span> <span class="no">ENV</span><span class="o">[</span><span class="s2">&quot;pusher_key&quot;</span><span class="o">]</span>
</span><span class='line'><span class="no">Pusher</span><span class="o">.</span><span class="n">secret</span> <span class="o">=</span> <span class="no">ENV</span><span class="o">[</span><span class="s2">&quot;pusher_secret&quot;</span><span class="o">]</span>
</span><span class='line'>
</span><span class='line'><span class="c1"># こんな風に Figaro.envで使うこともできます</span>
</span><span class='line'><span class="no">Figaro</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">pusher_app_id</span> <span class="c1"># =&gt; &quot;5112&quot;</span>
</span><span class='line'><span class="no">Figaro</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">pusher_app_id?</span> <span class="c1"># =&gt; true</span>
</span></code></pre></td></tr></table></div></figure>


<h2>Herokuへの設定</h2>

<p>「<strong><a href="https://toolbelt.heroku.com/">Heroku Toolbelt</a></strong>」をインストールして、Herokuのアプリを作成し、
Railsアプリ側をデプロイする段階になったら、以下のコマンドで環境変数に設定を登録します。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="c"># 手動で個別登録</span>
</span><span class='line'><span class="nv">$ </span>heroku config:set <span class="nv">google_analytics_key</span><span class="o">=</span>UA-35722661-5
</span><span class='line'>
</span><span class='line'><span class="c"># ファイルから一括登録</span>
</span><span class='line'><span class="nv">$ </span>figaro heroku:set -e production
</span><span class='line'>
</span><span class='line'><span class="c"># 使い方の詳細はこちら</span>
</span><span class='line'><span class="nv">$ </span>figaro <span class="nb">help </span>heroku:set
</span></code></pre></td></tr></table></div></figure>


<h2>Dokkuへの設定</h2>

<p>Dokkuの設定もほぼ同じです。<code>dokku-cli</code>をインストールして、gitリポジトリを設定したら、herokuとほぼ同じことを実行できます。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="c"># dokku の git を登録</span>
</span><span class='line'><span class="nv">$ </span>git remote add dokku dokku@example-dokku-server.com:example-app
</span><span class='line'>
</span><span class='line'><span class="c"># dokku-cli をインストール</span>
</span><span class='line'><span class="nv">$ </span>gem install dokku-cli
</span><span class='line'>
</span><span class='line'><span class="c"># 手動で個別登録</span>
</span><span class='line'><span class="nv">$ </span>dokku config:set <span class="nv">google_analytics_key</span><span class="o">=</span>UA-35722661-5
</span><span class='line'>
</span><span class='line'><span class="c"># ファイルから一括登録</span>
</span><span class='line'><span class="nv">$ </span>figaro dokku:set -e production
</span><span class='line'>
</span><span class='line'><span class="c"># 使い方の詳細はこちら</span>
</span><span class='line'><span class="nv">$ </span>figaro <span class="nb">help </span>dokku:set
</span></code></pre></td></tr></table></div></figure>


<h2>おまけ</h2>

<p>正直 <code>Dokku</code> で使おうと思ったら、すでに拡張してくれている人がいたのでうほーいと思ったら、
Travis CIのRSpecがコケてて散々悩みながら、デバックしてたら夜中の2時でしたww</p>

<p><strong><a href="https://github.com/laserlemon/figaro/pull/227">Support dokku cli by morizyun · Pull Request #227 · laserlemon/figaro</a></strong></p>

<p><code>Pull Request</code> うまくいくといいなぁ</p>

<script async src="http://morizyun.github.io//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>


<!-- square -->


<p><ins class="adsbygoogle" style="display:inline-block;width:336px;height:280px" data-ad-client="ca-pub-4186413323075068" data-ad-slot="5059873392"></ins></p>

<script>
    (adsbygoogle = window.adsbygoogle || []).push({});
</script>


<h2>Special Thanks</h2>

<ul>
<li><strong><a href="http://xoyip.hatenablog.com/entry/2014/04/09/214405">Rails4.1のsecrets.ymlはfigaroと違うの？ - PILOG</a></strong></li>
</ul>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Dokku プライベートなherokuを作ってRailsアプリをデプロイ[DegitalOclean]]]></title>
    <link href="http://morizyun.github.io/blog/dokku-postgresql-rails-degitalocean/"/>
    <updated>2016-01-08T23:55:00+09:00</updated>
    <id>http://morizyun.github.io/blog/dokku-postgresql-rails-degitalocean</id>
    <content type="html"><![CDATA[<p><a href="http://www.amazon.co.jp/gp/product/B00C2ONQIU/ref=as_li_qf_sp_asin_il?ie=UTF8&camp=247&creative=1211&creativeASIN=B00C2ONQIU&linkCode=as2&tag=morizyun00-22"><img border="0" src="http://ws.assoc-amazon.jp/widgets/q?_encoding=UTF8&ASIN=B00C2ONQIU&Format=_SL160_&ID=AsinImage&MarketPlace=JP&ServiceVersion=20070822&WS=1&tag=morizyun00-22" width="150" style="float: left; margin: 0 20px 20px 0;" ></a><img src="http://www.assoc-amazon.jp/e/ir?t=morizyun00-22&l=as2&o=9&a=B00C2ONQIU" width="1" height="1" border="0" alt="" style="border:none !important; margin:0px !important;" />
herokuライクなプライベートなPaaSを作るためのOSS『<strong><a href="https://github.com/dokku/dokku">dokku/dokku - GitHub</a></strong>』の紹介です。
このDokkuの環境は、「<strong><a href="https://www.digitalocean.com/?refcode=0da417edaeee">DegitalOclean</a></strong>」だと画面から数クリックで作成できるので、
今回は、DegitalOcleanとセットで手順を紹介します。</p>

<p>Dukkuを使うメリットは次の通りです。</p>

<ul>
<li>Heroku ライクにgitにpushしたら、BuildPack的なものを使ってRailsやNode.js, Pythonなどのアプリを展開できる</li>
<li>Dokkuは、PosgreSQLやRedis、ElasticSearchなどのプラグインを数コマンドで使える</li>
</ul>


<p>まだ簡単なアプリをBuildしただけですが、特にハマることもなく安定して使えています！</p>

<!-- more -->


<br style="clear:both;"/>


<script async src="http://morizyun.github.io//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>


<!-- square -->


<p><ins class="adsbygoogle" style="display:inline-block;width:336px;height:280px" data-ad-client="ca-pub-4186413323075068" data-ad-slot="5059873392"></ins></p>

<script>
    (adsbygoogle = window.adsbygoogle || []).push({});
</script>


<h2>Dokkuを使うモチベーション</h2>

<p>今回Dokkuを使おうと思ったモチベーションはこちら。</p>

<pre>
- 趣味アプリでは、できるだけアプリだけに集中したい
- PosgreSQLやRedis、ElasticSearchなどのプラグインを数コマンドで使えるようになる
- Herokuの無料版の制約を気にせずにアプリ開発したい
  - 1時間以上アクセスしないとスリープになる
  - 6時間/1日はスリープ状態にしないといけない
  - 一定時間以上連続するプロセスがkillされる(はず)
- VPSやクラウドだとミドルウェアの環境構築や、デプロイのセッティングに時間がかかる
</pre>


<p>Herokuはただ乗りフリーライダーの理論ですので、基本ごめんなさいですm(<em> </em>)m
一方で個人の趣味開発は、限られた時間との勝負なのでより効率的な開発手法を模索していて今回
『<strong><a href="https://github.com/dokku/dokku">dokku/dokku - GitHub</a></strong>』を使った方法をトライすることにしました！</p>

<h2>画面からDokkuのDropletを作成</h2>

<p>「<strong><a href="https://www.digitalocean.com/?refcode=0da417edaeee">DegitalOclean</a></strong>」にログインして、Dropletを作成します。
「One-click App」 => 「Dokku v0.4.10 on 14.04」を選んでDropletを作成してください。</p>

<p><img src="https://farm2.staticflickr.com/1475/24142129302_aebd0c8997_c.jpg" width="800" height="701"></p>

<h2>ドメインの設定です。</h2>

<p>自分のDropletを作成して、IP(例 <code>123.123.123.123</code>) にブラウザでアクセス。</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>open 123.123.123.123</span></code></pre></td></tr></table></div></figure>


<p>以下を登録してください</p>

<pre>
- 自分のSSHキー
- Custom Domain
- アプリごとのVirtual Host名の利用(onにしていいかも)
</pre>


<p><img src="https://farm2.staticflickr.com/1536/23625078373_5f346892a0.jpg" width="500" height="435" alt="スクリーンショット 2016-01-08 22.43.36"></p>

<p>Custom Domainを登録したら、自分のdomain側の設定を修正して、<code>123.123.123.123</code> を見に行くようにしてください。</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>apps.yourdomain.com   A 123.123.123.123
</span><span class='line'>*.apps.yourdomain.com A 123.123.123.123</span></code></pre></td></tr></table></div></figure>


<h2>サーバに入ってpostgresqlのプラグインをインストール</h2>

<p>公式チュートリアルに従って、『<strong><a href="https://github.com/dokku/dokku-postgres">dokku/dokku-postgres - GitHub</a></strong>』をインストールします。</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># ssh でサーバにログイン
</span><span class='line'>ssh root@123.123.123.123
</span><span class='line'>
</span><span class='line'># dokku の postgresql プラグインをインストール
</span><span class='line'>$ dokku plugin:install https://github.com/dokku/dokku-postgres.git
</span><span class='line'>
</span><span class='line'># PostgreSQL の 今回のアプリ用のDB を作成
</span><span class='line'>$ dokku postgres:create dokku_sample_db
</span><span class='line'>
</span><span class='line'># dokkuのアプリケーションを作成
</span><span class='line'>$ dokku app:create dokku_sample_app
</span><span class='line'>
</span><span class='line'># DBをアプリケーションとをひも付け
</span><span class='line'>dokku postgres:link dokku_sample_db dokku_sample_app</span></code></pre></td></tr></table></div></figure>


<p>ちなみに、Dokkuで使えるPluginの一覧はこちら『<strong><a href="https://github.com/dokku/dokku/blob/master/docs/plugins.md">dokku/plugins.md - Dokku</a></strong>』。</p>

<script async src="http://morizyun.github.io//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>


<!-- square -->


<p><ins class="adsbygoogle" style="display:inline-block;width:336px;height:280px" data-ad-client="ca-pub-4186413323075068" data-ad-slot="5059873392"></ins></p>

<script>
    (adsbygoogle = window.adsbygoogle || []).push({});
</script>


<h2>Rails アプリを作成</h2>

<p>ローカルに戻ってサンプルのRailsアプリを作成します。</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># Railsアプリの作成
</span><span class='line'>rails new dokku_sample_app --database=postgresql --skip-test-unit --skip-bundle -m https://raw.github.com/morizyun/rails4_template/master/app_template.rb
</span><span class='line'>
</span><span class='line'># アプリのフォルダに移動
</span><span class='line'>cd dokku_sample_app
</span><span class='line'>
</span><span class='line'># Bookでscaffold
</span><span class='line'>rails g scaffold book title:string auther:string price:float</span></code></pre></td></tr></table></div></figure>


<p>routesにrootを追加します。</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># config/routes.rb
</span><span class='line'>Rails.application.routes.draw do
</span><span class='line'>  # ↓ を追加
</span><span class='line'>  root 'books#index'
</span><span class='line'>end</span></code></pre></td></tr></table></div></figure>


<p><code>.gitignore</code> から <code>config/secrets.yml</code> を削除。そして、git にコミット。</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># gitに登録
</span><span class='line'>git add . -A && git commit -m 'first commit'
</span><span class='line'>
</span><span class='line'># git のremote サーバを追加
</span><span class='line'>git remote add dokku dokku@apps.yourdomain.com:dokku_sample_app</span></code></pre></td></tr></table></div></figure>


<h2>ローカルからの実行系</h2>

<p>ローカルでのコマンド入力を簡単にしてくれる
「<strong><a href="https://github.com/SebastianSzturo/dokku-cli">SebastianSzturo/dokku-cli</a></strong>」
を使いつつデプロイします！</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># gitの情報を読んで、herokutoolbelt
</span><span class='line'>gem install dokku-cli
</span><span class='line'>
</span><span class='line'># secret keyをセット
</span><span class='line'>dokku config:set dokku_sample1 SECRET_KEY_BASE=`bundle exec rake secret`
</span><span class='line'>
</span><span class='line'># サーバにdeploy
</span><span class='line'>git push dokku master
</span><span class='line'>
</span><span class='line'># ブラウザで表示
</span><span class='line'>dokku open</span></code></pre></td></tr></table></div></figure>


<p>Railsで作成した画面が表示されれば成功です！</p>

<p><img src="https://farm2.staticflickr.com/1675/24168218261_30651ecd62.jpg" width="500" height="294" alt="スクリーンショット 2016-01-08 22.52.38"></p>

<h2>dokku-cliのコマンド</h2>

<p>以下の様なことができます。</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># アプリ配下でコマンドを実行
</span><span class='line'>dokku run &lt;cmd&gt;   # Run a one-off command in the environment of the app
</span><span class='line'>
</span><span class='line'># よく使いそうなコマンド
</span><span class='line'>dokku ssh                                       # Start an SSH session as root user
</span><span class='line'>dokku logs [-t]                                 # Display logs for the app (-t follows)
</span><span class='line'>dokku help [COMMAND]                            # Describe available commands or one specific command
</span><span class='line'>
</span><span class='line'># 設定変更系のコマンド
</span><span class='line'>dokku config                                    # Display the app's environment variables
</span><span class='line'>dokku config:get KEY                            # Display an environment variable value
</span><span class='line'>dokku config:set KEY1=VALUE1 [KEY2=VALUE2 ...]  # Set one or more environment variables
</span><span class='line'>dokku config:set:file &lt;path/to/file&gt;            # Set one or more environment variables from file
</span><span class='line'>dokku config:unset KEY1 [KEY2 ...]              # Unset one or more environment variables
</span><span class='line'>
</span><span class='line'># プロセス/コンテナ系のコマンド
</span><span class='line'>dokku ps           # List processes running in app container(s)
</span><span class='line'>dokku ps:rebuild   # Rebuild the app
</span><span class='line'>dokku ps:restart   # Restart the app container
</span><span class='line'>dokku ps:start     # Start the app container
</span><span class='line'>
</span><span class='line'># その他便利コマンド
</span><span class='line'>dokku nginx:build                               # (Re)builds nginx config for the app
</span><span class='line'>dokku open                                      # Open the app in your default browser
</span><span class='line'>dokku url                                       # Show the first URL for the app
</span><span class='line'>dokku urls                                      # Show all URLs for the app</span></code></pre></td></tr></table></div></figure>


<h2>DokkuのミドルウェアPlugin</h2>

<p>PostgreSQLだけでなく、RedisやElasticsearch等のPluginも数コマンドで使うことができるようになります。
公式サポートされているものだけでも次のようなものがあります。</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>CouchDB (beta)
</span><span class='line'>Elasticsearch (beta)
</span><span class='line'>MariaDB (beta)
</span><span class='line'>Memcached (beta)
</span><span class='line'>Mongo (beta)
</span><span class='line'>MySQL (beta)
</span><span class='line'>Nats (beta)
</span><span class='line'>Postgres (beta)
</span><span class='line'>RabbitMQ (beta)
</span><span class='line'>Redis (beta)
</span><span class='line'>RethinkDB (beta)
</span><span class='line'>Copy Files to Image
</span><span class='line'>HTTP Auth (beta)
</span><span class='line'>Let's Encrypt (beta)
</span><span class='line'>Maintenance mode (beta)
</span><span class='line'>Redirect (beta)</span></code></pre></td></tr></table></div></figure>


<p>また公式サポートされているPlugin以外にもコミュニティや個人が様々なPluginを提供しています。
詳しくは、『<a href="https://github.com/dokku/dokku/blob/master/docs/plugins.md">dokku/plugins.md - GitHub</a>**』を見てみてください。</p>

<h2>感想</h2>

<p>まだ、簡単なアプリをデプロイしただけなので、もう少し色々試した上でですが、今のところの感触はかなりありな気がします＾＾</p>

<h2>Special Thank</h2>

<ul>
<li><strong><a href="http://dokku.viewdocs.io/dokku/application-deployment/">Dokku - The smallest PaaS implementation you&#8217;ve ever seen</a></strong></li>
<li><strong><a href="http://blog.mochromatic.com/2014/12/17/setting-up-dokku-on-digital-ocean/">Setting up Dokku on Digital Ocean</a></strong></li>
<li><strong><a href="http://donpottinger.net/blog/2014/11/17/bye-bye-heroku-hello-dokku.html">Bye Bye Heroku, Hello Dokku: Migrating a Rails App from Heroku to Dokku (Part 1) | by @donpottinger</a></strong></li>
<li><strong><a href="http://donpottinger.net/blog/2014/11/22/bye-bye-heroku-hello-dokku-part-2.html">Bye Bye Heroku, Hello Dokku: Migrating a Rails App from Heroku to Dokku (Part 2) | by @donpottinger</a></strong></li>
</ul>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[scenic RailsでMaterialized Viewを使う]]></title>
    <link href="http://morizyun.github.io/blog/materialized-view-rails-soic/"/>
    <updated>2016-01-06T22:20:00+09:00</updated>
    <id>http://morizyun.github.io/blog/materialized-view-rails-soic</id>
    <content type="html"><![CDATA[<p><a href="http://www.amazon.co.jp/gp/product/B00NM7VROQ/ref=as_li_qf_sp_asin_il?ie=UTF8&camp=247&creative=1211&creativeASIN=B00NM7VROQ&linkCode=as2&tag=morizyun00-22"><img border="0" src="http://ws.assoc-amazon.jp/widgets/q?_encoding=UTF8&ASIN=B00NM7VROQ&Format=_SL160_&ID=AsinImage&MarketPlace=JP&ServiceVersion=20070822&WS=1&tag=morizyun00-22" width="150" style="float: left; margin: 0 20px 20px 0;" ></a><img src="http://www.assoc-amazon.jp/e/ir?t=morizyun00-22&l=as2&o=9&a=B00NM7VROQ" width="1" height="1" border="0" alt="" style="border:none !important; margin:0px !important;" />
RailsでPostgreSQLのビュー(View)やマテリアライズド・ビュー(Materialized View)を使うためのGem「<strong><a href="https://github.com/thoughtbot/scenic">thoughtbot/scenic</a></strong>」の紹介です。
thoughtbot謹製なので、安心して使えそうなのも魅力です！</p>

<!-- more -->


<br style="clear:both;"/>


<script async src="http://morizyun.github.io//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>


<!-- square -->


<p><ins class="adsbygoogle" style="display:inline-block;width:336px;height:280px" data-ad-client="ca-pub-4186413323075068" data-ad-slot="5059873392"></ins></p>

<script>
    (adsbygoogle = window.adsbygoogle || []).push({});
</script>


<h2>PostgreSQLのViewとMaterialized View</h2>

<p>PostgreSQLのViewとMaterialized Viewの大まかかな説明は次の通りです。</p>

<h3>View(ビュー)について</h3>

<ul>
<li>ViewとはSQLで構成された実態のな仮想的なテーブルのこと。Viewの作成時にSQLを定義する</li>
<li>Viewを呼び出すとSQLが即時実行される</li>
<li>最新の情報を常に取得できるが、SQLが複雑だったり、レコードが多いと負荷がかかる</li>
</ul>


<h3>Materialized View(マテリアライズド・ビュー)について</h3>

<ul>
<li>実態を持ったViewのことである。作成するときにSQLの実行結果のテーブルを作る</li>
<li>最新の情報を反映するためにはリフレッシュ処理を行う必要がある</li>
<li>SQLが複雑だったり、レコードが多い処理の負荷を下げるのに有効なアプローチである</li>
</ul>


<h2>PostgreSQLのMaterialized Viewの機能</h2>

<p>『<strong><a href="http://goo.gl/WiA4wK">RailsでPostgreSQLのマテリアライズドビューを使う | 日々雑記</a></strong>』にある通り、
PosgreSQLにはリフレッシュ時にSELECTコマンドを発行した時にロックされて応答が遅延しないように、<code>CONCURRENTLY</code>
というパラメータをつけるといいようです！</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>REFRESH MATERIALIZED VIEW CONCURRENTLY materialized_view;</span></code></pre></td></tr></table></div></figure>


<h2>Gemのインストール</h2>

<p>ではいよいよ、Viewを扱いやすくするGem「<strong><a href="https://github.com/thoughtbot/scenic">thoughtbot/scenic</a></strong>」の紹介です。</p>

<p><code>Gemfile</code>に以下を追加して、<code>bundle install</code>を実行してください。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="c1"># View &amp; Materialized View (GitHubじゃないとちょっと古い気がします)</span>
</span><span class='line'><span class="n">gem</span> <span class="s1">&#39;scenic&#39;</span><span class="p">,</span> <span class="n">git</span><span class="p">:</span> <span class="s1">&#39;git@github.com:thoughtbot/scenic.git&#39;</span>
</span><span class='line'>
</span><span class='line'><span class="c1"># Fake Data(サンプルデータを作るために使います)</span>
</span><span class='line'><span class="n">gem</span> <span class="s1">&#39;faker&#39;</span>
</span></code></pre></td></tr></table></div></figure>


<h2>Viewを作成するためのModelを作成</h2>

<p>まずは、Viewを作成するための元となるテーブルをScaffoldで作成します。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="c1"># 新しい Rails プロジェクトを作成</span>
</span><span class='line'><span class="err">$</span> <span class="n">rails</span> <span class="kp">new</span> <span class="n">scenic_sample</span>
</span><span class='line'><span class="err">$</span> <span class="n">cd</span> <span class="n">scenic_sample</span>
</span><span class='line'>
</span><span class='line'><span class="c1"># scaffoldで一通り作成</span>
</span><span class='line'><span class="err">$</span> <span class="n">rails</span> <span class="n">g</span> <span class="n">scaffold</span> <span class="n">book</span> <span class="n">title</span><span class="ss">:string</span> <span class="n">author</span><span class="ss">:string</span> <span class="n">price</span><span class="ss">:float</span>
</span></code></pre></td></tr></table></div></figure>


<p>次にサンプルデータを作ります。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="c1"># db/seeds.rb</span>
</span><span class='line'><span class="nb">require</span> <span class="s1">&#39;faker&#39;</span>
</span><span class='line'>
</span><span class='line'><span class="mi">1000</span><span class="o">.</span><span class="n">times</span> <span class="k">do</span> <span class="o">|</span><span class="n">i</span><span class="o">|</span>
</span><span class='line'>  <span class="no">Book</span><span class="o">.</span><span class="n">create</span><span class="p">(</span>
</span><span class='line'>      <span class="n">title</span><span class="p">:</span> <span class="no">Faker</span><span class="o">::</span><span class="no">Name</span><span class="o">.</span><span class="n">title</span><span class="p">,</span>
</span><span class='line'>      <span class="n">author</span><span class="p">:</span> <span class="no">Faker</span><span class="o">::</span><span class="no">Name</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
</span><span class='line'>      <span class="n">price</span><span class="p">:</span> <span class="no">Faker</span><span class="o">::</span><span class="no">Commerce</span><span class="o">.</span><span class="n">price</span>
</span><span class='line'>  <span class="p">)</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>ではテーブルを作って、テストデータを投入します。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="c1"># テーブルを作成</span>
</span><span class='line'><span class="err">$</span> <span class="n">bundle</span> <span class="nb">exec</span> <span class="n">rake</span> <span class="n">db</span><span class="ss">:migrate</span>
</span><span class='line'>
</span><span class='line'><span class="c1"># テストデータを投入</span>
</span><span class='line'><span class="err">$</span> <span class="n">bundle</span> <span class="nb">exec</span> <span class="n">rake</span> <span class="n">db</span><span class="ss">:seed</span>
</span></code></pre></td></tr></table></div></figure>


<p>これでサンプルデータが作成されました。</p>

<h2>いよいよマテリアライズド・ビューを作成</h2>

<p>次にマテリアライズド・ビューを作成します。</p>

<p>今回は$50以上のBookを<code>ExpensiveBook</code>として、それを抽出するテーブルにします。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="c1"># ExpensiveBookの作成</span>
</span><span class='line'><span class="err">$</span> <span class="n">rails</span> <span class="n">generate</span> <span class="n">scenic</span><span class="ss">:model</span> <span class="n">expensive_book</span> <span class="o">--</span><span class="n">materialized</span>
</span><span class='line'>      <span class="n">invoke</span>  <span class="n">active_record</span>
</span><span class='line'>      <span class="n">create</span>    <span class="n">app</span><span class="o">/</span><span class="n">models</span><span class="o">/</span><span class="n">expensive_book</span><span class="o">.</span><span class="n">rb</span>
</span><span class='line'>      <span class="n">invoke</span>    <span class="n">rspec</span>
</span><span class='line'>      <span class="n">create</span>      <span class="n">spec</span><span class="o">/</span><span class="n">models</span><span class="o">/</span><span class="n">expensive_book_spec</span><span class="o">.</span><span class="n">rb</span>
</span><span class='line'>      <span class="n">invoke</span>      <span class="n">factory_girl</span>
</span><span class='line'>      <span class="n">create</span>        <span class="n">spec</span><span class="o">/</span><span class="n">factories</span><span class="o">/</span><span class="n">expensive_books</span><span class="o">.</span><span class="n">rb</span>
</span><span class='line'>      <span class="n">create</span>  <span class="n">db</span><span class="o">/</span><span class="n">views</span><span class="o">/</span><span class="n">expensive_books_v01</span><span class="o">.</span><span class="n">sql</span>
</span><span class='line'>      <span class="n">create</span>  <span class="n">db</span><span class="o">/</span><span class="n">migrate</span><span class="o">/</span><span class="mi">20160106124232</span><span class="n">_update_expensive_books</span><span class="o">.</span><span class="n">rb</span>
</span></code></pre></td></tr></table></div></figure>


<h2>マテリアライズド・ビューのSQL</h2>

<p>そんなマテリアライズド・ビューのSQLがこちら。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='sql'><span class='line'><span class="o">#</span> <span class="n">db</span><span class="o">/</span><span class="n">views</span><span class="o">/</span><span class="n">expensive_books_v01</span><span class="p">.</span><span class="k">sql</span>
</span><span class='line'><span class="k">SELECT</span>
</span><span class='line'>  <span class="o">*</span>
</span><span class='line'><span class="k">FROM</span>
</span><span class='line'>  <span class="n">books</span>
</span><span class='line'><span class="k">WHERE</span>
</span><span class='line'>  <span class="n">price</span> <span class="o">&gt;=</span> <span class="mi">50</span><span class="p">.</span><span class="mi">0</span>
</span></code></pre></td></tr></table></div></figure>


<p>あとはリフレッシュ時に<code>CONCURRENTLY</code>を使うために、UNIQ INEXを追加します。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="c1"># db/migrate/20160106123247_create_expensive_books.rb</span>
</span><span class='line'><span class="k">class</span> <span class="nc">CreateExpensiveBooks</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Migration</span>
</span><span class='line'>  <span class="k">def</span> <span class="nf">change</span>
</span><span class='line'>    <span class="n">create_view</span> <span class="ss">:expensive_books</span><span class="p">,</span> <span class="n">materialized</span><span class="p">:</span> <span class="kp">true</span>
</span><span class='line'>    <span class="c1"># 追加</span>
</span><span class='line'>    <span class="n">add_index</span> <span class="ss">:expensive_books</span><span class="p">,</span> <span class="ss">:id</span><span class="p">,</span> <span class="n">unique</span><span class="p">:</span> <span class="kp">true</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>ではマテリアライズド・ビューを作成します。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="err">$</span> <span class="n">bundle</span> <span class="nb">exec</span> <span class="n">rake</span> <span class="n">db</span><span class="ss">:migrate</span>
</span><span class='line'><span class="o">==</span> <span class="mi">20160106123247</span> <span class="no">CreateExpensiveBooks</span><span class="p">:</span> <span class="n">migrating</span> <span class="o">=============================</span>
</span><span class='line'><span class="o">--</span> <span class="n">create_view</span><span class="p">(</span><span class="ss">:expensive_books</span><span class="p">)</span>
</span><span class='line'>   <span class="o">-&gt;</span> <span class="mi">0</span><span class="o">.</span><span class="mo">0272</span><span class="n">s</span>
</span><span class='line'><span class="o">==</span> <span class="mi">20160106123247</span> <span class="no">CreateExpensiveBooks</span><span class="p">:</span> <span class="n">migrated</span> <span class="p">(</span><span class="mi">0</span><span class="o">.</span><span class="mo">0272</span><span class="n">s</span><span class="p">)</span> <span class="o">====================</span>
</span></code></pre></td></tr></table></div></figure>


<p>こんな感じのSQLが実行されたようです。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='sql'><span class='line'><span class="k">CREATE</span> <span class="k">OR</span> <span class="k">REPLACE</span> <span class="k">VIEW</span> <span class="k">public</span><span class="p">.</span><span class="n">expensive_books</span> <span class="k">AS</span> <span class="k">SELECT</span> <span class="n">books</span><span class="p">.</span><span class="n">id</span><span class="p">,</span>
</span><span class='line'>    <span class="n">books</span><span class="p">.</span><span class="n">title</span><span class="p">,</span>
</span><span class='line'>    <span class="n">books</span><span class="p">.</span><span class="n">author</span><span class="p">,</span>
</span><span class='line'>    <span class="n">books</span><span class="p">.</span><span class="n">price</span><span class="p">,</span>
</span><span class='line'>    <span class="n">books</span><span class="p">.</span><span class="n">created_at</span><span class="p">,</span>
</span><span class='line'>    <span class="n">books</span><span class="p">.</span><span class="n">updated_at</span>
</span><span class='line'>   <span class="k">FROM</span> <span class="n">books</span>
</span><span class='line'>  <span class="k">WHERE</span> <span class="p">(</span><span class="n">books</span><span class="p">.</span><span class="n">price</span> <span class="o">&gt;=</span> <span class="p">(</span><span class="mi">50</span><span class="p">.</span><span class="mi">0</span><span class="p">)::</span><span class="n">double</span> <span class="k">precision</span><span class="p">);</span>
</span></code></pre></td></tr></table></div></figure>


<p>SQLを変更する場合は、<code>rails g scenic:view expensive_book</code> とすれば変更用のSQLのmigrationファイル生成されます。</p>

<h2>マテリアライズド・ビューのModelファイル</h2>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">class</span> <span class="nc">ExpensiveBook</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Base</span>
</span><span class='line'>  <span class="c1"># find_by!とかを使う場合はprimary_keyが必要なので</span>
</span><span class='line'>  <span class="nb">self</span><span class="o">.</span><span class="n">primary_key</span> <span class="o">=</span> <span class="ss">:id</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1"># このメソッドを実行するとマテリアライズド・ビューが更新される</span>
</span><span class='line'>  <span class="k">def</span> <span class="nc">self</span><span class="o">.</span><span class="nf">refresh</span>
</span><span class='line'>    <span class="no">Scenic</span><span class="o">.</span><span class="n">database</span><span class="o">.</span><span class="n">refresh_materialized_view</span><span class="p">(</span><span class="n">table_name</span><span class="p">,</span> <span class="n">concurrently</span><span class="p">:</span> <span class="kp">true</span><span class="p">)</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="kp">private</span>
</span><span class='line'>  <span class="c1"># マテリアライズド・ビューは書き込みができないので読み込み専用のViewとして作成</span>
</span><span class='line'>  <span class="k">def</span> <span class="nf">readonly?</span>
</span><span class='line'>    <span class="kp">true</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>一点GemのREADMEに書いていた注意点として、リフレッシュ時のパラメータに<code>concurrently: true</code>とした場合
はlockがかからないけど、<code>PostgreSQL 9.4 以上 &amp;&amp; uniq index</code> が必須なので注意してください。</p>

<script async src="http://morizyun.github.io//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>


<!-- square -->


<p><ins class="adsbygoogle" style="display:inline-block;width:336px;height:280px" data-ad-client="ca-pub-4186413323075068" data-ad-slot="5059873392"></ins></p>

<script>
    (adsbygoogle = window.adsbygoogle || []).push({});
</script>


<h2>Special Thanks</h2>

<ul>
<li><strong><a href="https://github.com/stympy/faker">stympy/faker - GitHub</a></strong></li>
<li><strong><a href="http://qiita.com/yaotti/items/510779877e515a1155db">Ruby - Gemfileでのgem指定色々 - Qiita</a></strong></li>
</ul>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Zoho Mail 無料で独自ドメインのメールの送受信をスタートできる [POP/STMP対応]]]></title>
    <link href="http://morizyun.github.io/blog/zoho-mail-original-domain-pop-smtp-free/"/>
    <updated>2016-01-05T21:15:00+09:00</updated>
    <id>http://morizyun.github.io/blog/zoho-mail-original-domain-pop-smtp-free</id>
    <content type="html"><![CDATA[<p><a href="http://www.amazon.co.jp/gp/product/B00T5ZGX0W/ref=as_li_qf_sp_asin_il?ie=UTF8&camp=247&creative=1211&creativeASIN=B00T5ZGX0W&linkCode=as2&tag=morizyun00-22"><img border="0" src="http://ws.assoc-amazon.jp/widgets/q?_encoding=UTF8&ASIN=B00T5ZGX0W&Format=_SL160_&ID=AsinImage&MarketPlace=JP&ServiceVersion=20070822&WS=1&tag=morizyun00-22" width="150" style="float: left; margin: 0 20px 20px 0;" ></a><img src="http://www.assoc-amazon.jp/e/ir?t=morizyun00-22&l=as2&o=9&a=B00T5ZGX0W" width="1" height="1" border="0" alt="" style="border:none !important; margin:0px !important;" />
自分で購入した独自ドメインのメールアドレスを無料使えるサービス『<strong><a href="https://www.zoho.com/">Zoho Mail</a></strong>』の紹介です。</p>

<p>Zoho Mail側にもメールの送受信を行うWeb画面があります。また、POPやSTMPがあるのでGmailやクライアントアプリでもメールの送受信を行う事もできます。</p>

<!-- more -->


<br style="clear:both;"/>


<script async src="http://morizyun.github.io//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>


<!-- square -->


<p><ins class="adsbygoogle" style="display:inline-block;width:336px;height:280px" data-ad-client="ca-pub-4186413323075068" data-ad-slot="5059873392"></ins></p>

<script>
    (adsbygoogle = window.adsbygoogle || []).push({});
</script>


<h2>目次</h2>

<pre>
1) 独自ドメインの取得
2) Zoho Mailでユーザー登録
3) Zoho Mailでメール受信設定
4) 必要に応じてメールアドレスを追加
5) 必要に応じてPOP/STMPを設定
</pre>


<h2>1) 独自ドメインの取得</h2>

<p><strong><a href="http://muumuu-domain.com/">初心者でも簡単!ドメイン取得は 【ムームードメイン】</a></strong>などでドメインを取得。</p>

<h2>2) Zoho Mailでユーザー登録</h2>

<p><strong><a href="https://www.zoho.com/">Zoho Mail</a></strong>でユーザー登録。料金プラン(liteが無料)を設定します。</p>

<h2>3) Zoho Mailでメール受信設定</h2>

<p>ZohoでMailを受け取れるようになるまでの手順です。</p>

<pre>
A) 右メニューのコントロールパネル => ドメインを選択
B) ドメイン追加を選択
C) Zohoで指定されたTXTレコードをムームードメインに設定して、ドメインの認証
D) メールアカウント(ユーザー)の作成
D) Zohoで指定されたMXレコードをムームドメインに設定
E) Zohoで指定されたSPFレコードをムームドメインに設定
</pre>


<p>もしここで詰まるようなら以下のサイトを参考にしてみてください。</p>

<p><strong><a href="http://appstars.jp/archive/123">無料で独自ドメインのメールを使えるようにする - あぷすた</a></strong></p>

<p><strong><a href="http://www.workabroad.jp/tech/559">独自ドメインをZohoで使う。Google Appsが有料なので（泣） | Workabroad.jp</a></strong></p>

<h2>4) 必要に応じてメールアドレスを追加</h2>

<p>さらにメールアドレスを追加する場合は、POP/STMPの機能もあるのでユーザーを追加していくのがオススメです。</p>

<h2>5) 必要に応じてPOP/STMPを設定</h2>

<p>ちょっとマニアックな話ですが、Zoho MailにはPOP/STMPも完備されています。
設定方法はこちら。</p>

<p><strong><a href="https://www.zoho.com/mail/help/pop-access.html">Zoho Mail - POP configuration</a></strong></p>

<p>こちらをGmail側に設定すると独自ドメインをGmailで受け取って運用できます！</p>

<script async src="http://morizyun.github.io//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>


<!-- square -->


<p><ins class="adsbygoogle" style="display:inline-block;width:336px;height:280px" data-ad-client="ca-pub-4186413323075068" data-ad-slot="5059873392"></ins></p>

<script>
    (adsbygoogle = window.adsbygoogle || []).push({});
</script>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Elasticsearch Sever勉強メモ 基本的な概念や基本API、マッピングについて]]></title>
    <link href="http://morizyun.github.io/blog/elasticsearch-server-basic-api/"/>
    <updated>2016-01-04T23:15:00+09:00</updated>
    <id>http://morizyun.github.io/blog/elasticsearch-server-basic-api</id>
    <content type="html"><![CDATA[<p><a href="http://www.amazon.co.jp/gp/product/B00J4KDYZU/ref=as_li_qf_sp_asin_il?ie=UTF8&camp=247&creative=1211&creativeASIN=B00J4KDYZU&linkCode=as2&tag=morizyun00-22"><img border="0" src="http://ws.assoc-amazon.jp/widgets/q?_encoding=UTF8&ASIN=B00J4KDYZU&Format=_SL160_&ID=AsinImage&MarketPlace=JP&ServiceVersion=20070822&WS=1&tag=morizyun00-22" width="150" style="float: left; margin: 0 20px 20px 0;" ></a><img src="http://www.assoc-amazon.jp/e/ir?t=morizyun00-22&l=as2&o=9&a=B00J4KDYZU" width="1" height="1" border="0" alt="" style="border:none !important; margin:0px !important;" />『<strong><a href="http://www.amazon.co.jp/gp/product/B00J4KDYZU/ref=as_li_qf_sp_asin_il?ie=UTF8&amp;camp=247&amp;creative=1211&amp;creativeASIN=B00J4KDYZU&amp;linkCode=as2&amp;tag=morizyun00-22">Elasticsearch Sever</a></strong>』を読んで勉強をしたことの俺得メモです。今回は基本的な概念や基本API、マッピングについてです。</p>

<p>英語ですが、公式ドキュメント『<strong><a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/index.html">Elasticsearch Reference [2.1]</a></strong>』も充実しているのでななめ読みしています！</p>

<!-- more -->


<br style="clear:both;"/>


<script async src="http://morizyun.github.io//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>


<!-- square -->


<p><ins class="adsbygoogle" style="display:inline-block;width:336px;height:280px" data-ad-client="ca-pub-4186413323075068" data-ad-slot="5059873392"></ins></p>

<script>
    (adsbygoogle = window.adsbygoogle || []).push({});
</script>


<h2>curlを使うときに便利なjq</h2>

<p>コマンドラインでのJSONの整形に「<strong><a href="https://stedolan.github.io/jq/">jq</a></strong>」が便利でした。良かったらぜひ。</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>brew install jq</span></code></pre></td></tr></table></div></figure>


<p>こんな感じでcurlの結果をパイプで渡すと、結果を見やすく整形してくれます。</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>curl -XPUT http://localhost:9200/post -d '{ "title" : "manual post title 1", "body" : "manual post body 1" }' | jq</span></code></pre></td></tr></table></div></figure>


<p>詳しい使い方は公式のチュートリアル『<strong><a href="https://stedolan.github.io/jq/tutorial/">Tutorial - jq</a></strong>』あたりがおすすめです</p>

<h2>Elasticsearch の基本概念</h2>

<h3>Elasticsearchの論理的な構成要素</h3>

<p>検索で使うデータの構成要素のイメージ。</p>

<pre>
- インデックス
  - ドキュメントの集合体。リレーショナルDBのテーブルのようなもの。格納された値は、全文検索に最適化される。
- ドキュメントタイプ
  - 1つのインデックス内に複数のオブジェクトを格納できる。その区分のこと。
- ドキュメント
  - リレーショナルDBのレコードのようなもの。型(type)は自動で決まることも、強制することもできる
</pre>


<h3>Elasticsearchの物理的な構成要素</h3>

<p>インデックスを物理的に構成する要素。</p>

<pre>
- クラスタ(cluster)
  - 複数サーバで協調して動かした場合のサーバ群をクラスタと呼ぶ。
- ノード(node)
  Elasticsearchのプロセスをノードと呼ぶ。クラスタの構成要素。
- シャード(shard)
  - 大量のドキュメントを処理するために、小さな部分インデックスに分割して複数のサーバに格納する。これをシャードという。
  - デフォルトでは5つのPrimary Shardと各Primary Shardごとに1つのReplica Shardに分類される
  - Primary Shard
    - インデックスの書き込みと参照処理で利用される
  - Replica Shard
    - クエリのスループットや高可用性を実現するためにシャードを完全にコピーしたレプリカを作ることができる
    - クラスタ内では自動的にプライマリとなるシャードを選定することができる
</pre>


<p><code>Replica Shard</code>は動的に数を変更可能だが、<code>Primary Shard</code>は一度インデックスを作成すると変更できません。</p>

<h2>Elasticsearchの基本的なAPI</h2>

<p>Elasticsearchはいろんな操作を行うためのAPIがそろっています。いくつか触りを紹介します。</p>

<pre>
- インスタンス情報に関するAPI
  - curl -XGET http://localhost:9200/

- インデックス(データの論理的な構造)の操作に関するAPI
  - インデックスの作成
    - curl -XPOST http://localhost:9200/post
  - インデックスの構造取得
    - curl -XGET http://localhost:9200/post
  - インデックスの削除
    - curl -XDELETE http://localhost:9200/post

- ドキュメント(インデックスの中のデータ)の操作に関するAPI
  - ドキュメントの新規作成
    - curl -XPOST http://localhost:9200/post/post -d '{ "id" : 1, "title" : "manual post title 1" }'
  - ドキュメントの更新
    - curl -XPUT http://localhost:9200/post/1 -d '{ "id" : 1, "title" : "manual post title 1" }'
  - ドキュメントの取得
    - curl -XGET http://localhost:9200/post/1
  - ドキュメントの削除
    - curl -XDELETE http://localhost:9200/post/1
</pre>


<h2>マッピングについて</h2>

<p>スキーママッピングとは、インデックスの構造を定義を行うことです。</p>

<p>公式ドキュメント「<strong><a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/mapping.html">Mapping | Elasticsearch</a></strong>」がおすすめ。</p>

<h3>マッピングファイルの作成</h3>

<p>マッピング情報を格納する <code>blog.json</code> を作成します。</p>

<p>構造として配下のようになっています。</p>

<pre>
- ドキュメントタイプ : articles (記事)
- articles のフィールド情報
  - id : 一意の識別子(整数型)
  - title: タイトル(文字列)
</pre>


<p>では実際のファイルです。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='json'><span class='line'><span class="err">#</span> <span class="err">blog.json</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="nt">&quot;mappings&quot;</span> <span class="p">:</span> <span class="p">{</span>
</span><span class='line'>        <span class="nt">&quot;articles&quot;</span> <span class="p">:</span> <span class="p">{</span>
</span><span class='line'>            <span class="nt">&quot;properties&quot;</span> <span class="p">:</span> <span class="p">{</span>
</span><span class='line'>                <span class="nt">&quot;id&quot;</span> <span class="p">:</span> <span class="p">{</span> <span class="nt">&quot;type&quot;</span> <span class="p">:</span> <span class="s2">&quot;long&quot;</span><span class="p">,</span> <span class="nt">&quot;store&quot;</span> <span class="p">:</span> <span class="s2">&quot;yes&quot;</span> <span class="p">},</span>
</span><span class='line'>                <span class="nt">&quot;title&quot;</span> <span class="p">:</span> <span class="p">{</span> <span class="nt">&quot;type&quot;</span> <span class="p">:</span> <span class="s2">&quot;string&quot;</span><span class="p">,</span> <span class="nt">&quot;store&quot;</span> <span class="p">:</span> <span class="s2">&quot;yes&quot;</span><span class="p">,</span> <span class="nt">&quot;index&quot;</span> <span class="p">:</span> <span class="s2">&quot;analyzed&quot;</span> <span class="p">}</span>
</span><span class='line'>            <span class="p">}</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>ファイルを作ったら以下のコマンドでインデックス作成 &amp; マッピングの定義を実行。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='json'><span class='line'><span class="err">$</span> <span class="err">curl</span> <span class="err">-XPOST</span> <span class="err">&#39;http://localhost:</span><span class="mi">9200</span><span class="err">/blog&#39;</span> <span class="err">-d</span> <span class="err">@blog.json</span> <span class="err">|</span> <span class="err">jq</span>
</span></code></pre></td></tr></table></div></figure>


<p><code>@blog.json</code> は curl の <code>blog.json</code> を指定するための設定。</p>

<h3>マッピングのフィールドの型定義</h3>

<p>触りだけだけどこんな感じの基本型(Core Type)がある。</p>

<pre>
- String : 文字列。アナライザを細かく指定できる。
- Number : 数値。floatやdoubleなどの方がある。
- Date : 日付。フォーマットはいろいろ指定できる。
- Booelean : 真偽値を扱う。
- Binary : BASE64形式のバイナリデータ。画像などを格納するために使う。
</pre>


<p>それぞれの型情報に対して、更に属性情報を定義できる。</p>

<p>以下は共通的な型情報です。</p>

<pre>
- index
  - "analyzed" => 検索可能なフィールド
  - "no" => 検索できないフィールド
  - "not_analized" => アナライザによって処理されないが、完全一致での検索はできる
- store
  - "yes" フィールドにインデックスの元の値を保存する
  - "no" フィールドにインデックスの元の値を保存しない。_sourceを使うと値を取得できる。
- boost
  - フィールドがドキュメントでどのくらい重要かを表す
- null_value
  - 値がない場合に、デフォルトで登録される値
- include_in_all
  - フィールドが _allに含まれるかどうかを設定するフィールド
</pre>




<br style="clear:both;"/>


<script async src="http://morizyun.github.io//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>


<!-- square -->


<p><ins class="adsbygoogle" style="display:inline-block;width:336px;height:280px" data-ad-client="ca-pub-4186413323075068" data-ad-slot="5059873392"></ins></p>

<script>
    (adsbygoogle = window.adsbygoogle || []).push({});
</script>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Elasticsearchを使ったRailsサンプルアプリの作成]]></title>
    <link href="http://morizyun.github.io/blog/elasticsearch-rails-tutorial/"/>
    <updated>2016-01-03T21:50:00+09:00</updated>
    <id>http://morizyun.github.io/blog/elasticsearch-rails-tutorial</id>
    <content type="html"><![CDATA[<p><a href="http://www.amazon.co.jp/gp/product/B00J4KDYZU/ref=as_li_qf_sp_asin_il?ie=UTF8&camp=247&creative=1211&creativeASIN=B00J4KDYZU&linkCode=as2&tag=morizyun00-22"><img border="0" src="http://ws.assoc-amazon.jp/widgets/q?_encoding=UTF8&ASIN=B00J4KDYZU&Format=_SL160_&ID=AsinImage&MarketPlace=JP&ServiceVersion=20070822&WS=1&tag=morizyun00-22" width="150" style="float: left; margin: 0 20px 20px 0;" ></a><img src="http://www.assoc-amazon.jp/e/ir?t=morizyun00-22&l=as2&o=9&a=B00J4KDYZU" width="1" height="1" border="0" alt="" style="border:none !important; margin:0px !important;" />
検索機能を実装するときによく使われているElasticsearchをRailsで使うためのサンプルアプリの作成の手順を作りました。入門レベルです！</p>

<!-- more -->


<br style="clear:both;"/>


<script async src="http://morizyun.github.io//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>


<!-- square -->


<p><ins class="adsbygoogle" style="display:inline-block;width:336px;height:280px" data-ad-client="ca-pub-4186413323075068" data-ad-slot="5059873392"></ins></p>

<script>
    (adsbygoogle = window.adsbygoogle || []).push({});
</script>


<h2>Elasticsearchの導入</h2>

<p>拙著『<strong><a href="http://morizyun.github.io/blog/elasticsearch-kibana-setup-mac/">Elasticsearch 2.1 + Kibana 4.1 + Marvel のMacへのセットアップ</a></strong>』を良ければご参考ください。</p>

<h2>Rails サンプルアプリ</h2>

<p>Railsのサンプルアプリを作成します。今回は <code>Article</code>(記事) のモデルを持つことにします。</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># Railsアプリの作成
</span><span class='line'>rails new elasticsearch_sample --skip-bundle
</span><span class='line'>
</span><span class='line'># フォルダを移動
</span><span class='line'>cd elasticsearch_sample
</span><span class='line'>
</span><span class='line'># DBの作成
</span><span class='line'>rake db:create
</span><span class='line'>
</span><span class='line'># article テーブルの定義を作成
</span><span class='line'>bundle exec rails g scaffold article title:string body:text
</span><span class='line'>
</span><span class='line'># article テーブルを作成
</span><span class='line'>bundle exec rake db:migrate</span></code></pre></td></tr></table></div></figure>


<p>GemfileにElasticsearch用のgemを追加します。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="c1"># Gemfile</span>
</span><span class='line'>
</span><span class='line'><span class="c1"># Elasticsearch</span>
</span><span class='line'><span class="n">gem</span> <span class="s1">&#39;elasticsearch-model&#39;</span><span class="p">,</span> <span class="n">git</span><span class="p">:</span> <span class="s1">&#39;git://github.com/elasticsearch/elasticsearch-rails.git&#39;</span>
</span><span class='line'><span class="n">gem</span> <span class="s1">&#39;elasticsearch-rails&#39;</span><span class="p">,</span> <span class="n">git</span><span class="p">:</span> <span class="s1">&#39;git://github.com/elasticsearch/elasticsearch-rails.git&#39;</span>
</span></code></pre></td></tr></table></div></figure>


<p>追加したらターミナルで以下のコマンドを実行してgemをインストールします。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">bundle</span> <span class="n">install</span> <span class="o">--</span><span class="n">jobs</span><span class="o">=</span><span class="mi">4</span> <span class="o">--</span><span class="n">path</span><span class="o">=</span><span class="n">vendor</span><span class="o">/</span><span class="n">bundle</span>
</span></code></pre></td></tr></table></div></figure>


<h2>ModelにElasticsearchを使うための設定</h2>

<p>次に<code>Article</code>モデルにElasticsearchを使うための設定をします。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="c1"># app/models/article.rb</span>
</span><span class='line'><span class="k">class</span> <span class="nc">Article</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Base</span>
</span><span class='line'>  <span class="kp">include</span> <span class="no">ArticleSearchable</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>今回はconcernにElasticsearchに関する処理を切り出します。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="c1"># app/models/concerns/article_searcable.rb</span>
</span><span class='line'><span class="k">module</span> <span class="nn">ArticleSearchable</span>
</span><span class='line'>  <span class="kp">extend</span> <span class="no">ActiveSupport</span><span class="o">::</span><span class="no">Concern</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">included</span> <span class="k">do</span>
</span><span class='line'>    <span class="kp">include</span> <span class="no">Elasticsearch</span><span class="o">::</span><span class="no">Model</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1"># インデックスするフィールドの一覧</span>
</span><span class='line'>    <span class="no">INDEX_FIELDS</span> <span class="o">=</span> <span class="sx">%w(title body)</span><span class="o">.</span><span class="n">freeze</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1"># インデックス名</span>
</span><span class='line'>    <span class="n">index_name</span> <span class="s2">&quot;es_sample_article_</span><span class="si">#{</span><span class="no">Rails</span><span class="o">.</span><span class="n">env</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1"># マッピング情報</span>
</span><span class='line'>    <span class="n">settings</span> <span class="k">do</span>
</span><span class='line'>      <span class="n">mappings</span> <span class="n">dynamic</span><span class="p">:</span> <span class="s1">&#39;false&#39;</span> <span class="k">do</span> <span class="c1"># 動的にマッピングを生成しない</span>
</span><span class='line'>        <span class="n">indexes</span> <span class="ss">:title</span><span class="p">,</span> <span class="n">analyzer</span><span class="p">:</span> <span class="s1">&#39;kuromoji&#39;</span><span class="p">,</span> <span class="n">type</span><span class="p">:</span> <span class="s1">&#39;string&#39;</span>
</span><span class='line'>        <span class="n">indexes</span> <span class="ss">:body</span><span class="p">,</span>  <span class="n">analyzer</span><span class="p">:</span> <span class="s1">&#39;kuromoji&#39;</span><span class="p">,</span> <span class="n">type</span><span class="p">:</span> <span class="s1">&#39;string&#39;</span>
</span><span class='line'>      <span class="k">end</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1"># インデックスするデータを生成</span>
</span><span class='line'>    <span class="c1"># @return [Hash]</span>
</span><span class='line'>    <span class="k">def</span> <span class="nf">as_indexed_json</span><span class="p">(</span><span class="n">option</span> <span class="o">=</span> <span class="p">{})</span>
</span><span class='line'>      <span class="nb">self</span><span class="o">.</span><span class="n">as_json</span><span class="o">.</span><span class="n">select</span> <span class="p">{</span> <span class="o">|</span><span class="n">k</span><span class="p">,</span> <span class="n">_</span><span class="o">|</span> <span class="no">INDEX_FIELDS</span><span class="o">.</span><span class="n">include?</span><span class="p">(</span><span class="n">k</span><span class="p">)</span> <span class="p">}</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">module</span> <span class="nn">ClassMethods</span>
</span><span class='line'>    <span class="c1"># indexの作成メソッド</span>
</span><span class='line'>    <span class="k">def</span> <span class="nf">create_index!</span>
</span><span class='line'>      <span class="n">client</span> <span class="o">=</span> <span class="n">__elasticsearch__</span><span class="o">.</span><span class="n">client</span>
</span><span class='line'>      <span class="n">client</span><span class="o">.</span><span class="n">indices</span><span class="o">.</span><span class="n">delete</span> <span class="n">index</span><span class="p">:</span> <span class="nb">self</span><span class="o">.</span><span class="n">index_name</span> <span class="k">rescue</span> <span class="kp">nil</span>
</span><span class='line'>      <span class="n">client</span><span class="o">.</span><span class="n">indices</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">index</span><span class="p">:</span> <span class="nb">self</span><span class="o">.</span><span class="n">index_name</span><span class="p">,</span>
</span><span class='line'>                            <span class="n">body</span><span class="p">:</span> <span class="p">{</span>
</span><span class='line'>                                <span class="n">settings</span><span class="p">:</span> <span class="nb">self</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">to_hash</span><span class="p">,</span>
</span><span class='line'>                                <span class="n">mappings</span><span class="p">:</span> <span class="nb">self</span><span class="o">.</span><span class="n">mappings</span><span class="o">.</span><span class="n">to_hash</span>
</span><span class='line'>                            <span class="p">})</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>インデックス名には環境情報をつけておきます。</p>

<p>理由はlocalでのテストをしやすくするためです。</p>

<h2>index作成のrakeタスクを作成</h2>

<p>続いてindexを作成するrake タスクを作ります。</p>

<p>まずはrakeタスクを作成するために、以下のコマンドをターミナルで実行します。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">rails</span> <span class="n">g</span> <span class="n">task</span> <span class="n">elasticsearch</span>
</span></code></pre></td></tr></table></div></figure>


<p>作成されたrakeタスクを以下の様に変更します。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="c1"># lib/tasks/elasticsearch.rake</span>
</span><span class='line'><span class="n">namespace</span> <span class="ss">:elasticsearch</span> <span class="k">do</span>
</span><span class='line'>  <span class="n">desc</span> <span class="s1">&#39;Elasticsearch のindex作成&#39;</span>
</span><span class='line'>  <span class="n">task</span> <span class="ss">:create_index</span> <span class="o">=&gt;</span> <span class="ss">:environment</span> <span class="k">do</span>
</span><span class='line'>    <span class="no">Article</span><span class="o">.</span><span class="n">create_index!</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">desc</span> <span class="s1">&#39;Article を Elasticsearch に登録&#39;</span>
</span><span class='line'>  <span class="n">task</span> <span class="ss">:import_article</span> <span class="o">=&gt;</span> <span class="ss">:environment</span> <span class="k">do</span>
</span><span class='line'>    <span class="no">Article</span><span class="o">.</span><span class="n">import</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>ではインデックスを作成します。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">bundle</span> <span class="nb">exec</span> <span class="n">rake</span> <span class="n">elasticsearch</span><span class="ss">:create_index</span>
</span></code></pre></td></tr></table></div></figure>


<p><code>http://localhost:9200/_plugin/head/</code> にアクセスして「es_sample_article_development => info => Metadata」
の中身が以下の様になっていたら成功です！</p>

<p><img src="https://farm2.staticflickr.com/1510/24062169671_9781dc7e17_z.jpg" width="556" height="640"></p>

<p>ちなみに、curlコマンドでもマッピングを確認できます。
ターミナルで以下のコマンドを実行してみてください。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">curl</span> <span class="o">-</span><span class="no">XGET</span> <span class="s1">&#39;localhost:9200/es_sample_article_development/_mapping/article?pretty=true&#39;</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="s2">&quot;es_sample_article_development&quot;</span> <span class="p">:</span> <span class="p">{</span>
</span><span class='line'>    <span class="s2">&quot;mappings&quot;</span> <span class="p">:</span> <span class="p">{</span>
</span><span class='line'>      <span class="s2">&quot;article&quot;</span> <span class="p">:</span> <span class="p">{</span>
</span><span class='line'>        <span class="s2">&quot;dynamic&quot;</span> <span class="p">:</span> <span class="s2">&quot;false&quot;</span><span class="p">,</span>
</span><span class='line'>        <span class="s2">&quot;properties&quot;</span> <span class="p">:</span> <span class="p">{</span>
</span><span class='line'>          <span class="s2">&quot;body&quot;</span> <span class="p">:</span> <span class="p">{</span>
</span><span class='line'>            <span class="s2">&quot;type&quot;</span> <span class="p">:</span> <span class="s2">&quot;string&quot;</span><span class="p">,</span>
</span><span class='line'>            <span class="s2">&quot;analyzer&quot;</span> <span class="p">:</span> <span class="s2">&quot;kuromoji&quot;</span>
</span><span class='line'>          <span class="p">},</span>
</span><span class='line'>          <span class="s2">&quot;title&quot;</span> <span class="p">:</span> <span class="p">{</span>
</span><span class='line'>            <span class="s2">&quot;type&quot;</span> <span class="p">:</span> <span class="s2">&quot;string&quot;</span><span class="p">,</span>
</span><span class='line'>            <span class="s2">&quot;analyzer&quot;</span> <span class="p">:</span> <span class="s2">&quot;kuromoji&quot;</span>
</span><span class='line'>          <span class="p">}</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<h2>サンプルデータの作成</h2>

<p>サンプルデータを作成します。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="c1"># db/seeds.rb</span>
</span><span class='line'><span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Base</span><span class="o">.</span><span class="n">transaction</span> <span class="k">do</span>
</span><span class='line'>  <span class="c1"># ===========================</span>
</span><span class='line'>  <span class="c1"># 記事(Article)</span>
</span><span class='line'>  <span class="c1"># ===========================</span>
</span><span class='line'>  <span class="no">Article</span><span class="o">.</span><span class="n">delete_all</span>
</span><span class='line'>  <span class="mi">10</span><span class="o">.</span><span class="n">times</span> <span class="k">do</span> <span class="o">|</span><span class="n">idx</span><span class="o">|</span>
</span><span class='line'>    <span class="no">Article</span><span class="o">.</span><span class="n">create!</span><span class="p">(</span>
</span><span class='line'>        <span class="n">title</span><span class="p">:</span> <span class="s2">&quot;タイトル </span><span class="si">#{</span><span class="n">idx</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span class='line'>        <span class="n">body</span><span class="p">:</span> <span class="s2">&quot;本文 </span><span class="si">#{</span><span class="n">idx</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span class='line'>    <span class="p">)</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>Elasticsearchにデータを登録します。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="c1"># サンプルデータの生成</span>
</span><span class='line'><span class="n">bundle</span> <span class="nb">exec</span> <span class="n">rake</span> <span class="n">db</span><span class="ss">:seed</span>
</span><span class='line'>
</span><span class='line'><span class="c1"># Elasticsearchへの登録</span>
</span><span class='line'><span class="n">bundle</span> <span class="nb">exec</span> <span class="n">rake</span> <span class="n">elasticsearch</span><span class="ss">:import_article</span>
</span></code></pre></td></tr></table></div></figure>


<p><code>http://localhost:9200/_plugin/head/</code> から「Structured Query」を選択して色々いじるとデータが格納されていることがわかると思います！</p>

<p><img src="https://farm2.staticflickr.com/1607/24037229962_fc29541c95.jpg" width="500" height="346"></p>

<p>ちなみに、<code>rails console</code> からでも色々試せるのでぜひ色々遊んでみてください！</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="no">Article</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s1">&#39;9&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">results</span><span class="o">.</span><span class="n">count</span>
</span><span class='line'><span class="c1">#=&gt; 1</span>
</span><span class='line'>
</span><span class='line'><span class="no">Article</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s1">&#39;9&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">results</span><span class="o">.</span><span class="n">first</span>
</span><span class='line'><span class="c1">#=&gt; #&lt;Elasticsearch::Model::Response::Result:0x007fb7ebac0a08 @result=#&lt;Hashie::Mash _id=&quot;10&quot; _index=&quot;es_sample_article_development&quot; _score=1.1972358 _source=#&lt;Hashie::Mash body=&quot;本文 9&quot; created_at=&quot;2016-01-03T11:02:46.578Z&quot; id=10 title=&quot;タイトル 9&quot; updated_at=&quot;2016-01-03T11:02:46.578Z&quot;&gt; _type=&quot;article&quot;&gt;&gt;</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="no">Article</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">query</span><span class="p">:</span> <span class="p">{</span><span class="n">term</span><span class="p">:</span> <span class="p">{</span><span class="n">title</span><span class="p">:</span> <span class="s2">&quot;5&quot;</span><span class="p">}</span> <span class="p">})</span><span class="o">.</span><span class="n">records</span><span class="o">.</span><span class="n">first</span>
</span><span class='line'><span class="c1">#=&gt; Article Load (0.1ms)  SELECT &quot;articles&quot;.* FROM &quot;articles&quot; WHERE &quot;articles&quot;.&quot;id&quot; = 6</span>
</span><span class='line'><span class="c1">#=&gt; #&lt;Article id: 6, title: &quot;タイトル 5&quot;, body: &quot;本文 5&quot;, created_at: &quot;2016-01-03 11:02:46&quot;, updated_at: &quot;2016-01-03 11:02:46&quot;&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<h2>とりあえず一覧の検索を実装</h2>

<p><code>articles_controller</code> の <code>index</code> を以下のように変更。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="c1"># app/controllers/articles_controller.rb</span>
</span><span class='line'><span class="k">class</span> <span class="nc">ArticlesController</span> <span class="o">&lt;</span> <span class="no">ApplicationController</span>
</span><span class='line'>  <span class="k">def</span> <span class="nf">index</span>
</span><span class='line'>    <span class="vi">@articles</span> <span class="o">=</span><span class="k">if</span> <span class="n">params</span><span class="o">[</span><span class="ss">:search</span><span class="o">]</span>
</span><span class='line'>                 <span class="no">Article</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">params</span><span class="o">[</span><span class="ss">:search</span><span class="o">]</span><span class="p">)</span><span class="o">.</span><span class="n">records</span>
</span><span class='line'>               <span class="k">else</span>
</span><span class='line'>                 <span class="no">Article</span><span class="o">.</span><span class="n">all</span>
</span><span class='line'>               <span class="k">end</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>viewも以下を追加。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="c1"># app/views/articles/index.html.erb</span>
</span><span class='line'><span class="o">&lt;</span><span class="sx">%= form_tag articles_path, :method =</span><span class="o">&gt;</span> <span class="ss">:get</span> <span class="k">do</span> <span class="sx">%&gt;</span>
</span><span class='line'><span class="sx">    &lt;%= text_field_tag :search, params[:search] %&gt;</span>
</span><span class='line'>    <span class="o">&lt;</span><span class="sx">%= submit_tag &#39;Search&#39;, :name =</span><span class="o">&gt;</span> <span class="kp">nil</span> <span class="sx">%&gt;</span>
</span><span class='line'><span class="sx">&lt;% end %&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p><code>http://localhost:3000/articles</code> にアクセスすれば検索できると思います！</p>

<p><img src="https://farm6.staticflickr.com/5799/24038700492_75081a1440.jpg" width="500" height="317"></p>

<br style="clear:both;"/>


<script async src="http://morizyun.github.io//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>


<!-- square -->


<p><ins class="adsbygoogle" style="display:inline-block;width:336px;height:280px" data-ad-client="ca-pub-4186413323075068" data-ad-slot="5059873392"></ins></p>

<script>
    (adsbygoogle = window.adsbygoogle || []).push({});
</script>


<h2>Special Thanks</h2>

<ul>
<li><strong><a href="http://qiita.com/k-shogo/items/8657e0a5fdf20a25bba0">Ruby - railsから全文検索エンジンelasticsearchを利用する - Qiita</a></strong></li>
<li><strong><a href="http://qiita.com/moriyaman/items/373107a3870c33229bac">既存のRailsアプリの検索にElasticSearchを導入してみる - Qiita</a></strong></li>
<li><strong><a href="http://qiita.com/yuku_t/items/d749111f589c88c8315b">Elasticsearch - Qiitaがquery-stringっぽい構文を自前実装した理由 - Qiita</a></strong></li>
<li><strong><a href="http://qiita.com/mosson/items/9a9b0703ac4c76ebfd4e">Rails - Rakeタスクをつくる - Qiita</a></strong></li>
<li><strong><a href="http://ruby-rails.hatenadiary.com/entry/20151018/1445142266">RailsでElasticsearch: 全文検索を実装 - Rails Webook</a></strong></li>
</ul>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Elasticsearch 2.1 + Kibana 4.3 + Marvel のMacへのセットアップ]]></title>
    <link href="http://morizyun.github.io/blog/elasticsearch-kibana-setup-mac/"/>
    <updated>2016-01-02T21:40:00+09:00</updated>
    <id>http://morizyun.github.io/blog/elasticsearch-kibana-setup-mac</id>
    <content type="html"><![CDATA[<p><a href="http://www.amazon.co.jp/gp/product/B00MPDUQQI/ref=as_li_qf_sp_asin_il?ie=UTF8&camp=247&creative=1211&creativeASIN=B00MPDUQQI&linkCode=as2&tag=morizyun00-22"><img border="0" src="http://ws.assoc-amazon.jp/widgets/q?_encoding=UTF8&ASIN=B00MPDUQQI&Format=_SL160_&ID=AsinImage&MarketPlace=JP&ServiceVersion=20070822&WS=1&tag=morizyun00-22" width="150" style="float: left; margin: 0 20px 20px 0;" ></a><img src="http://www.assoc-amazon.jp/e/ir?t=morizyun00-22&l=as2&o=9&a=B00MPDUQQI" width="1" height="1" border="0" alt="" style="border:none !important; margin:0px !important;" />
Mac Yosemiteに以下の環境構築する手順をまとめました！</p>

<ul>
<li>全文検索エンジンの『<strong><a href="https://www.elastic.co/products/elasticsearch">Elasticsearch 2.1</a></strong>』</li>
<li>Elasticsearchのデータ表示のツール『<strong><a href="https://www.elastic.co/products/kibana">Kibana 4.3.1</a></strong>』</li>
<li>Elasticsearchの管理ツール『<strong><a href="https://www.elastic.co/products/marvel">Marvel</a></strong>』</li>
</ul>


<!-- more -->


<br style="clear:both;"/>


<script async src="http://morizyun.github.io//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>


<!-- square -->


<p><ins class="adsbygoogle" style="display:inline-block;width:336px;height:280px" data-ad-client="ca-pub-4186413323075068" data-ad-slot="5059873392"></ins></p>

<script>
    (adsbygoogle = window.adsbygoogle || []).push({});
</script>


<h2>Elasticsearchとは</h2>

<p>ElasticSearchは、Apache Lucene 上で稼働するオープンソースの全文検索システムのことです。
REST APIを使うことができ、jsonでやり取りを行う事ができる。</p>

<h2>Elasticsearch のインストール</h2>

<p>Macの場合は、まずはJavaのインストールです。
<strong><a href="http://www.amazon.co.jp/gp/bestsellers/computers/2151977051/ref=pd_zg_hrsr_computers_1_3_last">Java SE - Downloads | Oracle</a></strong>
からファイルをダウンロードして、インストールします。</p>

<p>次に『<strong><a href="https://www.elastic.co/downloads/past-releases/">Download Elasticsearch | Elastic</a></strong>』からファイルをダウンロードします。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">brew</span> <span class="n">install</span> <span class="n">elasticsearch</span>
</span><span class='line'>
</span><span class='line'><span class="c1"># 自動起動の設定</span>
</span><span class='line'><span class="n">ln</span> <span class="o">-</span><span class="n">sfv</span> <span class="sr">/usr/</span><span class="n">local</span><span class="o">/</span><span class="n">opt</span><span class="o">/</span><span class="n">elasticsearch</span><span class="o">/*.</span><span class="n">plist</span> <span class="o">~</span><span class="sr">/Library/</span><span class="no">LaunchAgents</span>
</span><span class='line'><span class="n">launchctl</span> <span class="nb">load</span> <span class="o">~</span><span class="sr">/Library/</span><span class="no">LaunchAgents</span><span class="o">/</span><span class="n">homebrew</span><span class="o">.</span><span class="n">mxcl</span><span class="o">.</span><span class="n">elasticsearch</span><span class="o">.</span><span class="n">plist</span>
</span></code></pre></td></tr></table></div></figure>


<p><code>http://localhost:9200/_plugin/head/</code>が見れたら動いていると思います！</p>

<p><img src="https://farm2.staticflickr.com/1600/24036707412_4258a9701a.jpg" width="500" height="376"></p>

<h2>日本語対応で elasticsearch-analysis-kuromoji をインストール</h2>

<p>ターミナルで以下を実行。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">plugin</span> <span class="n">install</span> <span class="n">analysis</span><span class="o">-</span><span class="n">kuromoji</span>
</span></code></pre></td></tr></table></div></figure>


<p><code>vi /usr/local/etc/elasticsearch/elasticsearch.yml</code>でファイルを開いて以下を追加。デフォルトで kurmoji を使うようにします。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="c1">################################## Custom ################################</span>
</span><span class='line'><span class="c1"># Using kuromoji in default</span>
</span><span class='line'><span class="n">index</span><span class="o">.</span><span class="n">analysis</span><span class="o">.</span><span class="n">analyzer</span><span class="o">.</span><span class="n">default</span><span class="o">.</span><span class="n">type</span><span class="p">:</span> <span class="n">custom</span>
</span><span class='line'><span class="n">index</span><span class="o">.</span><span class="n">analysis</span><span class="o">.</span><span class="n">analyzer</span><span class="o">.</span><span class="n">default</span><span class="o">.</span><span class="n">tokenizer</span><span class="p">:</span> <span class="n">kuromoji_tokenizer</span>
</span></code></pre></td></tr></table></div></figure>


<p>ということでElasticsearchを再起動します。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">launchctl</span> <span class="n">unload</span> <span class="o">~</span><span class="sr">/Library/</span><span class="no">LaunchAgents</span><span class="o">/</span><span class="n">homebrew</span><span class="o">.</span><span class="n">mxcl</span><span class="o">.</span><span class="n">elasticsearch</span><span class="o">.</span><span class="n">plist</span>
</span><span class='line'><span class="n">launchctl</span> <span class="nb">load</span> <span class="o">~</span><span class="sr">/Library/</span><span class="no">LaunchAgents</span><span class="o">/</span><span class="n">homebrew</span><span class="o">.</span><span class="n">mxcl</span><span class="o">.</span><span class="n">elasticsearch</span><span class="o">.</span><span class="n">plist</span>
</span></code></pre></td></tr></table></div></figure>




<script async src="http://morizyun.github.io//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>


<!-- square -->


<p><ins class="adsbygoogle" style="display:inline-block;width:336px;height:280px" data-ad-client="ca-pub-4186413323075068" data-ad-slot="5059873392"></ins></p>

<script>
    (adsbygoogle = window.adsbygoogle || []).push({});
</script>


<h2>データビジュアライゼーション Kibana</h2>

<p>ミーハーなので データのビジュアライゼーションツール『<strong><a href="https://www.elastic.co/products/kibana">Kibana</a></strong>』
もインストールします。後で使うかもくらいですww</p>

<p>まずはnodeとnmpが必要となります。もしまだの場合は、
『<strong><a href="http://qiita.com/tagosaku324/items/bf1fe149c38c99728c72">macでNode.jsの環境設定 - Qiita</a></strong>』
を参考にしながらインストールしてみてください。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="c1"># 最新版のURLに置き換えてください</span>
</span><span class='line'><span class="n">wget</span> <span class="n">https</span><span class="ss">:/</span><span class="o">/</span><span class="n">download</span><span class="o">.</span><span class="n">elastic</span><span class="o">.</span><span class="n">co</span><span class="o">/</span><span class="n">kibana</span><span class="o">/</span><span class="n">kibana</span><span class="o">/</span><span class="n">kibana</span><span class="o">-</span><span class="mi">4</span><span class="o">.</span><span class="mi">3</span><span class="o">.</span><span class="mi">1</span><span class="o">-</span><span class="n">darwin</span><span class="o">-</span><span class="n">x64</span><span class="o">.</span><span class="n">tar</span><span class="o">.</span><span class="n">gz</span>
</span><span class='line'><span class="n">tar</span> <span class="n">zxvf</span> <span class="n">kibana</span><span class="o">-</span><span class="mi">4</span><span class="o">.</span><span class="mi">3</span><span class="o">.</span><span class="mi">1</span><span class="o">-</span><span class="n">darwin</span><span class="o">-</span><span class="n">x64</span><span class="o">.</span><span class="n">tar</span><span class="o">.</span><span class="n">gz</span>
</span><span class='line'><span class="n">mv</span> <span class="n">kibana</span><span class="o">-</span><span class="mi">4</span><span class="o">.</span><span class="mi">3</span><span class="o">.</span><span class="mi">1</span><span class="o">-</span><span class="n">darwin</span><span class="o">-</span><span class="n">x64</span> <span class="n">kibana</span>
</span><span class='line'><span class="n">cd</span> <span class="n">kibana</span>
</span><span class='line'>
</span><span class='line'><span class="c1"># kibana のサーバを起動</span>
</span><span class='line'><span class="n">bin</span><span class="o">/</span><span class="n">kibana</span>
</span></code></pre></td></tr></table></div></figure>


<p><code>http://localhost:5601/</code> にアクセスするとKibanaの画面が見れると思います。</p>

<p><img src="https://farm6.staticflickr.com/5659/23996427772_e8904e5b3a.jpg" width="500" height="340"></p>

<p>こんな感じの画面が見れれば成功だと思います！</p>

<h2>Elasticsearchの管理プラグイン Mervel</h2>

<p>つづいて、Elasticsearchの管理プラグイン「<strong><a href="https://www.elastic.co/products/marvel">Marvel</a></strong>」をインストールします。
クラスタやインデックスのキャッシュヒット、ドキュメント数などを閲覧できます。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="c1"># Elasticsearchの plugin をインストール</span>
</span><span class='line'><span class="c1"># インストール手順: https://www.elastic.co/downloads/marvel</span>
</span><span class='line'><span class="n">plugin</span> <span class="n">install</span> <span class="n">license</span>
</span><span class='line'><span class="n">plugin</span> <span class="n">install</span> <span class="n">marvel</span><span class="o">-</span><span class="n">agent</span>
</span><span class='line'>
</span><span class='line'><span class="c1"># Kibanaのプラグインとして Marvelをインストール</span>
</span><span class='line'><span class="n">cd</span> <span class="n">kibana</span>
</span><span class='line'><span class="o">.</span><span class="n">/bin</span><span class="o">/</span><span class="n">kibana</span> <span class="n">plugin</span> <span class="o">-</span><span class="n">i</span> <span class="n">elasticsearch</span><span class="o">/</span><span class="n">marvel</span><span class="o">/</span><span class="n">latest</span>
</span></code></pre></td></tr></table></div></figure>


<p>インストールしたら、 ElasticsearchとKibanaを再起動させてください。そして</p>

<p><code>http://localhost:5601/app/marvel</code> にアクセスすると Marvelの画面が見れ得ると思います。</p>

<p><img src="https://farm6.staticflickr.com/5799/24038862862_1fe60fe02e.jpg" width="500" height="365"></p>

<h2>ありがとうございました！</h2>

<blockquote class="twitter-tweet" lang="ja"><p lang="ja" dir="ltr"><a href="https://twitter.com/zyunnosuke">@zyunnosuke</a> 2.xからはkuromojiのインストールはこのようになっています。1.7を選択した理由はそれ以外にもあるんでしょうか？ <a href="https://t.co/M3DOakc4Um">https://t.co/M3DOakc4Um</a></p>&mdash; Jun Ohtani (@johtani) <a href="https://twitter.com/johtani/status/683263779988082688">2016, 1月 2</a></blockquote>


<script async src="http://morizyun.github.io//platform.twitter.com/widgets.js" charset="utf-8"></script>


<p>ということで、 <a href="https://twitter.com/johtani">@johtani</a> さんのおかげで、無事2.1系で手順をかけました。ありがとうございました＾＾</p>

<br style="clear:both;"/>


<h2>Special Thanks</h2>

<ul>
<li><strong><a href="http://qiita.com/watermint/items/fc04baa184be8cbfb251">Using ELK(ElasticSearch 1.4.2 + Logstash 1.4.2 + Kibana 4 Beta3) - Qiita</a></strong></li>
<li><strong><a href="http://qiita.com/atsuya046/items/c53987153487f05e31fd">MacでElasticsearch(1.5.x) + Kuromojiをインストール - Qiita</a></strong></li>
<li><strong><a href="http://ruby-rails.hatenadiary.com/entry/20151018/1445142266">RailsでElasticsearch: 全文検索を実装 - Rails Webook</a></strong></li>
</ul>


<h2>変更来歴</h2>

<p>(2016-01-02 21:40) 新規作成
(2016-01-03 19:40) 記述ミスの修正</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[【Rails初学者向け】Nokogiriをつかって他のWebサイトから情報を取得しよう]]></title>
    <link href="http://morizyun.github.io/blog/nokogiri-scraping-ruby-rails-begineer/"/>
    <updated>2016-01-01T21:50:00+09:00</updated>
    <id>http://morizyun.github.io/blog/nokogiri-scraping-ruby-rails-begineer</id>
    <content type="html"><![CDATA[<p><a href="http://www.amazon.co.jp/gp/product/4797376279/ref=as_li_qf_sp_asin_il?ie=UTF8&camp=247&creative=1211&creativeASIN=4797376279&linkCode=as2&tag=morizyun00-22"><img border="0" src="http://ws.assoc-amazon.jp/widgets/q?_encoding=UTF8&ASIN=4797376279&Format=_SL160_&ID=AsinImage&MarketPlace=JP&ServiceVersion=20070822&WS=1&tag=morizyun00-22" width="150" style="float: left; margin: 0 20px 20px 0;" ></a><img src="http://www.assoc-amazon.jp/e/ir?t=morizyun00-22&l=as2&o=9&a=4797376279" width="1" height="1" border="0" alt="" style="border:none !important; margin:0px !important;" />
ここでは、Rails初学者向けにWebサイトから情報を収集してくるチュートリアルを紹介します。
Nokogiriを使ったサンプルアプリを作ります！</p>

<!-- more -->


<br style="clear:both;"/>


<script async src="http://morizyun.github.io//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>


<!-- square -->


<p><ins class="adsbygoogle" style="display:inline-block;width:336px;height:280px" data-ad-client="ca-pub-4186413323075068" data-ad-slot="5059873392"></ins></p>

<script>
    (adsbygoogle = window.adsbygoogle || []).push({});
</script>


<h2>Nokogiriの基本的な説明</h2>

<p><strong><a href="http://morizyun.github.io/blog/ruby-nokogiri-scraping-tutorial/">Nokogiri を使った Rubyスクレイピング</a></strong></p>

<h2>プロジェクトを作成</h2>

<h3>ローカル開発の場合</h3>

<p>ターミナルで以下のコマンドを実行してください。</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># 新しいRailsアプリを作成
</span><span class='line'>rails new web_scraping_sample --skip-bundle
</span><span class='line'>
</span><span class='line'># web_scraping_sample のフォルダに移動
</span><span class='line'>cd web_scraping_sample</span></code></pre></td></tr></table></div></figure>


<h3>Cloud 9の場合</h3>

<ul>
<li>『<strong><a href="https://c9.io/">Cloud9</a></strong>』にログインして新しいworkspaceを作成</li>
<li>公開していい場合は public 、公開したくない場合は private のRailsアプリを作成してください</li>
</ul>


<h2>Gemfileに以下を追加</h2>

<p>プロジェクト直下のGemfileを開いて以下を追加して下さい。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="c1"># Web Scraping</span>
</span><span class='line'><span class="n">gem</span> <span class="s1">&#39;nokogiri&#39;</span>
</span></code></pre></td></tr></table></div></figure>


<p>追加したらターミナルで以下のコマンドを実行します。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">bundle</span> <span class="n">install</span> <span class="o">--</span><span class="n">jobs</span><span class="o">=</span><span class="mi">4</span> <span class="o">--</span><span class="n">path</span><span class="o">=</span><span class="n">vendor</span><span class="o">/</span><span class="n">bundle</span>
</span></code></pre></td></tr></table></div></figure>


<p>Ruby Gemライブラリをインターネットから持ってきて、自動でローカルに保存します。</p>

<h2>rake タスクの作成</h2>

<p>Rakeタスクを作成します。ターミナルで以下のコマンドを実行してください。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="c1"># railsコマンドで rake タスク を作成(generate)します</span>
</span><span class='line'><span class="n">rails</span> <span class="n">g</span> <span class="n">task</span> <span class="n">scrape</span>
</span></code></pre></td></tr></table></div></figure>


<p>すると、<code>lib/tasks/scrape.rake</code> が作成されます。</p>

<p>ちなみに、<code>Rake</code> とはRubyで記述されたプログラムをコマンドプロンプト(ターミナル)から呼び出し、実行することができる仕組みのことです。</p>

<p>rakeタスクをもう少し知りたい場合は、「<strong><a href="http://qiita.com/mosson/items/9a9b0703ac4c76ebfd4e">Rakeタスクをつくる</a></strong>」がオススメです！</p>

<h2>取得スクリプトを書く</h2>

<p>今回は NaverまとめのTechページからタイトルの一覧を取得する手順です。</p>

<p><code>lib/tasks/scrape.rake</code>を開いて以下の内容を追記してください。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="c1"># URLにアクセスするためのライブラリの読み込み</span>
</span><span class='line'><span class="nb">require</span> <span class="s1">&#39;open-uri&#39;</span>
</span><span class='line'>
</span><span class='line'><span class="n">namespace</span> <span class="ss">:scrape</span> <span class="k">do</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">desc</span> <span class="s1">&#39;NaverまとめのTechページからタイトルを取得&#39;</span>
</span><span class='line'>  <span class="n">task</span> <span class="ss">:naver_title</span> <span class="o">=&gt;</span> <span class="ss">:environment</span> <span class="k">do</span>
</span><span class='line'>    <span class="c1"># スクレイピング先のURL</span>
</span><span class='line'>    <span class="n">url</span> <span class="o">=</span> <span class="s1">&#39;http://matome.naver.jp/tech&#39;</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">charset</span> <span class="o">=</span> <span class="kp">nil</span>
</span><span class='line'>    <span class="n">html</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">url</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">f</span><span class="o">|</span>
</span><span class='line'>      <span class="n">charset</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">charset</span> <span class="c1"># 文字種別を取得</span>
</span><span class='line'>      <span class="n">f</span><span class="o">.</span><span class="n">read</span> <span class="c1"># htmlを読み込んで変数htmlに渡す</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1"># htmlをパース(解析)してオブジェクトを作成</span>
</span><span class='line'>    <span class="n">doc</span> <span class="o">=</span> <span class="no">Nokogiri</span><span class="o">::</span><span class="no">HTML</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">html</span><span class="p">,</span> <span class="kp">nil</span><span class="p">,</span> <span class="n">charset</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">doc</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="s1">&#39;//li[@class=&quot;mdTopMTMList01Item&quot;]&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">node</span><span class="o">|</span>
</span><span class='line'>      <span class="c1"># タイトルの取得</span>
</span><span class='line'>      <span class="nb">puts</span> <span class="n">node</span><span class="o">.</span><span class="n">css</span><span class="p">(</span><span class="s1">&#39;h3&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">inner_text</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>これを実行すると以下の様になります。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">bundle</span> <span class="nb">exec</span> <span class="n">rake</span> <span class="n">scrape</span><span class="ss">:naver_title</span>
</span><span class='line'>
</span><span class='line'><span class="c1"># =&gt; 写真撮って探しものができるアプリ3選</span>
</span><span class='line'><span class="c1"># =&gt; 洋楽好き必見！！音楽の世界が広がるアプリ７選</span>
</span><span class='line'><span class="c1"># =&gt; スマホやPCの「ブルーライト」の量が破壊的！健康対策は大丈夫？</span>
</span><span class='line'><span class="c1"># =&gt; 趣味はかどるわー！ディープなSNSがこんなにあった(ﾟдﾟ)</span>
</span><span class='line'><span class="c1"># =&gt; ちょっとしたシーンで役立つ１０のショートカットキー</span>
</span><span class='line'><span class="c1"># =&gt; ネイルでスマホを操れる？『爪センサー』が画期的</span>
</span><span class='line'><span class="c1"># =&gt; 壁を有効活用したい・・！お洒落な「壁掛けアイテム」たち</span>
</span><span class='line'><span class="c1"># =&gt; Googleも開始。「パスワードなし」でログインの時代キタ？</span>
</span><span class='line'><span class="c1"># =&gt; イヤホンの音がクリアに…！身近ガジェットの簡単お手入れ法</span>
</span><span class='line'><span class="c1"># =&gt; 日本にもこれ欲しい！海外で発売されている斬新な便利グッズ</span>
</span><span class='line'><span class="c1"># =&gt; 次々と数億円を集めるスタートアップが魅力的だった</span>
</span><span class='line'><span class="c1"># =&gt; ３Dじゃない方のプリンターも面白いのがたくさんあった</span>
</span><span class='line'><span class="c1"># =&gt; なにこれスゴい！自転車を盗んだヤツを見つける最新グッズ</span>
</span><span class='line'><span class="c1"># =&gt; トラックボールで作業効率UP！もうマウスなんて使わない！</span>
</span><span class='line'><span class="c1"># =&gt; 可視化でわかりやすく！医療の見える化が思った以上に見えている！</span>
</span><span class='line'><span class="c1"># =&gt; 眠れない夜にさよなら「本当に熟睡出来る」評判の快眠アプリ5選</span>
</span><span class='line'><span class="c1"># =&gt; エネループの代わりになる「おしゃれな」充電池たち</span>
</span><span class='line'><span class="c1"># =&gt; なにこれすごい…アメリカ軍の開発が未来を先取りしてる</span>
</span><span class='line'><span class="c1"># =&gt; 手に着けるだけのリストバンド型ガジェットで健康を記録する</span>
</span><span class='line'><span class="c1"># =&gt; AppleWatchピンチ？進化したスマートウォッチのいま</span>
</span></code></pre></td></tr></table></div></figure>


<h2>Nokogiriで参考になりそうなサイト</h2>

<p>実際にNokogiriのコードを書くときに役に立ちそうなチートシート的なサイトを紹介しておきます。</p>

<ul>
<li><strong><a href="http://d.hatena.ne.jp/otn/20090509/p1">スクレイピングのためのNokogiri利用メモ</a></strong></li>
</ul>


<br style="clear:both;"/>


<script async src="http://morizyun.github.io//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>


<!-- square -->


<p><ins class="adsbygoogle" style="display:inline-block;width:336px;height:280px" data-ad-client="ca-pub-4186413323075068" data-ad-slot="5059873392"></ins></p>

<script>
    (adsbygoogle = window.adsbygoogle || []).push({});
</script>


<h2>Special Thanks</h2>

<p><strong><a href="http://www.u-ziq.com/blog/2007/12/ruby_on_rails.html">初心者向けのRuby on Railsの用語説明</a></strong></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Hard Things 成長する組織で大切なことを知ることができる [書評]]]></title>
    <link href="http://morizyun.github.io/blog/hard-things-ben-horowitz-book-review/"/>
    <updated>2015-12-31T21:35:00+09:00</updated>
    <id>http://morizyun.github.io/blog/hard-things-ben-horowitz-book-review</id>
    <content type="html"><![CDATA[<p><a href="http://www.amazon.co.jp/gp/product/B00W535LOU/ref=as_li_qf_sp_asin_il?ie=UTF8&camp=247&creative=1211&creativeASIN=B00W535LOU&linkCode=as2&tag=morizyun00-22"><img border="0" src="http://ws.assoc-amazon.jp/widgets/q?_encoding=UTF8&ASIN=B00W535LOU&Format=_SL160_&ID=AsinImage&MarketPlace=JP&ServiceVersion=20070822&WS=1&tag=morizyun00-22" width="150" style="float: left; margin: 0 20px 20px 0;" ></a><img src="http://www.assoc-amazon.jp/e/ir?t=morizyun00-22&l=as2&o=9&a=B00W535LOU" width="1" height="1" border="0" alt="" style="border:none !important; margin:0px !important;" />
ベンチャーキャピタル「アンドリーセン・ホロウィッツ」の共同創業者ベン・ホロウィッツが書いた
『<strong><a href="http://www.amazon.co.jp/gp/product/B00W535LOU/ref=as_li_qf_sp_asin_il?ie=UTF8&amp;camp=247&amp;creative=1211&amp;creativeASIN=B00W535LOU&amp;linkCode=as2&amp;tag=morizyun00-22">Hard Things</a></strong>』
を読んだのでその感想です。</p>

<p>題名の「Hard Things(困難)」通り、ベン・ホロウィッツが経験した様々な苦難が切実に語られている書籍。
華々しく語られるスタートアップ業界は、実は本当はそんなに素晴らしいことばかりではなく、様々な困難を切り開いてきたのだと知ることができます。</p>

<p>この本の中から特に面白かった点を中心に書いていきます。</p>

<!-- more -->


<br style="clear:both;"/>


<script async src="http://morizyun.github.io//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>


<!-- square -->


<p><ins class="adsbygoogle" style="display:inline-block;width:336px;height:280px" data-ad-client="ca-pub-4186413323075068" data-ad-slot="5059873392"></ins></p>

<script>
    (adsbygoogle = window.adsbygoogle || []).push({});
</script>


<h2>組織運営で重要なこと</h2>

<pre>
- 組織が何をこれからすべきかを知ること
- 組織がすべきことを実行していくこと
</pre>


<p>「組織が何をこれからすべきかを見つけられる」タイプのマネージャーは、たくさんの情報を収集し、大きな決断を躊躇なくこなすことができる。</p>

<p>「組織がすべきことを実行していくのが特異」なタイプのマネージャーは、実行・改善することに価値を置く。一方で不完全な状態で判断をしないと
いけないため、大きな決断をするときに、躊躇しやすい傾向にある</p>

<h2>リーダーの属性</h2>

<pre>
- スティーブ・ジョブズのようにビジョンを語り、優秀な人を惹きつけ続ける力
- 心の底から部下を気遣って行動することで、組織に属することに誇りを持って行動させられる力
- 素晴らしいアイデアを選りすぐり、実現にこぎつける純然たる経営能力
</pre>


<h2>正しい動機からフィードバックを与える</h2>

<pre>
- 相手の成功を助けるための、フィードバックを与えよう
- 相手に味方だと伝え、感情を伝える努力をしよう
- フィードバックは迅速に、頻繁に行おう
</pre>


<h2>社員が直面する問題解決に貢献しやすい環境を提供出来ているか？</h2>

<pre>
- 仕事をやり遂げれば、良いことが訪れると確信できる(動機付け)
- コミュニケーションが活発化され、大量の知識が共有されることでコンテキストが明確になっていること
- 社員が新たなスキルを身につけるために、組織は出来る限りの投資を行う
</pre>


<h2>苦闘を愛せ</h2>

<p>個々人独自の性格を愛し、自分の生い立ちを愛し、自分の直感を信じよう。
困難に直面した時、何をすべきかは自らが判断するしかないのだから。
この言葉はスタートアップのCEOに当てたメッセージだが、本質的にはどんな仕事の人にも当てはまると思う。</p>

<h2>プロダクト・マネージャーのあるべき姿</h2>

<pre>
- 何をすべきかを明確にして、実現するまでを管理する
- ドキュメントと口頭の両方で明確なコミュニケーションを取る
- 他のメンバーに役立つドキュメントの整備を徹底する
- 製品の欠陥を予測して、真の解決策を準備する
- 計画をたてる段階では「優れた価値を届けること」に注力し、リリース後は売上を基準に考える
- マスコミに書いてもらいたいストーリーを考える
- 規律を重んじて、毎週時間通りに状況報告を行う
</pre>


<h2>経営の品質は社員のライフサイクルにある</h2>

<p>社員のモチベーションが、経営の品質を図る上で特に重要な指標となる。</p>

<pre>
- 社員は胸を躍らせて出社しているか？
- 社員は会社のミッションを信じているか？
- 会社に出社することを、心から楽しみにしているか？
- 社員は自分が期待されていることを明確に理解しているか？
</pre>


<p>人事責任者はプロセスを正確に設計し、マネージャーの改善に心から貢献する。</p>

<h2>目の前で行われていることを理解する</h2>

<p>目に見える成果だけを追ってはダメだ。ソフトウェアの開発責任者が欠陥のあるプラットフォームを放置して、
無理やり幾つもの新機能を追加すれば、その場では目標が達成できるように見えるかもしれないが、次の
バージョンアップが不可能になる。目の前で何が行われているかを正確に理解すべきだ。</p>

<h2>個人面談で役立つ質問の例</h2>

<pre>
- やり方を改善するとしたら、どんな点をどうすればいいと思う？
- 組織で最大の問題点は何だと思う？ その理由は？
- この職場で働く、一番不愉快な点は何？
- 一番頑張って貢献しているのは誰だと思う？誰を尊敬する？
- キミがCEOだとしたら、どんな改革をしたい？
- 我々の製品で一番気に入らない点はどこ？
- われわれがチャンスを逃している点があるとしたらどこだろう？
- 本来やらなければならないのに、今やっていないことは何だろう？
- この会社で働くのは楽しい？
</pre>


<h2>企業文化の重要性</h2>

<p>企業文化は、「働くのに楽しい場所」という根本的な価値を維持するのに大きな意味を持つ。
そして、顧客に価値を届け、美しい製品を作り続けられるような仕事のやり方を根付かせる。
長時間にわたって、大勢の社員の行動に影響を与えられるような重要な点に絞って企業文化を考えるべきだ。</p>

<h2>組織が大きくなることによる課題</h2>

<p>組織が大きくなることによる課題は以下の様なことだ。</p>

<pre>
- 組織内のコミュニケーション
- 共通認識
- 意思決定
</pre>


<p>専門性を担保するための組織構造が必要となる。だが、すべての組織デザインは悪だという原則を忘れるな。
会社のある部分のコミュニケーションを犠牲にする事によって、他の部分のコミュニケーションを改善していることが重要だ。</p>

<h2>組織のデザイン</h2>

<p>組織デザインのフローは次の通り。</p>

<pre>
(1) どの部分に最も強いコミュニケーション経路が必要かを考える
(2) どんな意思決定が必要なのかを検討する
(3) 重要度の高い意思決定・コミュニケーション経路を優先する
(4) それぞれの部門が誰を管理するのかを決める
(5) 優先しなかったコミュニケーション経路を認識する
(6) 優先しなかったコミュニケーション経路から出る問題を最小限にする
</pre>


<h2>ワークフローのデザイン</h2>

<p>ワークフローのデザインにおける重要な点は次の通り。</p>

<pre>
- 成果に集中すること。プロセス化によって何を得られるのか？
- プロセスのそれぞれのステップごとに、何が必要か？それが正しく得られているかを確認すること
- 責任の所在を明確にする。社員のパフォーマンスを可視化する
</pre>




<br style="clear:both;"/>


<script async src="http://morizyun.github.io//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>


<!-- square -->


<p><ins class="adsbygoogle" style="display:inline-block;width:336px;height:280px" data-ad-client="ca-pub-4186413323075068" data-ad-slot="5059873392"></ins></p>

<script>
    (adsbygoogle = window.adsbygoogle || []).push({});
</script>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[「ぼくのかんがえたさいきょうの Rails スタートダッシュ」というタイトルで発表してきました！]]></title>
    <link href="http://morizyun.github.io/blog/rails-learning-start-dash-slide/"/>
    <updated>2015-12-30T21:00:00+09:00</updated>
    <id>http://morizyun.github.io/blog/rails-learning-start-dash-slide</id>
    <content type="html"><![CDATA[<p><a href="http://www.amazon.co.jp/gp/product/4774178020/ref=as_li_qf_sp_asin_il?ie=UTF8&camp=247&creative=1211&creativeASIN=4774178020&linkCode=as2&tag=morizyun00-22"><img border="0" src="http://ws.assoc-amazon.jp/widgets/q?_encoding=UTF8&ASIN=4774178020&Format=_SL160_&ID=AsinImage&MarketPlace=JP&ServiceVersion=20070822&WS=1&tag=morizyun00-22" width="150" style="float: left; margin: 0 20px 20px 0;" ></a><img src="http://www.assoc-amazon.jp/e/ir?t=morizyun00-22&l=as2&o=9&a=4774178020" width="1" height="1" border="0" alt="" style="border:none !important; margin:0px !important;" />
2015/12/22に社内勉強会で「ぼくのかんがえたさいきょうの Rails スタートダッシュ」というタイトルで発表をしてきました！</p>

<!-- more -->


<br style="clear:both;"/>


<script async src="http://morizyun.github.io//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>


<!-- square -->


<p><ins class="adsbygoogle" style="display:inline-block;width:336px;height:280px" data-ad-client="ca-pub-4186413323075068" data-ad-slot="5059873392"></ins></p>

<script>
    (adsbygoogle = window.adsbygoogle || []).push({});
</script>


<h2>発表スライド</h2>

<p>まずは発表スライドはこちら！</p>

<iframe src="http://morizyun.github.io//www.slideshare.net/slideshow/embed_code/key/h23sQZZPbyzwK6" width="595" height="485" frameborder="0" marginwidth="0" marginheight="0" scrolling="no" style="border:1px solid #CCC; border-width:1px; margin-bottom:5px; max-width: 100%;" allowfullscreen> </iframe>


<h2>特に伝えたかったこと</h2>

<ul>
<li>Web開発は、git/javascript/css/ruby/CI等々覚えることたくさんで大変</li>
<li>新しい技術もどんどん生まれていくので、学び続けることが大切</li>
<li>学び続けるためには、「楽しむこと」。楽しめるものを見つけよう</li>
<li>Railsは日本語ドキュメント充実してるから、Web 開発を始めたいなという人におすすめ</li>
</ul>


<h2>オススメリンク</h2>

<ul>
<li>(開発環境)

<ul>
<li><strong><a href="http://morizyun.github.io/blog/yosemite-mac-rails-setup-rbenv-ruby/">Mac / Rails開発環境構築手順</a></strong></li>
<li><strong><a href="https://c9.io/">Windows / Cloud9</a></strong></li>
</ul>
</li>
<li>(最初) <strong><a href="http://morizyun.github.io/blog/rails-beginner-first-step-guide/">ぼくのかんがえたさいきょうのRailsファーストガイド</a></strong></li>
<li>(脱初心者) <strong><a href="http://morizyun.github.io/blog/ruby-rails-non-beginner-guide-book/">Ruby on Rails を仕事にしていくための第一歩(Rails Tutorialの巻末掲載)</a></strong></li>
<li>(神ポスト) <strong><a href="http://qiita.com/jnchito/items/dedb3b889ab226933ccf">RubyやRailsでリファクタリングに 使えそうなイディオムとか便利メソッドとか</a></strong></li>
<li>(オススメ書籍) <strong><a href="http://www.amazon.co.jp/gp/product/4873115655/ref=as_li_qf_sp_asin_il?ie=UTF8&amp;camp=247&amp;creative=1211&amp;creativeASIN=4873115655&amp;linkCode=as2&amp;tag=morizyun00-22">リーダブルコード</a></strong></li>
<li>(オススメ書籍) <strong><a href="https://leanpub.com/everydayrailsrspec-jp">Everyday Rails - RSpecに よるRailsテスト入門</a></strong></li>
<li>(Gemの検索) <strong><a href="https://www.ruby-toolbox.com/">The Ruby toolbox</a></strong></li>
</ul>


<br style="clear:both;"/>


<script async src="http://morizyun.github.io//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>


<!-- square -->


<p><ins class="adsbygoogle" style="display:inline-block;width:336px;height:280px" data-ad-client="ca-pub-4186413323075068" data-ad-slot="5059873392"></ins></p>

<script>
    (adsbygoogle = window.adsbygoogle || []).push({});
</script>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[「個人開発のススメ」というタイトルで発表してきました！]]></title>
    <link href="http://morizyun.github.io/blog/individual-development-slide-gunosy-beer-bash/"/>
    <updated>2015-12-28T20:05:00+09:00</updated>
    <id>http://morizyun.github.io/blog/individual-development-slide-gunosy-beer-bash</id>
    <content type="html"><![CDATA[<p><a href="http://www.amazon.co.jp/gp/product/4883379930/ref=as_li_qf_sp_asin_il?ie=UTF8&camp=247&creative=1211&creativeASIN=4883379930&linkCode=as2&tag=morizyun00-22"><img border="0" src="http://ws.assoc-amazon.jp/widgets/q?_encoding=UTF8&ASIN=4883379930&Format=_SL160_&ID=AsinImage&MarketPlace=JP&ServiceVersion=20070822&WS=1&tag=morizyun00-22" width="150" style="float: left; margin: 0 20px 20px 0;" ></a><img src="http://www.assoc-amazon.jp/e/ir?t=morizyun00-22&l=as2&o=9&a=4883379930" width="1" height="1" border="0" alt="" style="border:none !important; margin:0px !important;" />
2015/12/05に『<strong><a href="http://gunosy-beer.connpass.com/event/22825/">エムスリー x Gunosy Beer bash！</a></strong>』で、
「<strong><a href="http://www.slideshare.net/morizyun/ss-55929702">個人開発のススメ</a></strong>」というタイトルで発表しました！</p>

<!-- more -->


<br style="clear:both;"/>


<script async src="http://morizyun.github.io//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>


<!-- square -->


<p><ins class="adsbygoogle" style="display:inline-block;width:336px;height:280px" data-ad-client="ca-pub-4186413323075068" data-ad-slot="5059873392"></ins></p>

<script>
    (adsbygoogle = window.adsbygoogle || []).push({});
</script>


<h2>発表スライド</h2>

<p>まずは発表スライドはこちら！</p>

<iframe src="http://morizyun.github.io//www.slideshare.net/slideshow/embed_code/key/dZM4S2V9aL3js" width="595" height="485" frameborder="0" marginwidth="0" marginheight="0" scrolling="no" style="border:1px solid #CCC; border-width:1px; margin-bottom:5px; max-width: 100%;" allowfullscreen> </iframe>


<h2>特に伝えたかったこと</h2>

<ul>
<li>今回伝えたいこと 個人開発は「夢」がある！ (๑•̀ㅁ•́๑)✧</li>
<li>企業はスケールして利益の出るものしか作れない</li>
<li>個人エンジニアなら自分で作れるので思う存分、自分の満足を追求できるよ！</li>
<li>アイデアは質より量。思いつきをメモにまとめて、簡単なものから作ってみよう！</li>
<li>もくもく会に出て、仲間を見つけたり、ブログやQiitaで記事を書こう</li>
</ul>


<br style="clear:both;"/>


<script async src="http://morizyun.github.io//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>


<!-- square -->


<p><ins class="adsbygoogle" style="display:inline-block;width:336px;height:280px" data-ad-client="ca-pub-4186413323075068" data-ad-slot="5059873392"></ins></p>

<script>
    (adsbygoogle = window.adsbygoogle || []).push({});
</script>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[AH-GC20 音楽がもっと好きになった！ノイズキャンセリング & Bluetooth ヘッドホン【ガジェットレポート】]]></title>
    <link href="http://morizyun.github.io/blog/ah-gc20-denon-headphone/"/>
    <updated>2015-12-27T11:15:00+09:00</updated>
    <id>http://morizyun.github.io/blog/ah-gc20-denon-headphone</id>
    <content type="html"><![CDATA[<p><a href="http://www.amazon.co.jp/gp/product/B00W8PWZKS/ref=as_li_qf_sp_asin_il?ie=UTF8&camp=247&creative=1211&creativeASIN=B00W8PWZKS&linkCode=as2&tag=morizyun00-22"><img border="0" src="http://ws.assoc-amazon.jp/widgets/q?_encoding=UTF8&ASIN=B00W8PWZKS&Format=_SL160_&ID=AsinImage&MarketPlace=JP&ServiceVersion=20070822&WS=1&tag=morizyun00-22" width="150" style="float: left; margin: 0 20px 20px 0;" ></a><img src="http://www.assoc-amazon.jp/e/ir?t=morizyun00-22&l=as2&o=9&a=B00W8PWZKS" width="1" height="1" border="0" alt="" style="border:none !important; margin:0px !important;" />Bluetoothとノイズキャンセリングがセットになったヘッドホン『<strong><a href="http://www.amazon.co.jp/gp/product/B00W8PWZKS/ref=as_li_qf_sp_asin_il?ie=UTF8&amp;camp=247&amp;creative=1211&amp;creativeASIN=B00W8PWZKS&amp;linkCode=as2&amp;tag=morizyun00-22">Denon AH-GC20</a></strong>』を購入したので、そのガジェットレポートです。</p>

<p>結論としては、デスクワークで落ち着いて音楽を聞くときには、音が優しいので一日中聞いていても疲れない、本当にオススメのヘッドホンです！</p>

<!-- more -->


<br style="clear:both;"/>


<script async src="http://morizyun.github.io//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>


<!-- square -->


<p><ins class="adsbygoogle" style="display:inline-block;width:336px;height:280px" data-ad-client="ca-pub-4186413323075068" data-ad-slot="5059873392"></ins></p>

<script>
    (adsbygoogle = window.adsbygoogle || []).push({});
</script>


<h2>主な機能</h2>

<p><a href="http://www.amazon.co.jp/gp/product/B00W8PWZKS/ref=as_li_qf_sp_asin_il?ie=UTF8&camp=247&creative=1211&creativeASIN=B00W8PWZKS&linkCode=as2&tag=morizyun00-22"><img src="https://farm6.staticflickr.com/5803/23625553989_c4ef2dbb3c.jpg" width="375" height="500" alt="Evernote Snapshot 20151226 204441"></a></p>

<p>『<strong><a href="http://www.amazon.co.jp/gp/product/B00W8PWZKS/ref=as_li_qf_sp_asin_il?ie=UTF8&amp;camp=247&amp;creative=1211&amp;creativeASIN=B00W8PWZKS&amp;linkCode=as2&amp;tag=morizyun00-22">Denon AH-GC20</a></strong>』の主な機能はこちら。</p>

<pre>
- Bluetooth : ワイヤレスでiPhone/Androidなどに接続できるので、ケーブルが邪魔にならない
- ノイズキャンセリング : 人の声以外の雑音だとを上手く消してくれるので、音楽がクリアに聞こえる
- 遮音性が高い : ヘッドホン自体の遮音性がとても高いので、小さな音でも音楽が聴きやすい
- 耳への付け心地のいい : 耳を圧迫しないので、長時間ヘッドホンをつけていても疲れない
- 20時間連続再生 : バッテリーの持ちがいい。ノイズキャンセリング、Bluetoothを同時に使用して20時間対応
- aptX / AACに対応 : Bluetoothでのデータ転送のタイムラグが少なく、高音質の音楽データを送信できる
</pre>


<h2>ヘッドホンのつけ心地</h2>

<p>今までインナーイヤホンを使ってきた最大の理由はヘッドホンのつけ心地が苦手だったからでした。</p>

<p>でも『<strong><a href="http://www.amazon.co.jp/gp/product/B00W8PWZKS/ref=as_li_qf_sp_asin_il?ie=UTF8&amp;camp=247&amp;creative=1211&amp;creativeASIN=B00W8PWZKS&amp;linkCode=as2&amp;tag=morizyun00-22">Denon AH-GC20</a></strong>』
は他のサイトのレビューでもつけ心地の良さの評価がすごく高かったです。</p>

<p>実際にヘッドホンを数日試した時に一番感動したのがココでした。耳を優しく覆いかぶさるような形で、
遮音性が高いのに、圧迫感が少なく、つけ心地が良い点でした。</p>

<p>今までヘッドホンの利用を避けてきた人に、ぜひ一度店頭でつけ心地を試して欲しいです＾＾</p>

<h2>ノイズキャンセリング</h2>

<p>ノイズキャンセリングで一番有名なのは「<strong><a href="http://www.amazon.co.jp/gp/product/B00N2OJ9VC/ref=as_li_qf_sp_asin_il?ie=UTF8&amp;camp=247&amp;creative=1211&amp;creativeASIN=B00N2OJ9VC&amp;linkCode=as2&amp;tag=morizyun00-22">BoseのQuietComfort</a></strong>」です。このヘッドホンのノイズキャンセリングは本当に強力で、一度だけ飛行機で使ったことがありますが、
本当にびっくりするくらい周りを静かにしてくれます。ほんの少しのホワイトノイズ(ノイズキャンセリングの音)以外は無音と言っても過言じゃなかったです。</p>

<p>ただ2015年12月時点では、ノイズキャンセリングとBluetoothが両方あるヘッドホンはBose販売されていないと思います。
また以前使っていた時には、耳への圧迫感が強すぎて、長時間つけるのが辛かった記憶があります。このあたりは好みが別れるところだと思います。</p>

<p>このあたりが、今回『<strong><a href="http://www.amazon.co.jp/gp/product/B00W8PWZKS/ref=as_li_qf_sp_asin_il?ie=UTF8&amp;camp=247&amp;creative=1211&amp;creativeASIN=B00W8PWZKS&amp;linkCode=as2&amp;tag=morizyun00-22">Denon AH-GC20</a></strong>』を選択した理由です。</p>

<p>何日かノイズキャンセリングを試してみた感想ですが、確かにBoseのノイズキャンセリングに比べると少し、ノイズキャンセリングの機能は少し弱いと感じます。</p>

<p>でも、ヘッドセット自体の遮音性が高いので正直それだけでも十二分に満足できるし、ノイズキャンセリング自体が音楽を聴きやすくすることを
手助けしているとのをすごく感じます。むしろ、音楽を楽しむということが本来の目的にマッチしています。DENONの「音楽で感動を伝える」というこだわりを感じさせてくれます。</p>

<p>また、『<strong><a href="http://www.amazon.co.jp/gp/product/B00W8PWZKS/ref=as_li_qf_sp_asin_il?ie=UTF8&amp;camp=247&amp;creative=1211&amp;creativeASIN=B00W8PWZKS&amp;linkCode=as2&amp;tag=morizyun00-22">Denon AH-GC20</a></strong>』はBluetooth と ノイズキャンセリングが ONの状態をメインに設計されているので、Bluetoothや、ノイズキャンセリングを使っているときの音がきれいだと感じました。</p>

<h2>音質</h2>

<p>正直言って僕は音楽を集中して効くというよりは、作業をやっているときについでにながらで音楽を流すタイプなので、
音質については中々評価できない気がします。ただそんな僕が購入するときに参考にしたレビューがこちらです。</p>

<iframe width="560" height="315" src="https://www.youtube.com/embed/1gvN0T2YN2k" frameborder="0" allowfullscreen></iframe>


<p>音楽の聞き方、シチュエーションや、好みの音によって変わりますが、購入するときに参考になったし、
購入した後にもこのレビューは結構的を得ているなと感じました＾＾</p>

<h2>オススメのシチュエーション</h2>

<p><a data-flickr-embed="true"  href="http://www.amazon.co.jp/gp/product/B00W8PWZKS/ref=as_li_qf_sp_asin_il?ie=UTF8&camp=247&creative=1211&creativeASIN=B00W8PWZKS&linkCode=as2&tag=morizyun00-22"><img src="https://farm2.staticflickr.com/1494/23968052196_02dfc044de.jpg" width="375" height="500"></a></p>

<pre>
- アウトドア
  - インナーイヤータイプのイヤホンと比べると重量を感じる
  - 走ったりするときにはインナーイヤータイプのイヤホンのほうがオススメ
- インドア・デスクワーク
  - デスクワークでコードを書きながら、音楽を流し聴きするのにオススメです
  - 耳への圧迫感も感じないので、1日中使っていても特に気にならない
  - 音もすごく優しいので、本当に音楽聞いてて楽しいと感じる
</pre>




<br style="clear:both;"/>


<script async src="http://morizyun.github.io//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>


<!-- square -->


<p><ins class="adsbygoogle" style="display:inline-block;width:336px;height:280px" data-ad-client="ca-pub-4186413323075068" data-ad-slot="5059873392"></ins></p>

<script>
    (adsbygoogle = window.adsbygoogle || []).push({});
</script>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[【Rails初学者向け】Twitterへ投稿するRailsアプリを作ってみよう]]></title>
    <link href="http://morizyun.github.io/blog/ruby-rails-beginner-twitter-post-app/"/>
    <updated>2015-12-26T19:50:00+09:00</updated>
    <id>http://morizyun.github.io/blog/ruby-rails-beginner-twitter-post-app</id>
    <content type="html"><![CDATA[<p><a href="http://www.amazon.co.jp/gp/product/4797380357/ref=as_li_qf_sp_asin_il?ie=UTF8&camp=247&creative=1211&creativeASIN=4797380357&linkCode=as2&tag=morizyun00-22"><img border="0" src="http://ws.assoc-amazon.jp/widgets/q?_encoding=UTF8&ASIN=4797380357&Format=_SL160_&ID=AsinImage&MarketPlace=JP&ServiceVersion=20070822&WS=1&tag=morizyun00-22" width="150" style="float: left; margin: 0 20px 20px 0;" ></a><img src="http://www.assoc-amazon.jp/e/ir?t=morizyun00-22&l=as2&o=9&a=4797380357" width="1" height="1" border="0" alt="" style="border:none !important; margin:0px !important;" />
最近初心者の人向けにRuby/Railsのアプリの開発についてレクチャーしたので、その時作った手順をブログ記事にしました。</p>

<p>もし、やってみてわからないところとか、ハマりやすいところとかあれば <strong><a href="https://twitter.com/zyunnosuke">@zyunnosuke</a></strong> にメッセージください！</p>

<!-- more -->


<br style="clear:both;"/>


<script async src="http://morizyun.github.io//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>


<!-- square -->


<p><ins class="adsbygoogle" style="display:inline-block;width:336px;height:280px" data-ad-client="ca-pub-4186413323075068" data-ad-slot="5059873392"></ins></p>

<script>
    (adsbygoogle = window.adsbygoogle || []).push({});
</script>


<h2>プロジェクトを作成</h2>

<h3>ローカル開発の場合</h3>

<p>ターミナルで以下のコマンドを実行してください。</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># 新しいRailsアプリを作成
</span><span class='line'>rails new twitter_post_sample --skip-bundle
</span><span class='line'>
</span><span class='line'># twitter_post_sample のフォルダに移動
</span><span class='line'>cd twitter_post_sample</span></code></pre></td></tr></table></div></figure>


<h3>Cloud 9の場合</h3>

<ul>
<li>『<strong><a href="https://c9.io/">Cloud9</a></strong>』にログインして新しいworkspaceを作成</li>
<li>privateのRailsアプリを作成してください</li>
</ul>


<h2>Gemfileに以下を追加</h2>

<p>プロジェクト直下のGemfileを開いて以下を追加して下さい。
(minimum-omniauth-scaffold は最後に補足を書いています)</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">gem</span> <span class="s1">&#39;twitter&#39;</span>
</span><span class='line'><span class="n">gem</span> <span class="s1">&#39;minimum-omniauth-scaffold&#39;</span>
</span><span class='line'><span class="n">gem</span> <span class="s1">&#39;haml&#39;</span>
</span></code></pre></td></tr></table></div></figure>


<p>追加したらターミナルで以下のコマンドを実行します。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">bundle</span> <span class="n">install</span> <span class="o">--</span><span class="n">jobs</span><span class="o">=</span><span class="mi">4</span> <span class="o">--</span><span class="n">path</span><span class="o">=</span><span class="n">vendor</span><span class="o">/</span><span class="n">bundle</span>
</span></code></pre></td></tr></table></div></figure>


<p>Ruby Gemライブラリをインターネットから持ってきて、自動でローカルに保存します。</p>

<h2>Twitter認証用のScaffold</h2>

<p>以下のコマンドを実行して、OmniAuth用のScaffoldを作成。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">bundle</span> <span class="nb">exec</span> <span class="n">rails</span> <span class="n">g</span> <span class="n">minimum</span><span class="ss">:omniauth:scaffold</span>
</span></code></pre></td></tr></table></div></figure>


<h2>テーブルの作成</h2>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">bundle</span> <span class="nb">exec</span> <span class="n">rake</span> <span class="n">db</span><span class="ss">:migrate</span>
</span></code></pre></td></tr></table></div></figure>


<h2>TwitterのAPI keyを取得</h2>

<p><a href="https://apps.twitter.com/">Twitter Application Management</a>に新しいアプリを登録して下さい。
手順がわからない場合は、『<a href="http://blogs.zealot.co.jp/archives/810">Rails環境でTwitterとFacebookを使ってサイトの拡散をするため自動投稿させるアプリを作成してみた</a>』
を参考にしてみてください。</p>

<p>最初にユーザー登録とか必要かもしれません。</p>

<p>ちなみに設定は以下の様ようにしました。</p>

<pre>
Name : (ユニークな名前にしてください。クライアント名としてtwitter上で表示されるのでいい名前にしてください)
Description : (適当に書いてください)
Website : http://www.example.com (公開するときはそのURLを。今回はローカルテスト用の設定です)
Callback URL : http://www.example.com/callback (公開するときはコールバックのURLを書いてください。今回はローカルテスト用の設定です)
</pre>


<p>「Keys and Access Tokens」に Consumer Key と Consumer Secret があるので、次のファイルに書いてください。</p>

<h2>Twitter API keyをRailsに設定</h2>

<p><code>config/settings.local.yml</code> を開いて以下の内容を追記して下さい。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="c1"># Twitter OAuth Local Setting</span>
</span><span class='line'><span class="c1"># - 可能なら環境変数にしてしまったほうがいいと思います</span>
</span><span class='line'><span class="n">twitter_key</span><span class="p">:</span>    <span class="s2">&quot;xxxxxxxxxxxxxxxxxxxxxxx&quot;</span>
</span><span class='line'><span class="n">twitter_secret</span><span class="p">:</span> <span class="s2">&quot;yyyyyyyyyyyyyyyyyyyyyyyyyyyy&quot;</span>
</span></code></pre></td></tr></table></div></figure>


<h2>controllerの処理を追加</h2>

<p>新しい処理を行うcontrollerのactionを追加します。</p>

<p><code>app/controller/top_controller.rb</code>に以下の内容を追加します。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">class</span> <span class="nc">TopController</span> <span class="o">&lt;</span> <span class="no">ApplicationController</span>
</span><span class='line'>  <span class="c1"># ↓ ここを追加</span>
</span><span class='line'>  <span class="c1"># tweet</span>
</span><span class='line'>  <span class="k">def</span> <span class="nf">tweet</span>
</span><span class='line'>    <span class="n">client</span> <span class="o">=</span> <span class="no">Twitter</span><span class="o">::</span><span class="no">REST</span><span class="o">::</span><span class="no">Client</span><span class="o">.</span><span class="n">new</span> <span class="k">do</span> <span class="o">|</span><span class="n">config</span><span class="o">|</span>
</span><span class='line'>      <span class="c1"># applicationの設定</span>
</span><span class='line'>      <span class="n">config</span><span class="o">.</span><span class="n">consumer_key</span>         <span class="o">=</span> <span class="no">Settings</span><span class="o">.</span><span class="n">twitter_key</span>
</span><span class='line'>      <span class="n">config</span><span class="o">.</span><span class="n">consumer_secret</span>      <span class="o">=</span> <span class="no">Settings</span><span class="o">.</span><span class="n">twitter_secret</span>
</span><span class='line'>      <span class="c1"># ユーザー情報の設定</span>
</span><span class='line'>      <span class="n">user_auth</span> <span class="o">=</span> <span class="n">current_user</span><span class="o">.</span><span class="n">authentications</span><span class="o">.</span><span class="n">first</span>
</span><span class='line'>      <span class="n">config</span><span class="o">.</span><span class="n">access_token</span>         <span class="o">=</span> <span class="n">user_auth</span><span class="o">.</span><span class="n">token</span>
</span><span class='line'>      <span class="n">config</span><span class="o">.</span><span class="n">access_token_secret</span>  <span class="o">=</span> <span class="n">user_auth</span><span class="o">.</span><span class="n">secret</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1"># Twitter投稿</span>
</span><span class='line'>    <span class="n">client</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">params</span><span class="o">[</span><span class="ss">:text</span><span class="o">]</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">redirect_to</span> <span class="n">root_path</span><span class="p">,</span> <span class="n">notice</span><span class="p">:</span> <span class="s1">&#39;ツイートしました！&#39;</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<h2>viewを作成</h2>

<p><code>app/views/top/index.html.haml</code> にフォームを設置します。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="o">=</span> <span class="n">form_tag</span> <span class="n">tweet_path</span> <span class="k">do</span>
</span><span class='line'>  <span class="o">=</span> <span class="n">text_area_tag</span> <span class="ss">:text</span>
</span><span class='line'>  <span class="o">=</span> <span class="n">submit_tag</span> <span class="s1">&#39;ツイートする&#39;</span>
</span></code></pre></td></tr></table></div></figure>


<p>あと念のため、今回は facebook / githubのログインは削除します。</p>

<p><code>app/views/layouts/application.html.haml</code> の以下を削除してください。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="o">=</span> <span class="n">link_to</span> <span class="s1">&#39;Facebook&#39;</span><span class="p">,</span> <span class="s1">&#39;/auth/facebook&#39;</span>
</span><span class='line'><span class="o">=</span> <span class="n">link_to</span> <span class="s1">&#39;GitHub&#39;</span><span class="p">,</span>   <span class="s1">&#39;/auth/github&#39;</span>
</span></code></pre></td></tr></table></div></figure>


<h2>routesに以下を追加</h2>

<p>ルーティング情報を追加します。</p>

<p><code>config/routes.rb</code>に以下の内容を追加します。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="no">Rails</span><span class="o">.</span><span class="n">application</span><span class="o">.</span><span class="n">routes</span><span class="o">.</span><span class="n">draw</span> <span class="k">do</span>
</span><span class='line'>  <span class="c1"># tweet</span>
</span><span class='line'>  <span class="n">post</span> <span class="s1">&#39;/top/tweet&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;top#tweet&#39;</span><span class="p">,</span> <span class="n">as</span><span class="p">:</span> <span class="ss">:tweet</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<h2>実行確認</h2>

<p>ターミナルで以下のコマンドを実行して rails サーバーを起動してください。
(Cloud9の場合は、startボタンでrailsサーバーを起動)</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">bundle</span> <span class="nb">exec</span> <span class="n">rails</span> <span class="n">s</span>
</span></code></pre></td></tr></table></div></figure>


<p>そして、ブラウザで <code>http://localhost:3000</code> を開いてください。</p>

<p><img src="https://farm6.staticflickr.com/5704/23980458535_2e8e6a5495.jpg" width="500" height="173"></p>

<p>左上の「<strong>Login: Twitter</strong>」をクリックしてログイン。そしてツイートボタンをおすと</p>

<p><img src="https://farm6.staticflickr.com/5669/23980479635_befe85ce67.jpg" width="500" height="162"></p>

<p>とツイートできました。(※ 実話です！)</p>

<h2>(補足) minimum-omniauth-scaffold について</h2>

<p>今回使ったRubyGemの <strong><a href="https://github.com/shu0115/minimum-omniauth-scaffold">shu0115/minimum-omniauth-scaffold</a></strong>
は、Facebook/Twitter/GitHubのアカウントを使ったログイン機能のscaffoldを提供してくれるGemです。</p>

<p>すごく便利なのでFacebook/Twitter/GitHubのアカウントを使ったログイン機能を実装したいときは、是非試してみてください。</p>

<p>ちなみに、拙著の紹介記事は、『<strong><a href="http://morizyun.github.io/blog/minimum-omniauth-scaffold/">「minimum-omniauth-scaffold」 Facebook/Twitter/GitHubログインを高速実装！</a></strong>』もおすすめです！</p>

<br style="clear:both;"/>


<script async src="http://morizyun.github.io//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>


<!-- square -->


<p><ins class="adsbygoogle" style="display:inline-block;width:336px;height:280px" data-ad-client="ca-pub-4186413323075068" data-ad-slot="5059873392"></ins></p>

<script>
    (adsbygoogle = window.adsbygoogle || []).push({});
</script>


<h2>Special Thanks</h2>

<ul>
<li><strong><a href="http://blogs.zealot.co.jp/archives/810">Rails環境でTwitterとFacebookを使ってサイトの拡散をするため自動投稿させるアプリを作成してみた</a></strong></li>
<li><strong><a href="http://d.hatena.ne.jp/Nunocky/20110127/p1">Railsアプリから twitterにつぶやいてみた - Nunockyの日記</a></strong></li>
<li><strong><a href="http://qiita.com/ykyk1218/items/2541a313aac0f0e5d81a">Ruby - Railsのフォーム基本的な作成方法まとめ（form_forとかform_tag）</a></strong></li>
</ul>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[「minimum-omniauth-scaffold」　Facebook/Twitter/GitHubログインを高速実装！]]></title>
    <link href="http://morizyun.github.io/blog/minimum-omniauth-scaffold/"/>
    <updated>2015-12-26T19:45:00+09:00</updated>
    <id>http://morizyun.github.io/blog/minimum-omniauth-scaffold</id>
    <content type="html"><![CDATA[<p><a href="http://www.amazon.co.jp/gp/product/4839926689/ref=as_li_qf_sp_asin_il?ie=UTF8&camp=247&creative=1211&creativeASIN=4839926689&linkCode=as2&tag=morizyun00-22"><img border="0" src="http://ws.assoc-amazon.jp/widgets/q?_encoding=UTF8&ASIN=4839926689&Format=_SL160_&ID=AsinImage&MarketPlace=JP&ServiceVersion=20070822&WS=1&tag=morizyun00-22" width="150" style="float: left; margin: 0 20px 20px 0;" ></a><img src="http://www.assoc-amazon.jp/e/ir?t=morizyun00-22&l=as2&o=9&a=4839926689" width="1" height="1" border="0" alt="" style="border:none !important; margin:0px !important;" />プロダクトを作る時にFacebookやTwitter、GitHubのログイン機能を組み込むのはかなり普通に必要になってきました。そんな時にすごく便利なのが、この「<strong><a href="https://github.com/shu0115/minimum-omniauth-scaffold">minimum-omniauth-scaffold</a></strong>」です。</p>

<p>実際にハッカソンの中で初めて使いましたが、10〜20分で簡単に実装できてしました。
以下の環境で実行できました！</p>

<pre>
Rails 4.2.5
Ruby 2.3.0
</pre>




<!-- more -->


<br style="clear:both;"/>


<script async src="http://morizyun.github.io//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>


<!-- square -->


<p><ins class="adsbygoogle" style="display:inline-block;width:336px;height:280px" data-ad-client="ca-pub-4186413323075068" data-ad-slot="5059873392"></ins></p>

<script>
    (adsbygoogle = window.adsbygoogle || []).push({});
</script>


<h2>Gemのインストール</h2>

<p><code>Gemfile</code>に以下を追加して、コンソールで<code>bundle</code>を実行してください。</p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="c1"># Facebook/Twitter/GitHubログイン機能</span>
</span><span class='line'><span class="n">gem</span> <span class="s1">&#39;minimum-omniauth-scaffold&#39;</span>
</span></code></pre></td></tr></table></div></figure>


<p>ちなみにこちらのgemは、Ruby2.0+、Rails4.0+環境用とのことです。</p>

<h2>OmniAuth用のScaffold</h2>

<p>以下のコマンドを実行して、OmniAuth用のScaffoldを作成。</p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>rails g minimum:omniauth:scaffold
</span></code></pre></td></tr></table></div></figure>


<h2>Facebook/Twitter/GitHubでアプリを作成してキーを登録</h2>

<h3>Facebook</h3>

<p><strong><a href="https://developers.facebook.com/apps">Facebook Developers - App</a></strong>でアプリを作成して、App IDとアプリのシークレットキーを取得。<br/>
※ 必須マークが無いが 「Callback URL」も入力必要</p>

<h3>Twitter</h3>

<p><strong><a href="https://dev.twitter.com/">Twitter Developers</a></strong>でアプリを作成して、キーを取得。<br/>
※　「新しいアプリを作成」作成後「Facebookでログインするウェブサイト」に「http://0.0.0.0:3000/」を入力</p>

<h3>GitHub</h3>

<p><strong><a href="https://github.com/settings/applications/new">GitHub Register a new OAuth application</a></strong>でアプリを登録してキーを取得。
※ Main URL／Callback URL：「http://0.0.0.0:3000/」</p>

<h3>config/settings.local.yml</h3>

<p><code>config/settings.local.yml</code>に上で取得した情報を登録。</p>

<h3>本番用の環境変数の設定</h3>

<p>キー情報などはgitリポジトリに含めないほうがいいです。ということでHerokuを使って環境変数にキー情報を登録するのはこちら。</p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="c"># Twitter</span>
</span><span class='line'>heroku config:set <span class="nv">TWITTER_KEY</span><span class="o">=</span>xxxxxxxxxx <span class="nv">TWITTER_SECRET</span><span class="o">=</span>xxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
</span><span class='line'>
</span><span class='line'><span class="c"># Facebook</span>
</span><span class='line'>heroku config:set <span class="nv">FACEBOOK_APP_ID</span><span class="o">=</span>xxxxxxxxxx <span class="nv">FACEBOOK_APP_SECRET</span><span class="o">=</span>xxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
</span><span class='line'>
</span><span class='line'><span class="c"># GitHub</span>
</span><span class='line'>heroku config:set <span class="nv">GITHUB_CLIENT_ID</span><span class="o">=</span>xxxxxxxxxx <span class="nv">GITHUB_SECRET</span><span class="o">=</span>xxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
</span></code></pre></td></tr></table></div></figure>


<h3>認証用のテーブルを作成</h3>

<p>マイグレーションコマンドを実行して、認証に必要なテーブルを作成。</p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>rake db:migrate
</span></code></pre></td></tr></table></div></figure>


<p>と、たったこれだけのコマンドでログイン認証に必要な機能をひと通り実装できてしまいます！</p>

<p>継続的に開発を続けてこられている作者の<strong><a href="https://twitter.com/shu_0115">@shu0115</a></strong>さんには感謝感謝です＾＾</p>

<script async src="http://morizyun.github.io//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>


<!-- square -->


<p><ins class="adsbygoogle" style="display:inline-block;width:336px;height:280px" data-ad-client="ca-pub-4186413323075068" data-ad-slot="5059873392"></ins></p>

<script>
    (adsbygoogle = window.adsbygoogle || []).push({});
</script>


<h2>Special Thanks</h2>

<p><strong><a href="https://github.com/shu0115/minimum-omniauth-scaffold">shu0115/minimum-omniauth-scaffold</a></strong></p>

<p><strong><a href="http://qiita.com/shu_0115/items/6f5f0c210e9999da66be">Ruby 2.0.0-p247 + Rails 4.0.0 + minimum-omniauth-scaffold - Qiita [キータ]</a></strong></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[RubyKaigi 2015のMatzのキーノート・メモ]]></title>
    <link href="http://morizyun.github.io/blog/rubykaigi2015-matz-keynote/"/>
    <updated>2015-12-23T17:20:00+09:00</updated>
    <id>http://morizyun.github.io/blog/rubykaigi2015-matz-keynote</id>
    <content type="html"><![CDATA[<p><a href="http://www.amazon.co.jp/gp/product/4873113946/ref=as_li_qf_sp_asin_il?ie=UTF8&camp=247&creative=1211&creativeASIN=4873113946&linkCode=as2&tag=morizyun00-22"><img border="0" src="http://ws.assoc-amazon.jp/widgets/q?_encoding=UTF8&ASIN=4873113946&Format=_SL160_&ID=AsinImage&MarketPlace=JP&ServiceVersion=20070822&WS=1&tag=morizyun00-22" width="150" style="float: left; margin: 0 20px 20px 0;" ></a><img src="http://www.assoc-amazon.jp/e/ir?t=morizyun00-22&l=as2&o=9&a=4873113946" width="1" height="1" border="0" alt="" style="border:none !important; margin:0px !important;" />2015/12/11-13に開催された『<strong><a href="http://rubykaigi.org/2015">RubyKaigi 2015</a></strong>』に出席してきたので、その時のメモです。</p>

<p>とは言っても1日目から風邪でセッション中殆ど寝てて、２・３日目には熱がでて会場にすら行けなかったという
体たらくぶりでした。来年はマスクとか、うがい・手洗いとか万難を排して臨みたいと思っています&#8230;orz&#8230;</p>

<p>今回はまともに聞けてたMatzのKeynoteを中心にメモを書いていきます。</p>

<p>あとこの記事は、<strong><a href="http://qiita.com/advent-calendar/2015/m3">エムスリー Advent Calendar 2015 - Qiita</a></strong>の23日目です。</p>

<!-- more -->


<br style="clear:both;"/>


<script async src="http://morizyun.github.io//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>


<!-- square -->


<p><ins class="adsbygoogle" style="display:inline-block;width:336px;height:280px" data-ad-client="ca-pub-4186413323075068" data-ad-slot="5059873392"></ins></p>

<script>
    (adsbygoogle = window.adsbygoogle || []).push({});
</script>


<h2>プログラマーの三大美徳</h2>

<p>Perlの作者 Lally Wallの言葉。考えれば考える程いい言葉。</p>

<pre>
- 怠惰: プログラムを書いて、苦労を減らしたり、ドキュメントを書いて不要な質問を避ける
- 短気: 将来起こる問題を想定した設計、ロジックの無駄を排除した実装を行う
- 傲慢: 周りから文句が出ないような、自分が自信を持てるプログラムを書こう
</pre>


<h2>怒りに通じている</h2>

<p>「<strong>怒り</strong>」とは、制御されている限り有益なモチベーションの源泉となる。
ただし、怒りは他の人にネガティブな気持ちを伝染させてしまうので注意しよう。</p>

<h2>ナイスも人に移る</h2>

<ul>
<li>「<strong>ナイスさ</strong>」こそはRubyコミュニティの良さ => MINASWAN(Matz is Nice And So We Are Nice)</li>
<li>内心で怒っていても、外っつらは愛想よく、ナイスであろう</li>
</ul>


<h2>Ruby 2.3.0</h2>

<p>preview2が出た。クリスマスに合わせてリリース予定。新機能は次のようなもの。</p>

<pre>
- Did-you-mean
  - Gooogleのもしかして機能
- Enuerable#grep_v(inverseのv)
  - マッチしていないものを返す
- Hash#fetch_value
- Numeric$positive?, negative?
- Hwash comparisons(<=, <, >=, >) - No Comparable(<=>はない)
- Hash#to_proc
- Array,Hash,Struct$dig
- Indented here document(インデントの一番浅いところでとってくれる)
- froze-string-literal: true
- safe navigation operation => &.
  - u&.name&.first
</pre>


<p>Rubyの改善は、コミュニティの成果であう。</p>

<h2>OCaaS</h2>

<ul>
<li>OCaaS(OSS community as a Shark)、つまりオープンソースコミュニティは、動き続けなければ死ぬ。</li>
<li>変化を生み出し続ける必要があるが、変化を受け入れるのは、決して簡単なことではない。</li>
</ul>


<h2>変化</h2>

<ul>
<li>ユーザーのwantsを聞くべきではない。大切なのは隠れたneedsを見つけることだ</li>
<li>未来のことはわからないが「<strong>未来の変化</strong>」を生み出さないといけない</li>
</ul>


<h2>環境の変化</h2>

<p>Rubyの置かれている環境の変化として次の3つがある。</p>

<pre>
- Multi Core
- Code Scalability
- Data Scalability
</pre>


<h3>マルチコア</h3>

<pre>
- コンカレンシー
- 抽象度の高さがRubyの売り
- 候補
  - Ownership Model => 排他制御
  - STM => 現実的ではに
  - Streem model
</pre>


<p>この辺りで時間なくなったはず。。
Ruby3を2020年までにだして、Ruby 2.0より3倍早くするのが目標とのこと。
すごい！</p>

<h2>RubyKaigi で参考になりそうなサイト</h2>

<ul>
<li><strong><a href="https://www.youtube.com/channel/UCBSg5zH-VFJ42BGQFk4VH2A">RubyKaigi - YouTube</a></strong></li>
<li><strong><a href="http://togetter.com/li/911396">Ruby準国際カンファレンス #rubykaigi 2015 - Togetterまとめ</a></strong></li>
</ul>


<h2>RubyKaigiで個人的に面白かった発表</h2>

<p>テンプレートエンジンの高速化、FamlとHamlitの話はすごい面白かったです！</p>

<script async class="speakerdeck-embed" data-id="acd0c621607045aa8218049ae613747a" data-ratio="1.33333333333333" src="http://morizyun.github.io//speakerdeck.com/assets/embed.js"></script>




<br style="clear:both;"/>


<script async src="http://morizyun.github.io//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>


<!-- square -->


<p><ins class="adsbygoogle" style="display:inline-block;width:336px;height:280px" data-ad-client="ca-pub-4186413323075068" data-ad-slot="5059873392"></ins></p>

<script>
    (adsbygoogle = window.adsbygoogle || []).push({});
</script>

]]></content>
  </entry>
  
</feed>
